import{e as B,a1 as F,j as e,a2 as K}from"./index-CB18d6qw.js";import{b as a,c as g}from"./recharts-CHDYrIv-.js";import"./maplibre-gl-Cg9ukl_k.js";const W=`██████  ██    ██ ███    ███  ██████         ████████ ███████ ██████  ███    ███ ██ ███    ██  █████  ██      
██   ██  ██  ██  ████  ████ ██                 ██    ██      ██   ██ ████  ████ ██ ████   ██ ██   ██ ██      
██████    ████   ██ ████ ██ ██                 ██    █████   ██████  ██ ████ ██ ██ ██ ██  ██ ███████ ██      
██         ██    ██  ██  ██ ██                 ██    ██      ██   ██ ██  ██  ██ ██ ██  ██ ██ ██   ██ ██      
██         ██    ██      ██  ██████ ███████    ██    ███████ ██   ██ ██      ██ ██ ██   ████ ██   ██ ███████`,P=[{cmd:"help",desc:"Show available commands"},{cmd:"status",desc:"Get repeater status"},{cmd:"advert",desc:"Send an advertisement packet"},{cmd:"reboot",desc:"Reboot the device (may timeout, normal)"},{cmd:"clock",desc:"Display device clock time"},{cmd:"ver",desc:"Show firmware version and build date"},{cmd:"neighbors",desc:"Show nearby repeater nodes"},{cmd:"clear",desc:"Clear terminal screen"},{cmd:"password",desc:"Set new admin password",params:"{new-password}",required:!0},{cmd:"set af",desc:"Set air-time factor",params:"{value}",required:!0},{cmd:"set tx",desc:"Set LoRa TX power (reboot to apply)",params:"{power-dbm}",required:!0},{cmd:"set repeat",desc:"Enable/disable repeater role",params:"{on|off}",required:!0},{cmd:"set allow.read.only",desc:"Set read-only login access",params:"{on|off}",required:!0},{cmd:"set flood.max",desc:"Set max hops for flood packets",params:"{max-hops}",required:!0},{cmd:"set int.thresh",desc:"Set interference threshold",params:"{db-value}",required:!0},{cmd:"set agc.reset.interval",desc:"Set AGC reset interval (0=disable)",params:"{seconds}",required:!0},{cmd:"set multi.acks",desc:"Enable/disable double ACKs",params:"{0|1}",required:!0},{cmd:"set advert.interval",desc:"Set local advert interval (0=disable)",params:"{minutes}",required:!0},{cmd:"set flood.advert.interval",desc:"Set flood advert interval (0=disable)",params:"{hours}",required:!0},{cmd:"set guest.password",desc:"Set guest password",params:"{password}",required:!0},{cmd:"set name",desc:"Set advertisement name",params:"{name}",required:!0},{cmd:"set lat",desc:"Set map latitude",params:"{decimal-degrees}",required:!0},{cmd:"set lon",desc:"Set map longitude",params:"{decimal-degrees}",required:!0},{cmd:"set radio",desc:"Set radio params (reboot required)",params:"{freq,bw,sf,cr}",required:!0},{cmd:"log start",desc:"Start packet logging"},{cmd:"log stop",desc:"Stop packet logging"},{cmd:"log erase",desc:"Erase packet logs"}],H={"set repeat":["on","off"],"set allow.read.only":["on","off"],"set multi.acks":["0","1"],"set af":["0.1","0.5","1.0","2.0"],"set tx":["10","14","20","27"],"set int.thresh":["10","14","18","22"],"set agc.reset.interval":["0","30","60","300"],"set advert.interval":["0","5","15","30"],"set flood.advert.interval":["0","1","6","24"]};function Q(i){return i.includes("Batt:")&&i.includes("|")}function X(i){const n=[],r=i.split(" | ");for(const b of r){const l=b.indexOf(":");if(l===-1)continue;const x=b.substring(0,l).trim(),u=b.substring(l+1).trim();let o="normal";if(x==="Batt"){const p=parseFloat(u);p<3.3?o="critical":p<3.6?o="warning":o="good"}else if(x==="RSSI"){const p=parseInt(u);p<-120?o="critical":p<-100?o="warning":o="good"}else x==="SNR"?parseFloat(u)<0?o="warning":o="good":(x==="Err"&&parseInt(u)>0||x==="TxQ"&&parseInt(u)>5)&&(o="warning");n.push({label:x,value:u,status:o})}return n}const J=a.memo(function({visible:n}){return e.jsx("span",{className:g("inline-block w-2 h-4 bg-accent-primary ml-0.5 align-middle",n?"opacity-100":"opacity-20"),"aria-hidden":"true"})}),Y=a.memo(function({items:n,nodeName:r}){const b={normal:"text-text-primary",good:"text-accent-success",warning:"text-amber-400",critical:"text-accent-danger"};return e.jsxs("div",{className:"mt-2 p-3 rounded-lg bg-bg-subtle border border-border-subtle",children:[e.jsxs("div",{className:"text-center text-accent-primary text-xs font-semibold uppercase tracking-wide mb-3 pb-2 border-b border-border-subtle",children:[r," Status"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2",children:n.map(l=>e.jsxs("div",{className:"flex justify-between items-center px-2 py-1 rounded bg-bg-elevated border border-border-subtle",children:[e.jsx("span",{className:"text-text-muted text-xs uppercase",children:l.label}),e.jsx("span",{className:g("text-xs font-semibold",b[l.status]),children:l.value})]},l.label))})]})}),Z=a.memo(function({entry:n,nodeName:r}){const l=n.cmd.trim().toLowerCase()==="status"&&n.result&&Q(n.result)?X(n.result):null;return e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-accent-primary font-semibold",children:[r,"@repeater:~$"]}),e.jsx("span",{className:"text-text-primary",children:n.cmd})]}),n.isProcessing?e.jsxs("div",{className:"ml-0 mt-1 text-accent-secondary flex items-center gap-1",children:[e.jsx("span",{children:"Processing"}),e.jsxs("span",{className:"inline-flex gap-0.5",children:[e.jsx("span",{className:"animate-pulse",style:{animationDelay:"0ms"},children:"."}),e.jsx("span",{className:"animate-pulse",style:{animationDelay:"200ms"},children:"."}),e.jsx("span",{className:"animate-pulse",style:{animationDelay:"400ms"},children:"."})]})]}):l?e.jsx(Y,{items:l,nodeName:r}):n.result?e.jsx("div",{className:"ml-0 mt-1 text-text-secondary whitespace-pre-wrap border-l-2 border-border-subtle pl-3",children:n.result}):null]})}),$=a.memo(function({text:n,status:r}){return e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r==="pending"&&e.jsx("span",{className:"text-text-muted",children:"○"}),r==="active"&&e.jsx("span",{className:"text-accent-secondary animate-pulse",children:"●"}),r==="done"&&e.jsx("span",{className:"text-accent-success",children:"✓"}),r==="error"&&e.jsx("span",{className:"text-accent-danger",children:"✗"}),e.jsx("span",{className:g(r==="pending"&&"text-text-muted",r==="active"&&"text-accent-secondary",r==="done"&&"text-accent-success",r==="error"&&"text-accent-danger"),children:n})]})});function ae(){const i=B(),n=(i==null?void 0:i.node_name)||"pymc",[r,b]=a.useState("initializing"),[l,x]=a.useState(0),[u,o]=a.useState([]),[p,v]=a.useState(""),[M,G]=a.useState(!0),[w,k]=a.useState(-1),[R,S]=a.useState(!1),[y,I]=a.useState([]),[h,L]=a.useState(0),q=a.useRef(null),D=a.useRef(null),T=a.useRef(null),O=a.useRef(!1);a.useEffect(()=>{if(O.current)return;O.current=!0,(async()=>{x(1),await new Promise(t=>setTimeout(t,600)),b("checking"),x(2),await new Promise(t=>setTimeout(t,800)),x(3),await new Promise(t=>setTimeout(t,400)),b("connected")})()},[]),a.useEffect(()=>(T.current=setInterval(()=>{G(s=>!s)},530),()=>{T.current&&clearInterval(T.current)}),[]),a.useEffect(()=>{D.current&&(D.current.scrollTop=D.current.scrollHeight)},[u]);const V=a.useCallback(()=>{q.current&&r==="connected"&&q.current.focus()},[r]),A=a.useCallback(s=>{const t=s.trim().toLowerCase();if(!t){S(!1),I([]);return}const c=t.includes(" ");let f=[];if(c){const d=t.split(" "),j=d.slice(0,-1).join(" "),m=d[d.length-1],C=P.find(N=>N.cmd.toLowerCase()===j);C&&H[C.cmd]&&(f=H[C.cmd].filter(N=>N.toLowerCase().startsWith(m)).map(N=>({cmd:`${C.cmd} ${N}`,desc:`${C.desc} → ${N}`})))}else f=P.filter(d=>d.cmd.toLowerCase().startsWith(t));f.length>0?(I(f.slice(0,8)),L(0),S(!0)):(S(!1),I([]))},[]),E=a.useCallback(s=>{var c;const t=y[s];t&&(t.required&&t.params?(v(t.cmd+" "),A(t.cmd+" ")):(v(t.cmd),S(!1),I([])),(c=q.current)==null||c.focus())},[y,A]),U=a.useCallback(async s=>{const t=s.trim();if(!t)return;if(t.toLowerCase()==="clear"){o([]);return}if(t.toLowerCase()==="help"){const d=P.map(m=>`  ${m.cmd.padEnd(22)} ${m.desc}`).join(`
`),j={id:crypto.randomUUID(),cmd:t,result:`Available commands:

${d}`,isProcessing:!1,timestamp:Date.now()};o(m=>[...m,j]);return}const c=crypto.randomUUID(),f={id:c,cmd:t,result:null,isProcessing:!0,timestamp:Date.now()};o(d=>[...d,f]);try{const d=await F(t);o(j=>j.map(m=>m.id===c?{...m,isProcessing:!1,result:d.response||d.result||"Command executed"}:m))}catch(d){o(j=>j.map(m=>m.id===c?{...m,isProcessing:!1,result:`Error: ${d instanceof Error?d.message:"Command failed"}`}:m))}},[]),_=a.useCallback(s=>{if(R&&y.length>0){if(s.key==="ArrowDown"){s.preventDefault(),L(t=>Math.min(t+1,y.length-1));return}else if(s.key==="ArrowUp"){s.preventDefault(),L(t=>Math.max(t-1,0));return}else if(s.key==="Tab"){s.preventDefault(),E(h);return}else if(s.key==="Escape"){s.preventDefault(),S(!1);return}else if(s.key==="Enter"){s.preventDefault(),E(h);return}}if(s.key==="Enter"){s.preventDefault();const t=p;v(""),k(-1),S(!1),U(t)}else if(s.key==="ArrowUp"){s.preventDefault();const t=u.filter(c=>c.cmd).map(c=>c.cmd);if(t.length>0){const c=w<t.length-1?w+1:w;k(c),v(t[t.length-1-c]||"")}}else if(s.key==="ArrowDown")if(s.preventDefault(),w>0){const t=u.filter(f=>f.cmd).map(f=>f.cmd),c=w-1;k(c),v(t[t.length-1-c]||"")}else w===0&&(k(-1),v(""))},[p,u,w,U,R,y,h,E]),z=a.useCallback(s=>{const t=s.target.value;v(t),A(t)},[A]);return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{className:"w-6 h-6 text-accent-primary"}),e.jsx("h1",{className:"text-xl font-semibold text-text-primary",children:"Terminal"})]}),e.jsxs("div",{className:"glass-card overflow-hidden flex flex-col",style:{height:"calc(100vh - 180px)",minHeight:"400px"},onClick:V,children:[e.jsxs("div",{ref:D,className:"flex-1 p-4 sm:p-6 overflow-y-auto font-mono text-sm leading-relaxed bg-black/30",children:[e.jsx("pre",{className:"text-accent-primary text-[0.5rem] sm:text-[0.6rem] lg:text-xs leading-none mb-6 overflow-x-auto",children:W}),r!=="connected"&&e.jsxs("div",{className:"mb-6",children:[e.jsx($,{text:"Initializing terminal...",status:l>=1?l===1?"active":"done":"pending"}),e.jsx($,{text:"Checking repeater connection...",status:l>=2?l===2?"active":"done":"pending"}),e.jsx($,{text:r==="error"?"Connection failed":"Connection established",status:l>=3?r==="error"?"error":"done":"pending"})]}),r==="connected"&&u.length===0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-accent-success mb-1",children:["Connected to ",n]}),e.jsx("p",{className:"text-text-muted",children:"Type 'help' for available commands."})]}),u.map(s=>e.jsx(Z,{entry:s,nodeName:n},s.id)),r==="connected"&&e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-accent-primary font-semibold",children:[n,"@repeater:~$"]}),e.jsx("span",{className:"text-text-primary",children:p}),e.jsx(J,{visible:M})]}),R&&y.length>0&&e.jsxs("div",{className:"absolute left-0 bottom-full mb-2 w-full max-w-lg bg-bg-elevated border border-border-subtle rounded-lg shadow-xl overflow-hidden z-10",children:[e.jsxs("div",{className:"px-3 py-2 bg-bg-subtle border-b border-border-subtle flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-semibold text-accent-primary uppercase tracking-wide",children:"Available Commands"}),e.jsx("span",{className:"text-xs text-text-muted",children:"↑↓ Navigate • Tab Select • Esc Close"})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:y.map((s,t)=>e.jsxs("div",{onClick:()=>E(t),className:g("px-3 py-2 cursor-pointer border-b border-border-subtle last:border-b-0 transition-colors",t===h?"bg-accent-primary text-white":"hover:bg-bg-subtle"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:g("font-mono text-sm font-semibold",t===h?"text-white":"text-text-primary"),children:s.cmd}),s.params&&e.jsx("span",{className:g("text-xs px-1.5 py-0.5 rounded border",t===h?"bg-white/20 border-white/30 text-white/90":"bg-accent-primary/10 border-accent-primary/30 text-accent-primary"),children:s.params}),s.required&&e.jsx("span",{className:g("text-[10px] px-1 py-0.5 rounded uppercase font-semibold",t===h?"bg-amber-400/30 text-amber-200":"bg-amber-500/20 text-amber-400"),children:"Required"})]}),e.jsx("p",{className:g("text-xs mt-0.5",t===h?"text-white/80":"text-text-muted"),children:s.desc})]},s.cmd))})]})]})]}),r==="connected"&&e.jsx("input",{ref:q,type:"text",value:p,onChange:z,onKeyDown:_,className:"sr-only","aria-label":"Terminal input",autoFocus:!0}),e.jsx("div",{className:"px-4 py-2 border-t border-white/5 bg-black/20",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-text-muted",children:[e.jsx("span",{children:r==="connected"?"Click anywhere to type • ↑↓ for history":"Connecting..."}),(i==null?void 0:i.version)&&e.jsxs("span",{children:["pyMC v",i.version]})]})})]})]})}export{ae as default};
