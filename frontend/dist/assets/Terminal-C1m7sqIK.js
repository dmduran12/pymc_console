import{e as z,a1 as B,j as e,a2 as F}from"./index-CCF7uGn6.js";import{b as r,c as g}from"./recharts-CHDYrIv-.js";import"./maplibre-gl-Cg9ukl_k.js";const K=`██████  ██    ██ ███    ███  ██████         ████████ ███████ ██████  ███    ███ ██ ███    ██  █████  ██      
██   ██  ██  ██  ████  ████ ██                 ██    ██      ██   ██ ████  ████ ██ ████   ██ ██   ██ ██      
██████    ████   ██ ████ ██ ██                 ██    █████   ██████  ██ ████ ██ ██ ██ ██  ██ ███████ ██      
██         ██    ██  ██  ██ ██                 ██    ██      ██   ██ ██  ██  ██ ██ ██  ██ ██ ██   ██ ██      
██         ██    ██      ██  ██████ ███████    ██    ███████ ██   ██ ██      ██ ██ ██   ████ ██   ██ ███████`,P=[{cmd:"help",desc:"Show available commands"},{cmd:"status",desc:"Get repeater status"},{cmd:"advert",desc:"Send an advertisement packet"},{cmd:"reboot",desc:"Reboot the device (may timeout, normal)"},{cmd:"clock",desc:"Display device clock time"},{cmd:"ver",desc:"Show firmware version and build date"},{cmd:"neighbors",desc:"Show nearby repeater nodes"},{cmd:"clear",desc:"Clear terminal screen"},{cmd:"password",desc:"Set new admin password",params:"{new-password}",required:!0},{cmd:"set af",desc:"Set air-time factor",params:"{value}",required:!0},{cmd:"set tx",desc:"Set LoRa TX power (reboot to apply)",params:"{power-dbm}",required:!0},{cmd:"set repeat",desc:"Enable/disable repeater role",params:"{on|off}",required:!0},{cmd:"set allow.read.only",desc:"Set read-only login access",params:"{on|off}",required:!0},{cmd:"set flood.max",desc:"Set max hops for flood packets",params:"{max-hops}",required:!0},{cmd:"set int.thresh",desc:"Set interference threshold",params:"{db-value}",required:!0},{cmd:"set agc.reset.interval",desc:"Set AGC reset interval (0=disable)",params:"{seconds}",required:!0},{cmd:"set multi.acks",desc:"Enable/disable double ACKs",params:"{0|1}",required:!0},{cmd:"set advert.interval",desc:"Set local advert interval (0=disable)",params:"{minutes}",required:!0},{cmd:"set flood.advert.interval",desc:"Set flood advert interval (0=disable)",params:"{hours}",required:!0},{cmd:"set guest.password",desc:"Set guest password",params:"{password}",required:!0},{cmd:"set name",desc:"Set advertisement name",params:"{name}",required:!0},{cmd:"set lat",desc:"Set map latitude",params:"{decimal-degrees}",required:!0},{cmd:"set lon",desc:"Set map longitude",params:"{decimal-degrees}",required:!0},{cmd:"set radio",desc:"Set radio params (reboot required)",params:"{freq,bw,sf,cr}",required:!0},{cmd:"log start",desc:"Start packet logging"},{cmd:"log stop",desc:"Stop packet logging"},{cmd:"log erase",desc:"Erase packet logs"}],U={"set repeat":["on","off"],"set allow.read.only":["on","off"],"set multi.acks":["0","1"],"set af":["0.1","0.5","1.0","2.0"],"set tx":["10","14","20","27"],"set int.thresh":["10","14","18","22"],"set agc.reset.interval":["0","30","60","300"],"set advert.interval":["0","5","15","30"],"set flood.advert.interval":["0","1","6","24"]};function W(c){return c.includes("Batt:")&&c.includes("|")}function Q(c){const n=[],a=c.split(" | ");for(const f of a){const o=f.indexOf(":");if(o===-1)continue;const p=f.substring(0,o).trim(),u=f.substring(o+1).trim();let i="normal";if(p==="Batt"){const x=parseFloat(u);x<3.3?i="critical":x<3.6?i="warning":i="good"}else if(p==="RSSI"){const x=parseInt(u);x<-120?i="critical":x<-100?i="warning":i="good"}else p==="SNR"?parseFloat(u)<0?i="warning":i="good":(p==="Err"&&parseInt(u)>0||p==="TxQ"&&parseInt(u)>5)&&(i="warning");n.push({label:p,value:u,status:i})}return n}const X=r.memo(function({visible:n}){return e.jsx("span",{className:g("inline-block w-2 h-4 bg-accent-primary ml-0.5 align-middle",n?"opacity-100":"opacity-20"),"aria-hidden":"true"})}),J=r.memo(function({items:n,nodeName:a}){const f={normal:"text-text-primary",good:"text-accent-success",warning:"text-amber-400",critical:"text-accent-danger"};return e.jsxs("div",{className:"mt-2 p-3 rounded-lg bg-bg-subtle border border-border-subtle",children:[e.jsxs("div",{className:"text-center text-accent-primary text-xs font-semibold uppercase tracking-wide mb-3 pb-2 border-b border-border-subtle",children:[a," Status"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2",children:n.map(o=>e.jsxs("div",{className:"flex justify-between items-center px-2 py-1 rounded bg-bg-elevated border border-border-subtle",children:[e.jsx("span",{className:"text-text-muted text-xs uppercase",children:o.label}),e.jsx("span",{className:g("text-xs font-semibold",f[o.status]),children:o.value})]},o.label))})]})}),Y=r.memo(function({entry:n,nodeName:a}){const o=n.cmd.trim().toLowerCase()==="status"&&n.result&&W(n.result)?Q(n.result):null;return e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-accent-primary font-semibold",children:[a,"@repeater:~$"]}),e.jsx("span",{className:"text-text-primary",children:n.cmd})]}),n.isProcessing?e.jsxs("div",{className:"ml-0 mt-1 text-accent-secondary flex items-center gap-1",children:[e.jsx("span",{children:"Processing"}),e.jsxs("span",{className:"inline-flex gap-0.5",children:[e.jsx("span",{className:"animate-pulse",style:{animationDelay:"0ms"},children:"."}),e.jsx("span",{className:"animate-pulse",style:{animationDelay:"200ms"},children:"."}),e.jsx("span",{className:"animate-pulse",style:{animationDelay:"400ms"},children:"."})]})]}):o?e.jsx(J,{items:o,nodeName:a}):n.result?e.jsx("div",{className:"ml-0 mt-1 text-text-secondary whitespace-pre-wrap border-l-2 border-border-subtle pl-3",children:n.result}):null]})}),$=r.memo(function({text:n,status:a}){return e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a==="pending"&&e.jsx("span",{className:"text-text-muted",children:"○"}),a==="active"&&e.jsx("span",{className:"text-accent-secondary animate-pulse",children:"●"}),a==="done"&&e.jsx("span",{className:"text-accent-success",children:"✓"}),a==="error"&&e.jsx("span",{className:"text-accent-danger",children:"✗"}),e.jsx("span",{className:g(a==="pending"&&"text-text-muted",a==="active"&&"text-accent-secondary",a==="done"&&"text-accent-success",a==="error"&&"text-accent-danger"),children:n})]})});function se(){const c=z(),n=(c==null?void 0:c.node_name)||"pymc",[a,f]=r.useState("initializing"),[o,p]=r.useState(0),[u,i]=r.useState([]),[x,v]=r.useState(""),[H,M]=r.useState(!0),[w,k]=r.useState(-1),[T,N]=r.useState(!1),[y,I]=r.useState([]),[h,R]=r.useState(0),q=r.useRef(null),D=r.useRef(null),L=r.useRef(null);r.useEffect(()=>{(async()=>{p(1),await new Promise(t=>setTimeout(t,600)),f("checking"),p(2),await new Promise(t=>setTimeout(t,800)),c?(p(3),await new Promise(t=>setTimeout(t,400)),f("connected")):(await new Promise(t=>setTimeout(t,1e3)),f(c?"connected":"error"),p(3))})()},[c]),r.useEffect(()=>(L.current=setInterval(()=>{M(s=>!s)},530),()=>{L.current&&clearInterval(L.current)}),[]),r.useEffect(()=>{D.current&&(D.current.scrollTop=D.current.scrollHeight)},[u]);const G=r.useCallback(()=>{q.current&&a==="connected"&&q.current.focus()},[a]),A=r.useCallback(s=>{const t=s.trim().toLowerCase();if(!t){N(!1),I([]);return}const l=t.includes(" ");let b=[];if(l){const d=t.split(" "),j=d.slice(0,-1).join(" "),m=d[d.length-1],C=P.find(S=>S.cmd.toLowerCase()===j);C&&U[C.cmd]&&(b=U[C.cmd].filter(S=>S.toLowerCase().startsWith(m)).map(S=>({cmd:`${C.cmd} ${S}`,desc:`${C.desc} → ${S}`})))}else b=P.filter(d=>d.cmd.toLowerCase().startsWith(t));b.length>0?(I(b.slice(0,8)),R(0),N(!0)):(N(!1),I([]))},[]),E=r.useCallback(s=>{var l;const t=y[s];t&&(t.required&&t.params?(v(t.cmd+" "),A(t.cmd+" ")):(v(t.cmd),N(!1),I([])),(l=q.current)==null||l.focus())},[y,A]),O=r.useCallback(async s=>{const t=s.trim();if(!t)return;if(t.toLowerCase()==="clear"){i([]);return}if(t.toLowerCase()==="help"){const d=P.map(m=>`  ${m.cmd.padEnd(22)} ${m.desc}`).join(`
`),j={id:crypto.randomUUID(),cmd:t,result:`Available commands:

${d}`,isProcessing:!1,timestamp:Date.now()};i(m=>[...m,j]);return}const l=crypto.randomUUID(),b={id:l,cmd:t,result:null,isProcessing:!0,timestamp:Date.now()};i(d=>[...d,b]);try{const d=await B(t);i(j=>j.map(m=>m.id===l?{...m,isProcessing:!1,result:d.response||d.result||"Command executed"}:m))}catch(d){i(j=>j.map(m=>m.id===l?{...m,isProcessing:!1,result:`Error: ${d instanceof Error?d.message:"Command failed"}`}:m))}},[]),V=r.useCallback(s=>{if(T&&y.length>0){if(s.key==="ArrowDown"){s.preventDefault(),R(t=>Math.min(t+1,y.length-1));return}else if(s.key==="ArrowUp"){s.preventDefault(),R(t=>Math.max(t-1,0));return}else if(s.key==="Tab"){s.preventDefault(),E(h);return}else if(s.key==="Escape"){s.preventDefault(),N(!1);return}else if(s.key==="Enter"){s.preventDefault(),E(h);return}}if(s.key==="Enter"){s.preventDefault();const t=x;v(""),k(-1),N(!1),O(t)}else if(s.key==="ArrowUp"){s.preventDefault();const t=u.filter(l=>l.cmd).map(l=>l.cmd);if(t.length>0){const l=w<t.length-1?w+1:w;k(l),v(t[t.length-1-l]||"")}}else if(s.key==="ArrowDown")if(s.preventDefault(),w>0){const t=u.filter(b=>b.cmd).map(b=>b.cmd),l=w-1;k(l),v(t[t.length-1-l]||"")}else w===0&&(k(-1),v(""))},[x,u,w,O,T,y,h,E]),_=r.useCallback(s=>{const t=s.target.value;v(t),A(t)},[A]);return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{className:"w-6 h-6 text-accent-primary"}),e.jsx("h1",{className:"text-xl font-semibold text-text-primary",children:"Terminal"})]}),e.jsxs("div",{className:"glass-card overflow-hidden flex flex-col",style:{height:"calc(100vh - 180px)",minHeight:"400px"},onClick:G,children:[e.jsxs("div",{ref:D,className:"flex-1 p-4 sm:p-6 overflow-y-auto font-mono text-sm leading-relaxed bg-black/30",children:[e.jsx("pre",{className:"text-accent-primary text-[0.5rem] sm:text-[0.6rem] lg:text-xs leading-none mb-6 overflow-x-auto",children:K}),a!=="connected"&&e.jsxs("div",{className:"mb-6",children:[e.jsx($,{text:"Initializing terminal...",status:o>=1?o===1?"active":"done":"pending"}),e.jsx($,{text:"Checking repeater connection...",status:o>=2?o===2?"active":"done":"pending"}),e.jsx($,{text:a==="error"?"Connection failed":"Connection established",status:o>=3?a==="error"?"error":"done":"pending"})]}),a==="connected"&&u.length===0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-accent-success mb-1",children:["Connected to ",n]}),e.jsx("p",{className:"text-text-muted",children:"Type 'help' for available commands."})]}),u.map(s=>e.jsx(Y,{entry:s,nodeName:n},s.id)),a==="connected"&&e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-accent-primary font-semibold",children:[n,"@repeater:~$"]}),e.jsx("span",{className:"text-text-primary",children:x}),e.jsx(X,{visible:H})]}),T&&y.length>0&&e.jsxs("div",{className:"absolute left-0 bottom-full mb-2 w-full max-w-lg bg-bg-elevated border border-border-subtle rounded-lg shadow-xl overflow-hidden z-10",children:[e.jsxs("div",{className:"px-3 py-2 bg-bg-subtle border-b border-border-subtle flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-semibold text-accent-primary uppercase tracking-wide",children:"Available Commands"}),e.jsx("span",{className:"text-xs text-text-muted",children:"↑↓ Navigate • Tab Select • Esc Close"})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:y.map((s,t)=>e.jsxs("div",{onClick:()=>E(t),className:g("px-3 py-2 cursor-pointer border-b border-border-subtle last:border-b-0 transition-colors",t===h?"bg-accent-primary text-white":"hover:bg-bg-subtle"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:g("font-mono text-sm font-semibold",t===h?"text-white":"text-text-primary"),children:s.cmd}),s.params&&e.jsx("span",{className:g("text-xs px-1.5 py-0.5 rounded border",t===h?"bg-white/20 border-white/30 text-white/90":"bg-accent-primary/10 border-accent-primary/30 text-accent-primary"),children:s.params}),s.required&&e.jsx("span",{className:g("text-[10px] px-1 py-0.5 rounded uppercase font-semibold",t===h?"bg-amber-400/30 text-amber-200":"bg-amber-500/20 text-amber-400"),children:"Required"})]}),e.jsx("p",{className:g("text-xs mt-0.5",t===h?"text-white/80":"text-text-muted"),children:s.desc})]},s.cmd))})]})]})]}),a==="connected"&&e.jsx("input",{ref:q,type:"text",value:x,onChange:_,onKeyDown:V,className:"sr-only","aria-label":"Terminal input",autoFocus:!0}),e.jsx("div",{className:"px-4 py-2 border-t border-white/5 bg-black/20",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-text-muted",children:[e.jsx("span",{children:a==="connected"?"Click anywhere to type • ↑↓ for history":"Connecting..."}),(c==null?void 0:c.version)&&e.jsxs("span",{children:["pyMC v",c.version]})]})})]})]})}export{se as default};
