import{c as z,j as e,H as ge,I as ye,e as je,S as X,k as J,J as V,K as q,N as be,R as Ne}from"./index-B37AHdiD.js";import{b as h,d as de,i as ve,L as Ce,C as Me,X as ke,Y as we,T as Se,j as Re,e as Q}from"./recharts-CHDYrIv-.js";import{u as Fe,T as Le}from"./TimeRangeSelector-JnNMvLOY.js";import{u as G}from"./usePolling-CTxkEuwk.js";import{I as Te}from"./info-Bku3og1T.js";import{T as Z}from"./triangle-alert-CAX7rb0d.js";import{P as Ae,a as _e,C as $,G as ee,b as I}from"./PageLayout-Bk77Qfbb.js";import{T as De,N as Pe}from"./trending-up-DEHAuP-Y.js";import"./maplibre-gl-Cg9ukl_k.js";/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],$e=z("chart-pie",Oe);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],te=z("circle-check-big",Ee);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Y=z("compass",Ie);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],se=z("hash",We);function P(t){return typeof window>"u"?"":getComputedStyle(document.documentElement).getPropertyValue(t).trim()}const _={chart1:"#71F8E5",chart2:"#39D98A",chart3:"#F9D26F",chart4:"#FF5C7A",chart5:"#B49DFF",chart6:"#60A5FA",chart7:"#F472B6",chart8:"#FB923C"};function me(){const[t,s]=h.useState(_);return h.useEffect(()=>{const n=()=>{const r={chart1:P("--chart-1")||_.chart1,chart2:P("--chart-2")||_.chart2,chart3:P("--chart-3")||_.chart3,chart4:P("--chart-4")||_.chart4,chart5:P("--chart-5")||_.chart5,chart6:P("--chart-6")||_.chart6,chart7:P("--chart-7")||_.chart7,chart8:P("--chart-8")||_.chart8};s(r)};n();const a=new MutationObserver(r=>{for(const c of r)if(c.attributeName==="data-theme"){setTimeout(n,50);break}});return a.observe(document.documentElement,{attributes:!0}),()=>{a.disconnect()}},[]),t}function He(){const t=me();return[t.chart1,t.chart2,t.chart3,t.chart4,t.chart5,t.chart6,t.chart7,t.chart8]}function xe(t){const s=t.match(/\(([^)]+)\)\s*$/);return s?s[1]:t.length>10?t.slice(0,10):t}function Ue({x:t,y:s,width:n,height:a,name:r,size:c,index:l,colors:f,depth:M,hoveredIndex:d,onHover:x,total:u}){if(M!==1)return null;const b=d!==null&&!(d===l),y=f[l%f.length],C=u>0?c/u*100:0,k=n>36&&a>20,w=n>36&&a>32,L=4,i=11,o=xe(r);return e.jsxs("g",{onMouseEnter:m=>x(l,m),onMouseLeave:()=>x(null),style:{cursor:"default"},children:[e.jsx("rect",{x:t,y:s,width:n,height:a,fill:y,opacity:b?.4:1,stroke:"rgba(0,0,0,0.2)",strokeWidth:1,rx:3,style:{transition:"opacity 150ms ease"}}),k&&e.jsxs(e.Fragment,{children:[w&&e.jsxs("text",{x:t+L,y:s+a-L-i,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.6)",fontSize:8,fontFamily:"'JetBrains Mono', monospace",fontWeight:500,style:{pointerEvents:"none"},children:[C.toFixed(1),"%"]}),e.jsx("text",{x:t+L,y:s+a-L,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.85)",fontSize:9,fontFamily:"'JetBrains Mono', monospace",fontWeight:600,style:{pointerEvents:"none"},children:o})]})]})}function Be({data:t,total:s,color:n,position:a,containerWidth:r}){if(!t||!a)return null;const c=(t.value/s*100).toFixed(1),l=160,d=r-a.x<l+24?Math.max(8,a.x-l-8):a.x+16;return e.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:d,top:Math.max(8,a.y-60)},children:e.jsxs("div",{className:"bg-bg-surface/95 backdrop-blur-sm border border-border-subtle rounded-lg px-3 py-2 shadow-lg min-w-[140px]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:{backgroundColor:n}}),e.jsx("span",{className:"type-data-sm font-semibold text-text-primary",children:xe(t.name)})]}),e.jsxs("div",{className:"space-y-0.5 type-data-xs text-text-muted",children:[e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{children:"Count"}),e.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:t.value.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{children:"Share"}),e.jsxs("span",{className:"text-text-primary tabular-nums font-medium",children:[c,"%"]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:s.toLocaleString()})]})]})]})})}function ze({data:t}){var y,C;const[s,n]=h.useState(null),[a,r]=h.useState(null),[c,l]=h.useState(0),f=h.useRef(null),M=He(),{treemapData:d,total:x}=h.useMemo(()=>{const k=t.reduce((o,m)=>o+m.value,0);return{treemapData:[...t].sort((o,m)=>m.value-o.value).filter(o=>k>0&&o.value/k*100>=.5).map((o,m)=>({name:o.name,size:o.value,index:m})),total:k}},[t]),u=h.useCallback((k,w)=>{if(n(k),w&&k!==null){const L=f.current;if(L){const i=L.getBoundingClientRect();l(i.width),r({x:w.clientX-i.left,y:w.clientY-i.top})}}else r(null)},[]),g=s!==null?{name:((y=d[s])==null?void 0:y.name)??"",value:((C=d[s])==null?void 0:C.size)??0}:null,b=s!==null?M[s%M.length]:"";return t.length===0||x===0?e.jsx("div",{className:"h-56 flex items-center justify-center text-text-muted",children:"No packet type data available"}):e.jsxs("div",{className:"h-56 relative treemap-container",ref:f,children:[e.jsx(de,{width:"100%",height:"100%",children:e.jsx(ve,{data:d,dataKey:"size",aspectRatio:4/3,stroke:"none",isAnimationActive:!1,content:e.jsx(Ue,{x:0,y:0,width:0,height:0,name:"",value:0,size:0,index:0,colors:M,depth:0,hoveredIndex:s,onHover:u,total:x})})}),e.jsx(Be,{data:g,total:x,color:b,position:a,containerWidth:c})]})}const Xe=h.memo(ze);function Ge(t,s){const n=new Map;for(const a of t)n.set(a.start,{...a});for(const a of s){const r=n.get(a.start);r?(r.airtime_ms+=a.airtime_ms,r.count+=a.count):n.set(a.start,{...a})}return Array.from(n.values()).sort((a,r)=>a.start-r.start)}function Ke(t,s,n){const a=new Map(t.map(l=>[l.start,l])),r=new Map(s.map(l=>[l.start,l]));return Array.from(new Set([...a.keys(),...r.keys()])).sort((l,f)=>l-f).map(l=>{const f=a.get(l),M=r.get(l),d=((f==null?void 0:f.airtime_ms)??0)/n*100,x=((M==null?void 0:M.airtime_ms)??0)/n*100;return{timestamp:l,rxUtilW:d,txUtilW:x}})}function Ye(t,s,n,a){const r=Array.from({length:a},()=>({rxMax:0,txMax:0,rxHits:0,txHits:0,rxAvg:0,txAvg:0})),c=n-s;if(c<=0||a<=0)return r;const l=new Float64Array(a),f=new Float64Array(a),M=new Uint32Array(a);for(const d of t){if(d.timestamp<s||d.timestamp>n)continue;const x=Math.min(a-1,Math.max(0,Math.floor((d.timestamp-s)/c*a)));M[x]++,l[x]+=d.rxUtilW,f[x]+=d.txUtilW,d.rxUtilW>r[x].rxMax&&(r[x].rxMax=d.rxUtilW),d.txUtilW>r[x].txMax&&(r[x].txMax=d.txUtilW),d.rxUtilW>0&&r[x].rxHits++,d.txUtilW>0&&r[x].txHits++}for(let d=0;d<a;d++){const x=M[d]||1;r[d].rxAvg=l[d]/x,r[d].txAvg=f[d]/x}return r}const ae={r:57,g:217,b:138},ne={r:176,g:176,b:195};function Je(t,s,n,a,r){const{yMax:c,tailPx:l}=r;t.clearRect(0,0,n,a);const f=44,M=8,d=8,x=40,u=n-f-M,g=a-d-x;if(u<=0||g<=0)return;const b=u/s.length,y=i=>{const o=Math.min(i,c);return d+g*(1-o/c)},C=(i,o,m,j)=>{if(o<=0)return;const p=y(o),T=y(0),A=Math.min(l,T-p);if(t.fillStyle=`rgba(${m.r}, ${m.g}, ${m.b}, ${j})`,t.fillRect(i,p,Math.max(1,b-.5),2),A>2){const D=t.createLinearGradient(0,p+2,0,p+A);D.addColorStop(0,`rgba(${m.r}, ${m.g}, ${m.b}, ${j*.6})`),D.addColorStop(1,`rgba(${m.r}, ${m.g}, ${m.b}, 0)`),t.fillStyle=D,t.fillRect(i,p+2,Math.max(1,b-.5),A-2)}},k=(i,o,m,j)=>{if(o<=0||m<=0)return;const p=o/m,T=3,A=d+g-T;t.fillStyle=`rgba(${j.r}, ${j.g}, ${j.b}, ${p*.25})`,t.fillRect(i,A,Math.max(1,b-.5),T)},w=Math.max(...s.map(i=>i.rxHits),1),L=Math.max(...s.map(i=>i.txHits),1);for(let i=0;i<s.length;i++){const o=s[i],m=f+i*b;C(m,o.txMax,ne,.5),C(m,o.rxMax,ae,.7),k(m,o.txHits,L,ne),k(m,o.rxHits,w,ae)}}const Ve="#39D98A",qe="#B0B0C3",Qe=30;function Ze({active:t,payload:s,label:n}){if(!t||!s||s.length===0)return null;const a=s.filter(c=>c.value!==null&&c.value!==void 0);if(a.length===0)return null;const r=n?new Date(n*1e3).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):"";return e.jsxs("div",{className:"bg-bg-surface/95 backdrop-blur-sm border border-border-subtle rounded-lg px-3 py-2 text-sm",children:[e.jsx("div",{className:"font-medium text-text-primary mb-1 font-mono",children:r}),a.map((c,l)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-0.5",style:{backgroundColor:c.color}}),e.jsxs("span",{className:"text-text-muted",children:[c.name,":"]}),e.jsxs("span",{className:"text-text-primary tabular-nums font-mono",children:[Number(c.value).toFixed(2),"%"]})]},l))]})}function et({payload:t}){return t?e.jsx("div",{className:"flex items-center gap-6 justify-center text-xs font-mono",children:t.map((s,n)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:s.color}}),e.jsx("span",{className:"text-text-muted",children:s.value})]},n))}):null}function tt({samples:t,startTs:s,endTs:n,yMax:a=Qe}){const r=h.useRef(null),c=h.useRef(null),l=h.useMemo(()=>{if(t.length===0)return[];const x=Math.max(1,Math.floor(t.length/400)),u=[];for(let g=0;g<t.length;g+=x){const b=t[g];b&&typeof b.timestamp=="number"&&!isNaN(b.timestamp)&&u.push({timestamp:b.timestamp,rx:typeof b.rxUtilW=="number"&&!isNaN(b.rxUtilW)?b.rxUtilW:0,tx:typeof b.txUtilW=="number"&&!isNaN(b.txUtilW)?b.txUtilW:0})}return u},[t]),f=h.useMemo(()=>Math.max(1,Math.floor(l.length/8)),[l.length]),M=d=>{const x=new Date(d*1e3);return(n-s)/3600>24?x.toLocaleDateString([],{month:"short",day:"numeric"})+" "+x.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}):x.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})};return h.useEffect(()=>{const d=r.current,x=c.current;if(!d||!x)return;const u=()=>{const b=d.getBoundingClientRect(),y=Math.max(1,Math.floor(b.width)),C=Math.max(1,Math.floor(b.height)),k=window.devicePixelRatio||1;x.width=Math.floor(y*k),x.height=Math.floor(C*k),x.style.width=`${y}px`,x.style.height=`${C}px`;const w=x.getContext("2d");if(!w)return;w.setTransform(k,0,0,k,0,0);const i=Ye(t,s,n,y);Je(w,i,y,C,{yMax:a,tailPx:24})},g=new ResizeObserver(u);return g.observe(d),u(),()=>g.disconnect()},[t,s,n,a]),t.length===0?e.jsx("div",{className:"h-80 flex items-center justify-center text-text-muted",children:"No traffic data available"}):e.jsxs("div",{ref:r,className:"relative h-80",children:[e.jsx("canvas",{ref:c,className:"absolute inset-0 pointer-events-none"}),e.jsx(de,{width:"100%",height:320,children:e.jsxs(Ce,{data:l,children:[e.jsx(Me,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.04)",vertical:!1}),e.jsx(ke,{dataKey:"timestamp",type:"number",domain:[s,n],axisLine:!1,tickLine:!1,tick:{fill:"rgba(255,255,255,0.4)",fontSize:9,fontFamily:"'JetBrains Mono', monospace"},dy:8,interval:f,minTickGap:60,tickFormatter:M}),e.jsx(we,{axisLine:!1,tickLine:!1,tick:{fill:"rgba(255,255,255,0.4)",fontSize:10,fontFamily:"'JetBrains Mono', monospace"},dx:-8,width:44,tickFormatter:d=>`${d.toFixed(0)}%`,domain:[0,a]}),e.jsx(Se,{content:e.jsx(Ze,{})}),e.jsx(Re,{content:e.jsx(et,{})}),e.jsx(Q,{type:"linear",dataKey:"rx",name:"RX Avg",stroke:Ve,strokeWidth:1.5,strokeOpacity:.9,dot:!1,connectNulls:!1,isAnimationActive:!1}),e.jsx(Q,{type:"linear",dataKey:"tx",name:"TX Avg",stroke:qe,strokeWidth:1.5,strokeOpacity:.8,dot:!1,connectNulls:!1,isAnimationActive:!1})]})})]})}const st=h.memo(tt),at=1e4,ue=2e3,nt=ue/2,re=600,ie="#60A5FA",rt="#4CFFB5",oe=["N","NE","E","SE","S","SW","W","NW"];function it(t,s,n,a){const r=(a-s)*Math.PI/180,c=t*Math.PI/180,l=n*Math.PI/180,f=Math.sin(r)*Math.cos(l),M=Math.cos(c)*Math.sin(l)-Math.sin(c)*Math.cos(l)*Math.cos(r);let d=Math.atan2(f,M)*180/Math.PI;return d=(d+360)%360,d}function ot(t,s,n,a){const c=(n-t)*Math.PI/180,l=(a-s)*Math.PI/180,f=Math.sin(c/2)*Math.sin(c/2)+Math.cos(t*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 6371*(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)))}function ce(t){return t>=10?"#4CFFB5":t>=7?"#39D98A":t>=4?"#7DD87D":t>=1?"#A3E635":t>=-2?"#F9D26F":t>=-5?"#FBBF24":t>=-8?"#FF8A5C":t>=-11?"#EF4444":"#B91C1C"}function ct(t){return t>=10?"Excellent":t>=7?"Very Good":t>=4?"Good":t>=1?"Fair+":t>=-2?"Fair":t>=-5?"Fair-":t>=-8?"Poor":t>=-11?"Bad":"Critical"}function lt({neighbors:t,localLat:s,localLon:n}){const[a,r]=h.useState(null),[c,l]=h.useState(new Set),[f,M]=h.useState(0),d=h.useRef({});h.useEffect(()=>{const i=setTimeout(()=>{M(1)},100),o=setInterval(()=>{M(m=>m+1)},at);return()=>{clearTimeout(i),clearInterval(o)}},[]);const{processedNeighbors:x,maxDistance:u,totalNeighbors:g}=h.useMemo(()=>{const i=[];let o=0;for(const[j,p]of Object.entries(t)){if(!p.latitude||!p.longitude||p.latitude===0||p.longitude===0)continue;const T=it(s,n,p.latitude,p.longitude),A=ot(s,n,p.latitude,p.longitude);A>o&&(o=A),i.push({hash:j.slice(0,8),name:p.node_name||p.name||"Unknown",snr:p.snr??0,rssi:p.rssi??0,bearing:T,distance:A,normalizedDistance:0,lastSeen:p.last_seen})}const m=.15;for(const j of i)j.normalizedDistance=o>0?m+j.distance/o*(1-m):m;return{processedNeighbors:i,maxDistance:o,totalNeighbors:i.length}},[t,s,n]);if(h.useEffect(()=>{const i=[];for(const o of x){const m=d.current[o.hash];m!==void 0&&m!==o.lastSeen&&i.push(o.hash),d.current[o.hash]=o.lastSeen}i.length>0&&(queueMicrotask(()=>{l(o=>{const m=new Set(o);return i.forEach(j=>m.add(j)),m})}),setTimeout(()=>{l(o=>{const m=new Set(o);return i.forEach(j=>m.delete(j)),m})},re))},[x]),!(s!==0&&n!==0))return e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-text-muted",children:[e.jsx(Y,{className:"w-8 h-8 mb-2 opacity-50"}),e.jsx("p",{children:"Local node coordinates not configured"}),e.jsx("p",{className:"text-xs mt-1",children:"Set latitude/longitude in config to enable"})]});if(g===0)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-text-muted",children:[e.jsx(Y,{className:"w-8 h-8 mb-2 opacity-50"}),e.jsx("p",{children:"No neighbors with location data"})]});const y=280,C=y/2,k=y/2-30,w=(i,o)=>{const m=(i-90)*Math.PI/180,j=o*k;return{x:C+j*Math.cos(m),y:C+j*Math.sin(m)}},L=[.25,.5,.75,1];return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"text-xs text-text-muted uppercase tracking-wide mb-2",children:[g," neighbor",g!==1?"s":""," • max ",u.toFixed(1)," km"]}),e.jsxs("div",{className:"relative h-[280px]",children:[e.jsxs("svg",{width:y,height:y,className:"mx-auto",children:[e.jsx("defs",{children:e.jsx("style",{children:`
                @keyframes radar-pulse-scale {
                  0% {
                    transform: scale(0);
                    opacity: 0.9;
                    stroke-width: 10;
                  }
                  100% {
                    transform: scale(1);
                    opacity: 0;
                    stroke-width: 1;
                  }
                }
                @keyframes local-node-ping {
                  0% {
                    fill: ${rt};
                  }
                  100% {
                    fill: ${ie};
                  }
                }
                @keyframes neighbor-blink-scale {
                  0%, 100% {
                    transform: scale(1);
                    opacity: 0;
                  }
                  50% {
                    transform: scale(1.3);
                    opacity: 0.8;
                  }
                }
                .radar-pulse-circle {
                  transform-origin: center;
                  animation: radar-pulse-scale ${ue}ms cubic-bezier(0.15, 0.6, 0.4, 1) forwards;
                }
                .local-node-ping {
                  animation: local-node-ping ${nt}ms ease-out forwards;
                }
                .neighbor-blink-ring {
                  transform-origin: center;
                  animation: neighbor-blink-scale ${re}ms ease-out forwards;
                }
              `})}),L.map(i=>e.jsx("circle",{cx:C,cy:C,r:k*i,fill:"none",stroke:"rgba(255,255,255,0.1)",strokeWidth:1},i)),f>0&&e.jsx("circle",{cx:C,cy:C,r:k,fill:"none",stroke:"rgba(255,255,255,0.5)",strokeWidth:1.5,className:"radar-pulse-circle"},`pulse-${f}`),oe.map((i,o)=>{const m=o*45,j=w(m,1);return e.jsx("line",{x1:C,y1:C,x2:j.x,y2:j.y,stroke:"rgba(255,255,255,0.08)",strokeWidth:1},i)}),oe.map((i,o)=>{const m=o*45,j=w(m,1.12);return e.jsx("text",{x:j.x,y:j.y,textAnchor:"middle",dominantBaseline:"middle",fill:"rgba(255,255,255,0.5)",fontSize:10,fontFamily:"'JetBrains Mono', monospace",children:i},i)}),e.jsx("circle",{cx:C,cy:C,r:6,fill:ie,stroke:"rgba(255,255,255,0.3)",strokeWidth:1,className:f>0?"local-node-ping":""},`local-${f}`),x.map(i=>{const{x:o,y:m}=w(i.bearing,i.normalizedDistance),j=ce(i.snr),p=(a==null?void 0:a.hash)===i.hash,T=c.has(i.hash);return e.jsxs("g",{children:[T&&e.jsx("circle",{cx:o,cy:m,r:12,fill:"none",stroke:"rgba(255,255,255,0.9)",strokeWidth:2,className:"neighbor-blink-ring"}),p&&e.jsx("circle",{cx:o,cy:m,r:12,fill:j,opacity:.3}),e.jsx("circle",{cx:o,cy:m,r:p?8:6,fill:j,stroke:"rgba(0,0,0,0.5)",strokeWidth:1,style:{cursor:"pointer",transition:"r 0.15s"},onMouseEnter:()=>r(i),onMouseLeave:()=>r(null)})]},i.hash)})]}),a&&e.jsxs("div",{className:"absolute bg-bg-surface/95 backdrop-blur-sm border border-border-subtle rounded-lg px-3 py-2 text-sm pointer-events-none z-10",style:{left:"50%",bottom:8,transform:"translateX(-50%)"},children:[e.jsx("div",{className:"font-medium text-text-primary",children:a.name}),e.jsx("div",{className:"text-text-muted text-xs font-mono",children:a.hash}),e.jsx("div",{className:"flex gap-3 mt-1 text-xs",children:e.jsxs("span",{children:[e.jsx("span",{className:"text-text-muted",children:"SNR:"})," ",e.jsxs("span",{className:"tabular-nums",style:{color:ce(a.snr)},children:[a.snr.toFixed(1)," dB"]}),e.jsxs("span",{className:"text-text-muted ml-1",children:["(",ct(a.snr),")"]})]})}),e.jsxs("div",{className:"flex gap-3 text-xs",children:[e.jsxs("span",{children:[e.jsx("span",{className:"text-text-muted",children:"Distance:"})," ",e.jsxs("span",{className:"tabular-nums text-text-secondary",children:[a.distance.toFixed(2)," km"]})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-text-muted",children:"Bearing:"})," ",e.jsxs("span",{className:"tabular-nums text-text-secondary",children:[a.bearing.toFixed(0),"°"]})]})]})]})]})]})}const dt=h.memo(lt);function mt({timestamps:t,values:s,height:n=224}){const a=me(),{cells:r,stats:c,xLabels:l,yLabels:f}=h.useMemo(()=>{if(t.length===0||s.length===0)return{cells:[],stats:null,xLabels:[],yLabels:[]};const u=Math.min(360,t.length),g=60,b=Math.min(...s),y=Math.max(...s),k=(y-b||1)*.1,w=b-k,i=y+k-w,o=Math.min(...t),j=Math.max(...t)-o||1,p=Array(g).fill(null).map(()=>Array(u).fill(0));for(let v=0;v<t.length;v++){const R=Math.floor((t[v]-o)/j*(u-1)),U=Math.floor((s[v]-w)/i*(g-1)),N=Math.max(0,Math.min(u-1,R)),S=Math.max(0,Math.min(g-1,g-1-U));p[S][N]++,S>0&&(p[S-1][N]+=.3),S<g-1&&(p[S+1][N]+=.3),N>0&&(p[S][N-1]+=.2),N<u-1&&(p[S][N+1]+=.2)}let T=0;for(let v=0;v<g;v++)for(let R=0;R<u;R++)p[v][R]>T&&(T=p[v][R]);const A=[];for(let v=0;v<g;v++)for(let R=0;R<u;R++)p[v][R]>0&&A.push({x:R,y:v,intensity:p[v][R]/T});const D=[],E=5;for(let v=0;v<=E;v++){const R=o+j*v/E;D.push({pos:v/E*100,label:new Date(R*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})}const W=[];for(let v=0;v<=4;v++){const R=w+i*v/4;W.push({pos:(1-v/4)*100,label:`${Math.round(R)}`})}return{cells:A,stats:{min:b,max:y,avg:s.reduce((v,R)=>v+R,0)/s.length,cols:u,rows:g},xLabels:D,yLabels:W}},[t,s]);if(!c||r.length===0)return e.jsx("div",{className:"h-56 flex items-center justify-center text-text-muted",children:"No noise floor data available"});const M=100/c.cols,d=100/c.rows,x=a.chart1;return e.jsxs("div",{className:"relative",style:{height:n},children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-6 w-8 flex flex-col justify-between text-right pr-2",children:f.map((u,g)=>e.jsx("span",{className:"type-data-xs text-text-muted tabular-nums",style:{position:"absolute",top:`${u.pos}%`,transform:"translateY(-50%)"},children:u.label},g))}),e.jsxs("div",{className:"absolute left-10 right-0 top-0 bottom-6",children:[e.jsx("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none",children:[0,25,50,75,100].map(u=>e.jsx("line",{x1:"0",y1:`${u}%`,x2:"100%",y2:`${u}%`,stroke:"rgba(255,255,255,0.06)",strokeDasharray:"3 3"},u))}),e.jsx("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none",children:r.map((u,g)=>{const b=.15+u.intensity*.85,y=50+u.intensity*50;return e.jsx("rect",{x:`${u.x*M}%`,y:`${u.y*d}%`,width:`${M+.1}%`,height:`${d+.1}%`,fill:x,opacity:b,style:{filter:u.intensity>.7?`saturate(${y}%)`:void 0}},g)})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-3",children:[e.jsxs("span",{className:"type-data-xs text-text-muted",children:["min ",e.jsx("span",{className:"text-text-secondary tabular-nums",children:c.min.toFixed(0)})]}),e.jsxs("span",{className:"type-data-xs text-text-muted",children:["avg ",e.jsx("span",{className:"text-text-secondary tabular-nums",children:c.avg.toFixed(0)})]}),e.jsxs("span",{className:"type-data-xs text-text-muted",children:["max ",e.jsx("span",{className:"text-text-secondary tabular-nums",children:c.max.toFixed(0)})]})]})]}),e.jsx("div",{className:"absolute left-10 right-0 bottom-0 h-6 flex justify-between",children:l.map((u,g)=>e.jsx("span",{className:"type-data-xs text-text-muted tabular-nums",style:{position:"absolute",left:`${u.pos}%`,transform:"translateX(-50%)"},children:u.label},g))})]})}const xt=h.memo(mt),K={repeater:"var(--accent-primary)",companion:"var(--accent-tertiary)",room_server:"var(--accent-secondary)"};function ut(t){if(t.contact_type){const s=t.contact_type.toLowerCase();if(s==="repeater"||s==="rep")return"repeater";if(s==="room server"||s==="room_server"||s==="room"||s==="server")return"room_server";if(s==="companion"||s==="client"||s==="cli")return"companion"}return t.is_repeater?"repeater":"companion"}function ht({neighbors:t}){const s=h.useMemo(()=>{const n={repeater:0,companion:0,room_server:0};for(const c of Object.values(t)){const l=ut(c);n[l]=(n[l]||0)+1}const a=Object.values(n).reduce((c,l)=>c+l,0);return{items:[{label:"Repeaters",count:n.repeater,percent:0,color:K.repeater},{label:"Companions",count:n.companion,percent:0,color:K.companion},{label:"Room Servers",count:n.room_server,percent:0,color:K.room_server}].map(c=>({...c,percent:a>0?c.count/a*100:0})).filter(c=>c.count>0).sort((c,l)=>l.count-c.count),total:a}},[t]);return s.total===0?e.jsx("div",{className:"h-full flex items-center justify-center text-text-muted type-body-sm",children:"No neighbors discovered yet"}):e.jsxs("div",{className:"flex flex-col gap-3",children:[s.items.map(n=>e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"type-data-sm text-text-secondary",children:n.label}),e.jsxs("span",{className:"type-data-sm text-text-muted tabular-nums",children:[n.count," ",e.jsxs("span",{className:"text-text-muted/60",children:["(",n.percent.toFixed(0),"%)"]})]})]}),e.jsx("div",{className:"h-2.5 bg-bg-elevated rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out",style:{width:`${n.percent}%`,backgroundColor:n.color,minWidth:n.count>0?"4px":"0"}})})]},n.label)),e.jsxs("div",{className:"flex items-center justify-between pt-2 mt-1 border-t border-border-subtle",children:[e.jsx("span",{className:"type-data-xs text-text-muted",children:"Total Nodes"}),e.jsx("span",{className:"type-data-sm text-text-primary font-medium tabular-nums",children:s.total})]})]})}const ft=h.memo(ht),pt=.9,gt=.7,yt=.5,jt=10,bt=25;function Nt(t){return t>=pt?"excellent":t>=gt?"good":t>=yt?"fair":"poor"}function vt(t){return t<=jt?"excellent":t<=bt?"good":"poor"}const B={excellent:"text-signal-excellent",good:"text-signal-good",fair:"text-signal-fair",poor:"text-signal-poor"},Ct={excellent:"bg-signal-excellent/10",good:"bg-signal-good/10",fair:"bg-signal-fair/10",poor:"bg-signal-poor/10"};function le({value:t,status:s}){const n={excellent:"bg-signal-excellent",good:"bg-signal-good",fair:"bg-signal-fair",poor:"bg-signal-poor"}[s];return e.jsx("div",{className:"w-full h-2 bg-surface-elevated rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${n} transition-all duration-300`,style:{width:`${Math.min(100,Math.max(0,t))}%`}})})}function Mt(){const t=ge();if(!ye())return e.jsxs("div",{className:"data-card flex flex-col min-h-[200px]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(se,{className:"w-4 h-4 text-accent-primary"}),e.jsx("span",{className:"data-card-title",children:"Prefix Disambiguation"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-text-muted",children:[e.jsx(Te,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"type-data-xs",children:"No topology data available"}),e.jsx("p",{className:"type-data-xs opacity-70",children:"Run deep analysis to see stats"})]})})]});const n=Nt(t.avgConfidence),a=vt(t.collisionRate),r=n==="poor"||a==="poor"?"poor":n==="fair"||a==="fair"?"fair":n==="good"||a==="good"?"good":"excellent",c=r==="excellent"||r==="good"?te:Z;return e.jsxs("div",{className:"data-card flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-accent-primary"}),e.jsx("span",{className:"data-card-title",children:"Prefix Disambiguation"})]}),e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-1 rounded ${Ct[r]}`,children:[e.jsx(c,{className:`w-3.5 h-3.5 ${B[r]}`}),e.jsx("span",{className:`type-data-xs font-medium ${B[r]}`,children:r==="excellent"?"Excellent":r==="good"?"Good":r==="fair"?"Fair":"Needs Attention"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[e.jsx("span",{className:"type-data-xs text-text-muted",children:"Avg Confidence"}),e.jsxs("span",{className:`type-data-lg font-semibold ${B[n]}`,children:[(t.avgConfidence*100).toFixed(1),"%"]})]}),e.jsx(le,{value:t.avgConfidence*100,status:n})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[e.jsx("span",{className:"type-data-xs text-text-muted",children:"Collision Rate"}),e.jsxs("span",{className:`type-data-lg font-semibold ${B[a]}`,children:[t.collisionRate.toFixed(1),"%"]})]}),e.jsx(le,{value:t.collisionRate,status:a})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4 py-3 border-t border-b border-border-subtle",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"type-data-lg font-semibold text-text-primary",children:t.totalPrefixes}),e.jsx("div",{className:"type-data-xs text-text-muted",children:"Prefixes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"type-data-lg font-semibold text-signal-good",children:t.unambiguousPrefixes}),e.jsx("div",{className:"type-data-xs text-text-muted",children:"Unique"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`type-data-lg font-semibold ${t.collisionPrefixes>0?"text-signal-fair":"text-text-primary"}`,children:t.collisionPrefixes}),e.jsx("div",{className:"type-data-xs text-text-muted",children:"Collisions"})]})]}),t.highCollisionPrefixes.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"type-data-xs text-text-muted mb-2",children:"Highest Collisions"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.highCollisionPrefixes.map(({prefix:l,candidateCount:f})=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-surface-elevated text-text-secondary type-data-xs font-mono",title:`${f} candidates match this prefix`,children:[l,e.jsxs("span",{className:"text-signal-fair",children:["×",f]})]},l))})]}),t.lowConfidencePrefixes.length>0&&e.jsx("div",{className:"mt-auto pt-3 border-t border-border-subtle",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Z,{className:"w-3.5 h-3.5 text-signal-poor mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("div",{className:"type-data-xs text-signal-poor font-medium",children:[t.lowConfidencePrefixes.length," prefix",t.lowConfidencePrefixes.length!==1?"es":""," with low confidence"]}),e.jsxs("div",{className:"type-data-xs text-text-muted mt-0.5",children:[t.lowConfidencePrefixes.slice(0,5).join(", "),t.lowConfidencePrefixes.length>5&&` +${t.lowConfidencePrefixes.length-5} more`]})]})]})}),t.lowConfidencePrefixes.length===0&&t.collisionPrefixes===0&&e.jsx("div",{className:"mt-auto pt-3 border-t border-border-subtle",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-3.5 h-3.5 text-signal-excellent"}),e.jsx("span",{className:"type-data-xs text-signal-excellent",children:"All prefixes uniquely identified"})]})})]})}const kt=10;function Ot(){var W,v,R,U;const t=je(),[s,n]=h.useState(null),[a,r]=h.useState(null),[c,l]=h.useState([]),[f,M]=h.useState(!0),[d,x]=h.useState(null),[u,g]=h.useState(3),b=Fe(u,150),y=X[b].hours,C=y*60,k=Math.ceil(C*60/kt);h.useEffect(()=>{async function N(){var S;x(null);try{const[F,O,H]=await Promise.all([J(C,k),V(y),q(y)]);F.success&&F.data&&n(F.data),O.success&&O.data&&r(O.data),H.success&&((S=H.data)!=null&&S.history)&&l(H.data.history)}catch(F){x(F instanceof Error?F.message:"Failed to load chart data")}finally{M(!1)}}N()},[y,C,k]);const{utilSamples:w,startTs:L,endTs:i}=h.useMemo(()=>{if(!s)return{utilSamples:[],startTs:0,endTs:0};const{received:N,transmitted:S,forwarded:F,bucket_duration_seconds:O,start_time:H,end_time:he}=s,fe=O*1e3,pe=Ge(S,F);return{utilSamples:Ke(N,pe,fe),startTs:H,endTs:he}},[s]),o=h.useMemo(()=>{switch(y){case 72:return 600*1e3;case 168:return 1800*1e3;default:return 300*1e3}},[y]),m=h.useCallback(async()=>{try{const N=await J(C,k);N.success&&N.data&&n(N.data)}catch{}},[C,k]),j=h.useCallback(async()=>{try{const N=await V(y);N.success&&N.data&&r(N.data)}catch{}},[y]),p=h.useCallback(async()=>{var N;try{const S=await q(y);S.success&&((N=S.data)!=null&&N.history)&&l(S.data.history)}catch{}},[y]);G(m,o,!0,!0),G(j,o,!0,!0),G(p,o,!0,!0);const T=h.useMemo(()=>!a||!a.series?[]:a.series.map(N=>({name:N.name,value:N.data.reduce((S,F)=>S+(F[1]??0),0)})).filter(N=>N.value>0),[a]),A=h.useMemo(()=>{if(c.length===0)return{timestamps:[],values:[]};const N=c.map(F=>F.timestamp),S=c.map(F=>F.noise_floor_dbm);return{timestamps:N,values:S}},[c]),D=X[u],E=h.useMemo(()=>{if(w.length===0)return{peak:0,mean:0};const N=Math.max(...w.map(F=>F.rxUtilW)),S=w.reduce((F,O)=>F+O.rxUtilW,0)/w.length;return{peak:N,mean:S}},[w]);return e.jsxs(Ae,{children:[e.jsx(_e,{title:"Statistics",icon:e.jsx(be,{}),controls:e.jsx(Le,{ranges:X,selectedIndex:u,onSelect:g})}),d&&e.jsx($,{className:"border border-accent-red/50 bg-accent-red/10",children:e.jsx("p",{className:"text-accent-red",children:d})}),f?e.jsx($,{className:"text-center",children:e.jsx("div",{className:"animate-pulse text-text-muted",children:"Loading statistics..."})}):e.jsxs(e.Fragment,{children:[e.jsxs(ee,{children:[e.jsx(I,{lg:8,children:e.jsxs($,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 sm:w-5 sm:h-5 text-accent-primary"}),e.jsx("h2",{className:"type-subheading text-text-primary",children:"Airtime Utilization"})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 sm:ml-auto",children:[e.jsxs("span",{className:"type-data-xs text-text-muted",children:["Peak ",e.jsxs("span",{className:"text-text-secondary tabular-nums font-medium",children:[E.peak.toFixed(2),"%"]})]}),e.jsxs("span",{className:"type-data-xs text-text-muted",children:["Mean ",e.jsxs("span",{className:"text-text-secondary tabular-nums font-medium",children:[E.mean.toFixed(2),"%"]})]}),e.jsx("span",{className:"pill-tag",children:D.label})]})]}),e.jsx(st,{samples:w,startTs:L,endTs:i})]})}),e.jsx(I,{lg:4,children:e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Y,{className:"w-5 h-5 text-accent-primary"}),e.jsx("h2",{className:"type-subheading text-text-primary",children:"Link Quality"})]}),e.jsx(dt,{neighbors:(t==null?void 0:t.neighbors)??{},localLat:((v=(W=t==null?void 0:t.config)==null?void 0:W.repeater)==null?void 0:v.latitude)??0,localLon:((U=(R=t==null?void 0:t.config)==null?void 0:R.repeater)==null?void 0:U.longitude)??0})]})})]}),e.jsxs(ee,{children:[e.jsx(I,{md:6,lg:4,children:e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Pe,{className:"w-5 h-5 text-accent-primary"}),e.jsx("h2",{className:"type-subheading text-text-primary",children:"Network Composition"})]}),e.jsx(ft,{neighbors:(t==null?void 0:t.neighbors)??{}})]})}),e.jsx(I,{md:6,lg:4,children:e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx($e,{className:"w-5 h-5 text-accent-primary"}),e.jsx("h2",{className:"type-subheading text-text-primary",children:"Packet Types"})]}),T.length>0?e.jsx(Xe,{data:T}):e.jsx("div",{className:"h-44 flex items-center justify-center text-text-muted",children:"No packet type data available"})]})}),e.jsx(I,{md:6,lg:4,children:e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ne,{className:"w-5 h-5 text-accent-primary"}),e.jsx("h2",{className:"type-subheading text-text-primary",children:"RF Noise Floor"}),e.jsx("span",{className:"type-data-xs text-text-muted ml-auto",children:"dBm"})]}),e.jsx(xt,{timestamps:A.timestamps,values:A.values,height:176})]})}),e.jsx(I,{md:6,lg:4,children:e.jsx(Mt,{})})]})]})]})}export{Ot as default};
