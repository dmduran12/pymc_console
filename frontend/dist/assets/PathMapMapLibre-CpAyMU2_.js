import{j as n}from"./index-CB18d6qw.js";import{b as x}from"./recharts-CHDYrIv-.js";import{M as B,S as G,L as T,a as z,P as v}from"./maplibre-gl-DbeYa8a3.js";import"./maplibre-gl-Cg9ukl_k.js";const J="https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",O=14,K=5,m={nodeColor:"#4338CA",localColor:"#4F46E5",hubColor:"#6366F1",edgeColor:"#3B3F4A",ambiguousColor:"#F9D26F"},R="#B49DFF",$="#39D98A",P="#B49DFF";function U(C,p,L,N=!1,d=!1,h=!1){const j=N?`box-shadow: 0 0 0 3px ${R}40, 0 0 8px ${R}60;`:"";let e;d?e=$:h?e=P:C?e=m.localColor:p?e=m.hubColor:L?e="transparent":e=m.ambiguousColor;const S=C||p||!L||d||h,c=S?"transparent":m.nodeColor;return`<div style="
    width: ${O}px;
    height: ${O}px;
    background: ${e};
    border-radius: 50%;
    border: ${S?0:K}px solid ${c};
    box-sizing: border-box;
    transition: box-shadow 0.15s ease;
    ${j}
  "></div>`}const V={id:"path-line",type:"line",paint:{"line-color":m.edgeColor,"line-width":2,"line-opacity":.7},layout:{"line-cap":"round","line-join":"round"}};function Q({resolvedPath:C,localNode:p,hubNodes:L=[],hoveredHopIndex:N,onHoverHop:d}){const h=x.useRef(null),j=x.useMemo(()=>new Set(L),[L]),[e,S]=x.useState(null),{positions:c,markers:M,pathLineGeoJSON:k}=x.useMemo(()=>{const t=[],o=[],s=[],r=(i,l)=>i!==0||l!==0;C.hops.forEach((i,l)=>{const g=i.candidates.filter(u=>r(u.latitude,u.longitude));if(g.length===0)return;const a=[...g].sort((u,F)=>F.probability-u.probability)[0];s.push([a.longitude,a.latitude]);const y=i.isSource===!0,b=i.isDestination===!0;g.forEach((u,F)=>{const E=[u.latitude,u.longitude];t.push(E);const w=F===0;o.push({position:E,prefix:i.prefix,confidence:i.confidence,candidateCount:g.length,hopIndex:l,candidate:u,isHub:j.has(u.hash),isPrimary:w,isSource:y,isDestination:b})})});const I={type:"FeatureCollection",features:s.length>=2?[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:s}}]:[]};return{positions:t,markers:o,pathLineGeoJSON:I}},[C,j]),{center:D,zoom:A}=x.useMemo(()=>{if(c.length===0)return p?{center:[p.longitude,p.latitude],zoom:10}:{center:[0,0],zoom:2};let t=1/0,o=-1/0,s=1/0,r=-1/0;for(const[y,b]of c)y<t&&(t=y),y>o&&(o=y),b<s&&(s=b),b>r&&(r=b);const I=(t+o)/2,i=(s+r)/2,l=o-t,g=r-s,f=Math.max(l,g);let a;return f<.01?a=15:f<.05?a=13:f<.1?a=12:f<.5?a=10:f<1?a=9:f<5?a=7:a=5,{center:[i,I],zoom:a}},[c,p]);x.useEffect(()=>{if(!h.current||c.length<2)return;let t=1/0,o=-1/0,s=1/0,r=-1/0;for(const[i,l]of c)i<t&&(t=i),i>o&&(o=i),l<s&&(s=l),l>r&&(r=l);h.current.fitBounds([[s,t],[r,o]],{padding:30,maxZoom:16,duration:0})},[c]);const _=x.useCallback(t=>{S({longitude:t.position[1],latitude:t.position[0],marker:t})},[]);return c.length===0?n.jsx("div",{className:"h-[200px] flex items-center justify-center text-text-muted text-sm bg-bg-elevated",children:"No mappable path data"}):n.jsxs(B,{ref:h,initialViewState:{longitude:D[0],latitude:D[1],zoom:A},style:{height:"200px",width:"100%"},mapStyle:J,attributionControl:!1,children:[k.features.length>0&&n.jsx(G,{id:"path-line-source",type:"geojson",data:k,children:n.jsx(T,{...V})}),M.map(t=>{const o=N===t.hopIndex;return n.jsx(z,{longitude:t.position[1],latitude:t.position[0],anchor:"center",onClick:()=>_(t),children:n.jsx("div",{style:{cursor:"pointer",opacity:t.isPrimary?1:.5},onMouseEnter:()=>d==null?void 0:d(t.hopIndex),onMouseLeave:()=>d==null?void 0:d(null),dangerouslySetInnerHTML:{__html:U(t.candidate.isLocal||!1,t.isHub,t.isPrimary,o,t.isSource,t.isDestination)}})},`${t.hopIndex}-${t.candidate.hash}`)}),e&&n.jsx(v,{longitude:e.longitude,latitude:e.latitude,anchor:"bottom",offset:[0,-12],closeOnClick:!1,onClose:()=>S(null),className:"maplibre-popup",children:n.jsxs("div",{className:"text-xs",children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("span",{className:"font-semibold",children:e.marker.candidate.name}),e.marker.isSource&&n.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:$,color:"#000"},children:"SRC"}),e.marker.isDestination&&n.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:P,color:"#000"},children:"DST"}),e.marker.isHub&&n.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:"#FBBF24",color:"#000"},children:"HUB"}),e.marker.candidate.isLocal&&n.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:m.localColor,color:"#fff"},children:"LOCAL"})]}),n.jsxs("div",{className:"text-text-muted font-mono text-[10px]",children:[e.marker.prefix," â€¢ ",e.marker.candidate.hash.slice(0,10),"..."]}),!e.marker.isPrimary&&e.marker.candidateCount>1&&n.jsxs("div",{style:{color:m.ambiguousColor},children:["Alternative (",(e.marker.candidate.probability*100).toFixed(0),"%)"]}),e.marker.isPrimary&&e.marker.candidateCount>1&&n.jsxs("div",{className:"text-text-muted",children:[e.marker.candidateCount," candidates"]})]})})]})}export{Q as default};
