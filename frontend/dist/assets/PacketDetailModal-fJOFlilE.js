const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PathMapMapLibre-BrmFKJJn.js","assets/index-sTRvpPgw.js","assets/recharts-CHDYrIv-.js","assets/maplibre-gl-Cg9ukl_k.js","assets/index-hlir0SXQ.css","assets/maplibre-gl-BDT_04aS.js","assets/maplibre-gl-B1CfjdFi.css"])))=>i.map(i=>d[i]);
import{c as T,j as t,n as re,o as oe,p as A,q,_ as ie,e as ce,r as le,s as de,t as ue,X as xe,v as X}from"./index-sTRvpPgw.js";import{b as v,c as N,g as me}from"./recharts-CHDYrIv-.js";import{S as O,g as he}from"./SignalIndicator-CXJAy1I8.js";import{H as D,M as fe,a as Y,C as B}from"./HashBadge-Crk5o9ce.js";import{T as pe}from"./triangle-alert-DVT36PaY.js";/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Q=T("arrow-down",ge);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],K=T("arrow-right",be);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],je=T("arrow-up",ye);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],G=T("chevron-right",ve);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],we=T("circle-question-mark",Ne);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],rt=T("circle-x",_e);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"m15 10 5 5-5 5",key:"qqa56n"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]],Me=T("corner-down-right",Pe);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],Te=T("map",Ce),Se={0:"REQ",1:"RESPONSE",2:"TXT_MSG",3:"ACK",4:"ADVERT",5:"GRP_TXT",6:"GRP_DATA",7:"ANON_REQ",8:"PATH",9:"TRACE",10:"MULTIPART",15:"RAW_CUSTOM"},De={0:"T_FLOOD",1:"FLOOD",2:"DIRECT",3:"T_DIRECT"};function k(e){return e==null?"UNKNOWN":Se[e]||`TYPE_${e}`}function F(e){return e==null?"UNKNOWN":De[e]||`ROUTE_${e}`}function z(e){return{ADVERT:"text-[var(--pkt-advert)]",FLOOD:"text-[var(--pkt-flood)]",TXT_MSG:"text-[var(--pkt-txt-msg)]",ACK:"text-[var(--pkt-ack)]",TRACE:"text-[var(--pkt-trace)]",REQ:"text-[var(--pkt-req)]",RESPONSE:"text-[var(--pkt-response)]",GRP_TXT:"text-[var(--pkt-grp-txt)]",GRP_DATA:"text-[var(--pkt-grp-data)]",PATH:"text-[var(--pkt-path)]",ANON_REQ:"text-[var(--pkt-anon)]"}[e]||"text-[var(--pkt-unknown)]"}function $(e){return{FLOOD:"bg-[var(--route-flood)]/20 text-[var(--route-flood)] border-[var(--route-flood)]/30",DIRECT:"bg-[var(--route-direct)]/20 text-[var(--route-direct)] border-[var(--route-direct)]/30",TRANSPORT:"bg-[var(--route-transport)]/20 text-[var(--route-transport)] border-[var(--route-transport)]/30",T_FLOOD:"bg-[var(--route-flood)]/20 text-[var(--route-flood)] border-[var(--route-flood)]/30",T_DIRECT:"bg-[var(--route-direct)]/20 text-[var(--route-direct)] border-[var(--route-direct)]/30"}[e]||"bg-bg-subtle text-text-muted border-border-subtle"}function J(e){return e===1||e===!0}function Z(e){return e.packet_origin==="tx_local"?"tx":e.packet_origin==="tx_forward"?"forward":e.is_duplicate?"duplicate":e.transmitted?"forward":e.drop_reason?"dropped":"rx"}const H={rx:{icon:Q,label:"RX",color:"text-accent-primary",bgColor:"bg-accent-primary/10"},tx:{icon:je,label:"TX",color:"text-[#F9D26F]",bgColor:"bg-[#F9D26F]/10"},forward:{icon:K,label:"FWD",color:"text-accent-success",bgColor:"bg-accent-success/10"},dropped:{icon:Me,label:"DROP",color:"text-accent-danger",bgColor:"bg-accent-danger/10"},duplicate:{icon:Q,label:"DUP",color:"text-text-muted",bgColor:"bg-white/5"}};function Re({packet:e,showLabel:a=!0,size:s="sm"}){const o=Z(e),r=H[o],l=r.icon,c={sm:"w-3.5 h-3.5",md:"w-4 h-4"};return t.jsxs("div",{className:N("inline-flex items-center gap-1 rounded-md",a&&"px-1.5 py-0.5",a&&r.bgColor),children:[t.jsx(l,{className:N(c[s],r.color)}),a&&t.jsx("span",{className:N("text-[10px] font-semibold tracking-wide",r.color),children:r.label})]})}const I=v.memo(Re);function Ee(e){return e.packet_origin==="tx_local"?"Transmitted":e.packet_origin==="tx_forward"||e.transmitted?"Forwarded":e.is_duplicate?"Duplicate":e.drop_reason==="No transport keys configured"?"Monitor Only":e.drop_reason?e.drop_reason:"Received"}function Le(e){const a=Z(e);return H[a].color}function Ae({packet:e,onClick:a,isFlashing:s=!1}){const o=e.payload_type_name||k(e.payload_type??e.type),r=e.route_type_name||F(e.route_type??e.route);return t.jsxs("tr",{onClick:()=>a(e),className:N("cursor-pointer","hover:bg-bg-subtle",J(e.is_duplicate)&&"opacity-50",s&&"flash-row"),children:[t.jsx("td",{className:"py-2.5 px-3",children:t.jsx(I,{packet:e,showLabel:!0})}),t.jsx("td",{className:"py-2.5 px-3 text-xs font-mono text-text-secondary whitespace-nowrap",children:oe(e.timestamp)}),t.jsx("td",{className:"py-2.5 px-3",children:e.src_hash?t.jsx(D,{hash:e.src_hash,size:"xs"}):t.jsx("span",{className:"text-xs text-text-muted",children:"—"})}),t.jsx("td",{className:"py-2.5 px-3",children:t.jsx("span",{className:N("text-xs font-semibold",z(o)),children:o})}),t.jsx("td",{className:"py-2.5 px-3",children:t.jsx("span",{className:N("px-1.5 py-0.5 rounded text-[10px] border font-medium",$(r)),children:r})}),t.jsx("td",{className:"py-2.5 px-3 pr-4 text-right",children:t.jsx(O,{rssi:e.rssi,snr:e.snr,compact:!0,showValues:!0})})]})}function Oe({packet:e,onClick:a,isFlashing:s=!1}){const o=e.payload_type_name||k(e.payload_type??e.type),r=e.route_type_name||F(e.route_type??e.route);return t.jsx("div",{onClick:()=>a(e),className:N("packet-row px-3 py-2.5 cursor-pointer","hover:bg-bg-subtle","active:bg-bg-elevated",J(e.is_duplicate)&&"opacity-50",s&&"flash-row"),children:t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"w-14 flex-shrink-0",children:t.jsx(I,{packet:e,showLabel:!0,size:"sm"})}),t.jsx("span",{className:"text-[10px] font-mono text-text-muted w-7 flex-shrink-0",children:re(e.timestamp)}),t.jsx("div",{className:"w-9 flex-shrink-0",children:e.src_hash?t.jsx(D,{hash:e.src_hash,size:"xs"}):t.jsx("span",{className:"text-[10px] text-text-muted",children:"—"})}),t.jsx("span",{className:N("text-xs font-semibold truncate flex-1 min-w-0",z(o)),children:o}),t.jsx("div",{className:"w-14 flex-shrink-0",children:t.jsx("span",{className:N("px-1 py-0.5 rounded text-[9px] border font-medium",$(r)),children:r})}),t.jsx("div",{className:"w-10 flex-shrink-0 text-right",children:t.jsx(O,{rssi:e.rssi,compact:!0,showValues:!0})})]})})}function ke(e){return t.jsx(t.Fragment,{children:t.jsx(Ae,{...e})})}const ot=v.memo(ke),it=v.memo(Oe);function Fe(e){if(e.contact_type){const a=e.contact_type.toLowerCase();if(a==="repeater"||a==="rep")return!0;if(a==="companion"||a==="client"||a==="cli"||a==="room server"||a==="room_server"||a==="room"||a==="server")return!1}return e.is_repeater===!0?!0:(e.is_repeater===!1,!1)}function ze(e){const a={};for(const[s,o]of Object.entries(e))Fe(o)&&(a[s]=o);return a}function $e(e,a,s){const o=a.toUpperCase(),r=e.get(o);if(!r||r.candidates.length===0)return{hash:null,confidence:0};if(s!=null&&s.isLastHop)return{hash:r.bestMatch,confidence:r.confidence};if((s==null?void 0:s.position)===1)return{hash:r.bestMatch,confidence:r.confidence};if(s!=null&&s.position&&r.bestMatchForPosition.has(s.position)){const l=r.bestMatchForPosition.get(s.position),c=Math.max(l.confidence,r.confidence);return{hash:l.hash,confidence:c}}if(s!=null&&s.adjacentPrefixes&&s.adjacentPrefixes.length>0){let l=r.bestMatch,c=0;for(const g of r.candidates){let x=0;for(const f of s.adjacentPrefixes)x+=g.adjacentPrefixCounts.get(f.toUpperCase())||0;const p=g.combinedScore+x/Math.max(1,g.totalAdjacentObservations)*.3;p>c&&(c=p,l=g.hash)}return{hash:l,confidence:r.confidence}}return{hash:r.bestMatch,confidence:r.confidence}}function Ie(e,a,s,o,r=!1){const l=e.toUpperCase(),c=[],g=s&&A(l,s);g&&c.push(s);for(const u of Object.keys(a))A(l,u)&&c.push(u);if(r&&g&&s&&c.length===1)return{matches:c,probability:1,bestMatch:s};if(r&&g&&c.length>1){const u=c.filter(b=>b!==s);if(u.length===1)return{matches:c,probability:1,bestMatch:u[0]}}const x=c.length>0?1/c.length:0,p=[...c].sort();let f=null,y=-1;if(p.length===1)f=p[0];else if(p.length>1&&o){for(const u of p){const b=o.get(u),i=b?typeof b=="number"?b:b.combinedScore:0;i>y&&(y=i,f=u)}f||(f=p[0])}else p.length>0&&(f=p[0]);let w=x;if(c.length>1&&o&&y>0){let u=0;for(const b of c){const i=o.get(b);u+=i?typeof i=="number"?i:i.combinedScore:0}u>0&&(w=Math.min(.95,y/u))}return{matches:c,probability:w,bestMatch:f}}function Ue(e,a,s,o){const l=(s-e)*Math.PI/180,c=(o-a)*Math.PI/180,g=Math.sin(l/2)*Math.sin(l/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)))}function Ve(e){return e<100?1:e<500?.9:e<1e3?.7:e<5e3?.5:e<1e4?.3:.1}const qe=v.lazy(()=>ie(()=>import("./PathMapMapLibre-BrmFKJJn.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function Xe(e,a,s,o,r=!1,l,c,g){const x=ze(a);let p;c&&(p=$e(c,e,{position:g,isLastHop:r}).confidence);const{matches:f,probability:y}=Ie(e,x,o,l,r),w=f.length,u=[],b=e.toUpperCase(),i=s&&s.latitude!==void 0&&s.longitude!==void 0&&(s.latitude!==0||s.longitude!==0);for(const m of f){if(o&&A(b,o)&&m===o&&i&&s){u.push({hash:m,name:s.name||"Local Node",latitude:s.latitude,longitude:s.longitude,probability:r?1:y,isLocal:!0});continue}const d=x[m];d!=null&&d.latitude&&(d!=null&&d.longitude)&&!(d.latitude===0&&d.longitude===0)&&u.push({hash:m,name:d.node_name||d.name||"Unknown",latitude:d.latitude,longitude:d.longitude,probability:y,isLocal:!1,isDirectNeighbor:d.zero_hop===!0})}const n=u.length;if(n===1)u[0].probability=p??1;else if(n>1)if(p!==void 0&&p>0){const m=u[0];m.probability=p;const d=1-p,h=n-1;u.slice(1).forEach(j=>{j.probability=d/h})}else{let m=0;const d=u.map(h=>{if(h.isLocal)return{candidate:h,score:1};const j=l==null?void 0:l.get(h.hash);let M=.5;if(i&&s){const S=Ue(s.latitude,s.longitude,h.latitude,h.longitude);M=Ve(S)}let _;return j?_=M*.3+j.hopConsistencyScore*.3+j.frequencyScore*.4:(_=M,h.isDirectNeighbor&&(_=Math.max(_,.8))),m+=_,{candidate:h,score:_}});if(m>0)d.forEach(({candidate:h,score:j})=>{h.probability=Math.min(.95,j/m)});else{const h=1/n;u.forEach(j=>j.probability=h)}}return{candidates:u,totalMatches:w}}function Qe(e,a,s,o,r,l){if(!e||e.length===0)return{hops:[],overallConfidence:0,hasValidPath:!1};const c=e.length-1,g=e.map((f,y)=>{const w=y===c,u=e.length-y,{candidates:b,totalMatches:i}=Xe(f,a,s,o,w,r,l,u),n=b.length>0?Math.max(...b.map(m=>m.probability)):0;return{prefix:f,candidates:b,confidence:n,totalMatches:i}}),x=g.reduce((f,y)=>y.confidence===0?0:f*y.confidence,1),p=g.some(f=>f.candidates.length>0);return{hops:g,overallConfidence:x,hasValidPath:p}}function Ge(e){return`${(e*100).toFixed(0)}%`}function We(e){return e>=1?"text-accent-success":e>=.5?"text-accent-secondary":e>=.25?"text-signal-poor":e>0?"text-accent-danger":"text-text-muted"}function Ye(e,a){const s={success:"#39D98A",secondary:"#F9D26F",poor:"#FF8A5C",danger:"#FF5C7A",muted:"#767688"};let o;return a===0?o=s.muted:e>=1?o=s.success:e>=.5?o=s.secondary:e>=.25?o=s.poor:e>0?o=s.danger:o=s.muted,{color:o}}class Be extends v.Component{constructor(a){super(a),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?t.jsxs("div",{className:"h-[200px] flex items-center justify-center text-text-muted",children:[t.jsx(pe,{className:"w-4 h-4 mr-2"}),"Map failed to load"]}):this.props.children}}function Ke({path:e,neighbors:a,localNode:s,localHash:o,srcHash:r,dstHash:l,neighborAffinity:c,prefixLookup:g,hubNodes:x}){const[p,f]=v.useState(null),y=v.useMemo(()=>{if(!r)return null;const i=q(r),n=a[r];if((n==null?void 0:n.latitude)&&(n==null?void 0:n.longitude)&&!(n.latitude===0&&n.longitude===0))return{prefix:i,candidates:[{hash:r,name:n.node_name||n.name||"Source",latitude:n.latitude,longitude:n.longitude,probability:1,isLocal:!1,isDirectNeighbor:n.zero_hop===!0}],confidence:1,totalMatches:1,isSource:!0};const d=(n==null?void 0:n.node_name)||(n==null?void 0:n.name)||r.slice(0,8);return{prefix:i,candidates:[{hash:r,name:d,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isSource:!0}},[r,a]),w=v.useMemo(()=>{if(!l)return null;const i=q(l);if(o&&l===o&&s){const h=s.latitude!==0||s.longitude!==0;return{prefix:i,candidates:[{hash:l,name:s.name||"Local Node",latitude:h?s.latitude:0,longitude:h?s.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}const n=a[l];if((n==null?void 0:n.latitude)&&(n==null?void 0:n.longitude)&&!(n.latitude===0&&n.longitude===0))return{prefix:i,candidates:[{hash:l,name:n.node_name||n.name||"Destination",latitude:n.latitude,longitude:n.longitude,probability:1,isLocal:!1,isDirectNeighbor:n.zero_hop===!0}],confidence:1,totalMatches:1,isDestination:!0};const d=(n==null?void 0:n.node_name)||(n==null?void 0:n.name)||l.slice(0,8);return{prefix:i,candidates:[{hash:l,name:d,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isDestination:!0}},[l,a,s,o]),u=v.useMemo(()=>Qe(e,a,s,o,c,g),[e,a,s,o,c,g]),b=v.useMemo(()=>{const i=[];y&&i.push(y),i.push(...u.hops),w&&i.push(w);const n=i.reduce((d,h)=>h.confidence===0?0:d*h.confidence,1),m=i.some(d=>d.candidates.some(h=>h.latitude!==0||h.longitude!==0));return{hops:i,overallConfidence:n,hasValidPath:m}},[y,u,w]);return b.hasValidPath?t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-text-muted",children:"Path Confidence:"}),t.jsx("span",{className:We(b.overallConfidence),children:Ge(b.overallConfidence)}),t.jsx("button",{className:"text-text-muted hover:text-text-secondary transition-colors",title:"Confidence is calculated based on how many known nodes match each path prefix. Multiple matches reduce confidence due to collision probability.",children:t.jsx(we,{className:"w-3 h-3"})})]}),t.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-success"}),t.jsx("span",{className:"text-text-muted",children:"Exact"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-secondary"}),t.jsx("span",{className:"text-text-muted",children:"Multi"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-text-muted"}),t.jsx("span",{className:"text-text-muted",children:"Unknown"})]})]})]}),t.jsx("div",{className:"rounded-lg overflow-hidden border border-border-subtle",children:t.jsx(Be,{children:t.jsx(v.Suspense,{fallback:t.jsx("div",{className:"h-[200px] bg-bg-elevated flex items-center justify-center text-text-muted text-sm",children:"Loading map..."}),children:t.jsx(qe,{resolvedPath:b,localNode:s,hubNodes:x,hoveredHopIndex:p,onHoverHop:f})})})}),t.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:b.hops.map((i,n)=>{var M,_,S;const m=i.isSource===!0,d=i.isDestination===!0,h=p===n;let j;return m?j=`Source: ${((M=i.candidates[0])==null?void 0:M.name)||"Unknown"}`:d?j=`Destination: ${((_=i.candidates[0])==null?void 0:_.name)||"Unknown"}`:i.totalMatches===0?j="No matching nodes found":i.totalMatches===1?j=`Exact match: ${((S=i.candidates[0])==null?void 0:S.name)||"Unknown"}`:j=`${i.totalMatches} possible matches (${(i.confidence*100).toFixed(0)}% confidence)`,t.jsxs("div",{className:N("flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-mono cursor-pointer transition-all",h?"bg-accent-primary/20 ring-1 ring-accent-primary/50":"bg-bg-elevated hover:bg-bg-subtle",m&&"border border-accent-success/30",d&&"border border-accent-primary/30"),title:j,onMouseEnter:()=>f(n),onMouseLeave:()=>f(null),children:[m&&t.jsx("span",{className:"text-accent-success text-[8px] mr-0.5",children:"SRC"}),d&&t.jsx("span",{className:"text-accent-primary text-[8px] mr-0.5",children:"DST"}),t.jsx("span",{style:Ye(i.confidence,i.totalMatches),children:i.prefix}),!m&&!d&&i.totalMatches>1&&t.jsxs("span",{className:"text-text-muted",children:["×",i.totalMatches]}),!m&&!d&&i.totalMatches===0&&t.jsx("span",{className:"text-text-muted",children:"?"})]},n)})})]}):t.jsxs("div",{className:"flex items-center justify-center text-text-muted text-xs py-4",children:[t.jsx(fe,{className:"w-3.5 h-3.5 mr-1.5 opacity-50"}),"No location data available for path nodes"]})}function W(e){if(!e)return[];if(Array.isArray(e))return e;try{const a=JSON.parse(e);return Array.isArray(a)?a:[]}catch{return[]}}function Je(e){var a;if(!e)return{text:null,isText:!1};try{if(/^[0-9a-fA-F]+$/.test(e)){const s=((a=e.match(/.{1,2}/g))==null?void 0:a.map(l=>parseInt(l,16)))||[],o=String.fromCharCode(...s),r=o.replace(/[^\x20-\x7E]/g,"");if(r.length>o.length*.7)return{text:r,isText:!0}}if(/^[\x20-\x7E\s]+$/.test(e))return{text:e,isText:!0}}catch{}return{text:null,isText:!1}}function Ze({packet:e,onClose:a}){var U;const[s,o]=v.useState(!1),[r,l]=v.useState(!0),[c,g]=v.useState(null);v.useEffect(()=>{const P=ne=>{ne.key==="Escape"&&a()};window.addEventListener("keydown",P);const E=document.body.style.overflow,te=document.body.style.position,se=document.body.style.width,ae=document.body.style.top,V=window.scrollY;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top=`-${V}px`,()=>{window.removeEventListener("keydown",P),document.body.style.overflow=E,document.body.style.position=te,document.body.style.width=se,document.body.style.top=ae,window.scrollTo(0,V)}},[a]);const x=ce(),p=le(),f=de(),y=e.payload_type_name||k(e.payload_type??e.type),w=e.route_type_name||F(e.route_type??e.route),u=e.payload_length??e.length??0,b=e.tx_delay_ms??0,i=W(e.original_path),n=W(e.forwarded_path),m=i.length>0||n.length>0,d=n.length>0?n:i,h=v.useMemo(()=>{var P;if((P=x==null?void 0:x.config)!=null&&P.repeater)return{latitude:x.config.repeater.latitude,longitude:x.config.repeater.longitude,name:x.config.node_name||"Local Node"}},[x]),j=(x==null?void 0:x.neighbors)??{},M=f.size>0?f:void 0,_=Je(e.payload),S=e.payload&&e.payload.length>0,ee=e.raw_packet&&e.raw_packet.length>0,R=v.useCallback(async(P,E)=>{try{await navigator.clipboard.writeText(P),g(E),setTimeout(()=>g(null),2e3)}catch{}},[]);return me.createPortal(t.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-md z-[10010] flex items-end sm:items-center justify-center",onClick:a,role:"dialog","aria-modal":"true","aria-labelledby":"packet-modal-title",children:t.jsxs("div",{className:N("glass-card w-full max-h-[90vh] overflow-hidden flex flex-col","sm:max-w-xl sm:mx-4 sm:rounded-xl","rounded-t-2xl rounded-b-none sm:rounded-b-xl","pb-safe"),onClick:P=>P.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border-subtle flex-shrink-0",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(I,{packet:e,showLabel:!0,size:"md"}),t.jsxs("div",{children:[t.jsx("h3",{id:"packet-modal-title",className:N("text-base font-semibold",z(y)),children:y}),t.jsx("p",{className:"text-xs text-text-muted",children:ue(e.timestamp)})]})]}),t.jsx("button",{onClick:a,className:"p-2 rounded-lg text-text-muted hover:text-text-primary hover:bg-bg-subtle transition-colors",children:t.jsx(xe,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"overflow-y-auto flex-1 p-4 space-y-4 overscroll-contain",style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(C,{label:"Packet Hash",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(D,{hash:e.packet_hash,size:"sm"}),t.jsx(L,{onClick:()=>R(e.packet_hash,"hash"),copied:c==="hash"})]})}),t.jsx(C,{label:"Route",children:t.jsx("span",{className:N("px-2 py-0.5 rounded text-xs border font-medium",$(w)),children:w})})]}),t.jsx("div",{className:"glass-card p-3 bg-bg-elevated/50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Signal Quality"}),t.jsx("p",{className:"text-sm font-medium text-text-primary",children:he(e.rssi)})]}),t.jsx(O,{rssi:e.rssi,snr:e.snr,showValues:!0})]})}),(e.src_hash||e.dst_hash)&&t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.src_hash&&t.jsx(C,{label:"Source",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(D,{hash:e.src_hash,size:"sm"}),t.jsx(L,{onClick:()=>R(e.src_hash,"src"),copied:c==="src"})]})}),e.dst_hash&&t.jsx(C,{label:"Destination",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(D,{hash:e.dst_hash,size:"sm"}),t.jsx(L,{onClick:()=>R(e.dst_hash,"dst"),copied:c==="dst"})]})})]}),m&&t.jsxs("div",{className:"glass-card p-3 bg-bg-elevated/50",children:[t.jsx("p",{className:"text-xs text-text-muted mb-2",children:"Packet Path"}),t.jsx(He,{originalPath:i,forwardedPath:n})]}),m&&d.length>0&&t.jsxs("div",{className:"glass-card bg-bg-elevated/50 overflow-hidden",children:[t.jsxs("button",{onClick:()=>l(!r),className:"w-full p-3 flex items-center justify-between text-left hover:bg-bg-subtle transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Te,{className:"w-4 h-4 text-accent-primary"}),t.jsx("span",{className:"text-xs text-text-secondary font-medium",children:"Path Map"})]}),r?t.jsx(X,{className:"w-4 h-4 text-text-muted"}):t.jsx(G,{className:"w-4 h-4 text-text-muted"})]}),r&&t.jsx("div",{className:"px-3 pb-3",children:t.jsx(Ke,{path:d,neighbors:j,localNode:h,localHash:x==null?void 0:x.local_hash,srcHash:e.src_hash,dstHash:e.dst_hash,neighborAffinity:M,hubNodes:[...p]})})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsx(C,{label:"Size",compact:!0,children:t.jsxs("span",{className:"font-mono",children:[u,"B"]})}),t.jsx(C,{label:"TX Delay",compact:!0,children:t.jsxs("span",{className:"font-mono",children:[b.toFixed(1),"ms"]})}),t.jsx(C,{label:"Score",compact:!0,children:t.jsx("span",{className:"font-mono",children:e.score!==void 0?e.score.toFixed(3):"—"})})]}),t.jsx(C,{label:"Status",children:t.jsx("span",{className:Le(e),children:Ee(e)})}),S&&t.jsxs("div",{className:"glass-card p-3 bg-bg-elevated/50",children:[t.jsx("p",{className:"text-xs text-text-muted mb-2",children:"Payload"}),_.isText&&_.text?t.jsx("div",{className:"bg-bg-base rounded p-2",children:t.jsx("p",{className:"text-sm text-text-primary font-mono break-all",children:_.text})}):t.jsxs("p",{className:"text-xs text-text-muted font-mono break-all",children:[(U=e.payload)==null?void 0:U.slice(0,100),e.payload&&e.payload.length>100&&"..."]})]}),ee&&t.jsxs("div",{className:"glass-card bg-bg-elevated/50 overflow-hidden",children:[t.jsxs("button",{onClick:()=>o(!s),className:"w-full p-3 flex items-center justify-between text-left hover:bg-bg-subtle transition-colors",children:[t.jsx("span",{className:"text-xs text-text-muted",children:"Raw Packet Hex"}),s?t.jsx(X,{className:"w-4 h-4 text-text-muted"}):t.jsx(G,{className:"w-4 h-4 text-text-muted"})]}),s&&t.jsx("div",{className:"px-3 pb-3",children:t.jsxs("div",{className:"bg-bg-base rounded p-2 relative",children:[t.jsx("pre",{className:"text-[10px] text-text-secondary font-mono break-all whitespace-pre-wrap",children:e.raw_packet}),t.jsx("button",{onClick:()=>R(e.raw_packet,"raw"),className:"absolute top-2 right-2 p-1 rounded bg-bg-elevated hover:bg-bg-subtle transition-colors",children:c==="raw"?t.jsx(Y,{className:"w-3 h-3 text-accent-success"}):t.jsx(B,{className:"w-3 h-3 text-text-muted"})})]})})]})]})]})}),document.body)}function C({label:e,children:a,compact:s=!1}){return t.jsxs("div",{className:N("flex flex-col",s?"gap-0.5":"gap-1"),children:[t.jsx("span",{className:"text-[10px] text-text-muted uppercase tracking-wide",children:e}),t.jsx("span",{className:N("text-text-primary",s?"text-xs":"text-sm"),children:a})]})}function L({onClick:e,copied:a}){return t.jsx("button",{onClick:s=>{s.stopPropagation(),e()},className:"p-1 rounded hover:bg-bg-subtle transition-colors",children:a?t.jsx(Y,{className:"w-3 h-3 text-accent-success"}):t.jsx(B,{className:"w-3 h-3 text-text-muted"})})}function He({originalPath:e,forwardedPath:a}){const s=a.length>0?a:e;return s.length===0?t.jsx("span",{className:"text-xs text-text-muted",children:"No path data"}):t.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:s.map((o,r)=>t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(D,{hash:o,size:"xs"}),r<s.length-1&&t.jsx(K,{className:"w-3 h-3 text-text-muted flex-shrink-0"})]},r))})}const ct=v.memo(Ze);export{K as A,rt as C,ot as P,De as R,it as a,ct as b,Z as c,Q as d,Se as e,k as g};
