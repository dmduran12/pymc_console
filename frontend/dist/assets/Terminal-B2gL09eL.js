import{e as xe,a1 as he,a2 as ve,a3 as j,a4 as be,a5 as we,a6 as Oe,$ as Pe,j as r,a7 as Se}from"./index-9PgEMz2d.js";import{b as u,c as R}from"./recharts-CHDYrIv-.js";import"./maplibre-gl-Cg9ukl_k.js";const $e=[{name:"get adc.multiplier",category:"get",params:[],description:"Get ADC multiplier for battery",serialOnly:!1,hasParam:!1},{name:"get advert.interval",category:"get",params:[],description:"Get local advert interval (minutes)",serialOnly:!1,hasParam:!1},{name:"get af",category:"get",params:[],description:"Get airtime factor",serialOnly:!1,hasParam:!1},{name:"get agc.reset.interval",category:"get",params:[],description:"Get AGC reset interval (seconds)",serialOnly:!1,hasParam:!1},{name:"get allow.read.only",category:"get",params:[],description:"Get read-only access setting",serialOnly:!1,hasParam:!1},{name:"get bridge.baud",category:"get",params:[],description:"Get bridge baud rate",serialOnly:!1,hasParam:!1},{name:"get bridge.channel",category:"get",params:[],description:"Get bridge channel (ESP-NOW)",serialOnly:!1,hasParam:!1},{name:"get bridge.delay",category:"get",params:[],description:"Get bridge delay (ms)",serialOnly:!1,hasParam:!1},{name:"get bridge.enabled",category:"get",params:[],description:"Get bridge enabled status",serialOnly:!1,hasParam:!1},{name:"get bridge.secret",category:"get",params:[],description:"Get bridge encryption secret",serialOnly:!1,hasParam:!1},{name:"get bridge.source",category:"get",params:[],description:"Get bridge packet source",serialOnly:!1,hasParam:!1},{name:"get bridge.type",category:"get",params:[],description:"Get bridge type (rs232/espnow/none)",serialOnly:!1,hasParam:!1},{name:"get direct.txdelay",category:"get",params:[],description:"Get direct TX delay factor",serialOnly:!1,hasParam:!1},{name:"get flood.advert.interval",category:"get",params:[],description:"Get flood advert interval (hours)",serialOnly:!1,hasParam:!1},{name:"get flood.max",category:"get",params:[],description:"Get max flood hops",serialOnly:!1,hasParam:!1},{name:"get freq",category:"get",params:[],description:"Get frequency (MHz)",serialOnly:!1,hasParam:!1},{name:"get guest.password",category:"get",params:[],description:"Get guest password",serialOnly:!1,hasParam:!1},{name:"get int.thresh",category:"get",params:[],description:"Get interference threshold",serialOnly:!1,hasParam:!1},{name:"get lat",category:"get",params:[],description:"Get latitude",serialOnly:!1,hasParam:!1},{name:"get lon",category:"get",params:[],description:"Get longitude",serialOnly:!1,hasParam:!1},{name:"get multi.acks",category:"get",params:[],description:"Get multi-ack setting",serialOnly:!1,hasParam:!1},{name:"get name",category:"get",params:[],description:"Get node name",serialOnly:!1,hasParam:!1},{name:"get prv.key",category:"get",params:[],description:"Get private key (serial only)",serialOnly:!0,hasParam:!1},{name:"get public.key",category:"get",params:[],description:"Get public key (hex)",serialOnly:!1,hasParam:!1},{name:"get radio",category:"get",params:[],description:"Get radio params (freq,bw,sf,cr)",serialOnly:!1,hasParam:!1},{name:"get repeat",category:"get",params:[],description:"Get repeat/forward status (on/off)",serialOnly:!1,hasParam:!1},{name:"get role",category:"get",params:[],description:"Get device role",serialOnly:!1,hasParam:!1},{name:"get rxdelay",category:"get",params:[],description:"Get RX delay base",serialOnly:!1,hasParam:!1},{name:"get tx",category:"get",params:[],description:"Get TX power (dBm)",serialOnly:!1,hasParam:!1},{name:"get txdelay",category:"get",params:[],description:"Get TX delay factor",serialOnly:!1,hasParam:!1},{name:"gps",category:"gps",params:[],description:"Show GPS status",serialOnly:!1,hasParam:!1},{name:"gps advert",category:"gps",params:[],description:"Get/set GPS advert location policy",serialOnly:!1,hasParam:!0},{name:"gps off",category:"gps",params:[],description:"Disable GPS",serialOnly:!1,hasParam:!0},{name:"gps on",category:"gps",params:[],description:"Enable GPS",serialOnly:!1,hasParam:!0},{name:"gps setloc",category:"gps",params:[],description:"Set node location from GPS",serialOnly:!1,hasParam:!0},{name:"gps sync",category:"gps",params:[],description:"Sync time from GPS",serialOnly:!1,hasParam:!0},{name:"log",category:"logging",params:[],description:"Dump log file (serial only)",serialOnly:!0,hasParam:!1},{name:"log erase",category:"logging",params:[],description:"Erase log file",serialOnly:!1,hasParam:!0},{name:"log start",category:"logging",params:[],description:"Start packet logging",serialOnly:!1,hasParam:!0},{name:"log stop",category:"logging",params:[],description:"Stop packet logging",serialOnly:!1,hasParam:!0},{name:"neighbor.remove",category:"neighbor",params:[],description:"Remove neighbor by pubkey",serialOnly:!1,hasParam:!0},{name:"neighbors",category:"neighbor",params:[],description:"List neighbors",serialOnly:!1,hasParam:!1},{name:"get",category:"other",params:[],description:"Execute get command",serialOnly:!1,hasParam:!0},{name:"set",category:"other",params:[{name:"value",type:"float"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Execute set command",serialOnly:!1,hasParam:!0},{name:"tempradio",category:"radio",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Apply temporary radio params (freq bw sf cr timeout_mins)",serialOnly:!1,hasParam:!0},{name:"sensor get",category:"sensor",params:[],description:"Get sensor/custom variable value",serialOnly:!1,hasParam:!0},{name:"sensor list",category:"sensor",params:[{name:"value",type:"int"}],description:"List all sensor/custom variables",serialOnly:!1,hasParam:!0},{name:"sensor set",category:"sensor",params:[],description:"Set sensor/custom variable value",serialOnly:!1,hasParam:!0},{name:"set adc.multiplier",category:"set",params:[{name:"value",type:"float"}],description:"Set ADC multiplier",serialOnly:!1,hasParam:!0},{name:"set advert.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"string"}],description:"Set local advert interval (60-240 min, 0=off)",serialOnly:!1,hasParam:!0},{name:"set af",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set airtime factor (0-9)",serialOnly:!1,hasParam:!0},{name:"set agc.reset.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set AGC reset interval (seconds, rounded to 4)",serialOnly:!1,hasParam:!0},{name:"set allow.read.only",category:"set",params:[{name:"value",type:"int"}],description:"Set read-only access (on/off)",serialOnly:!1,hasParam:!0},{name:"set bridge.baud",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set bridge baud (9600-115200)",serialOnly:!1,hasParam:!0},{name:"set bridge.channel",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"string"}],description:"Set bridge channel (1-14)",serialOnly:!1,hasParam:!0},{name:"set bridge.delay",category:"set",params:[{name:"value",type:"int"}],description:"Set bridge delay (0-10000 ms)",serialOnly:!1,hasParam:!0},{name:"set bridge.enabled",category:"set",params:[{name:"value",type:"int"}],description:"Enable/disable bridge",serialOnly:!1,hasParam:!0},{name:"set bridge.secret",category:"set",params:[{name:"value",type:"string"},{name:"value",type:"float"}],description:"Set bridge encryption secret",serialOnly:!1,hasParam:!0},{name:"set bridge.source",category:"set",params:[{name:"value",type:"int"}],description:"Set bridge source (rx/tx)",serialOnly:!1,hasParam:!0},{name:"set direct.txdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set direct TX delay factor",serialOnly:!1,hasParam:!0},{name:"set flood.advert.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set flood advert interval (3-48 hours, 0=off)",serialOnly:!1,hasParam:!0},{name:"set flood.max",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"float"}],description:"Set max flood hops (0-64)",serialOnly:!1,hasParam:!0},{name:"set freq",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set frequency MHz (serial only, reboot required)",serialOnly:!0,hasParam:!0},{name:"set guest.password",category:"set",params:[{name:"value",type:"string"}],description:"Set guest password",serialOnly:!1,hasParam:!0},{name:"set int.thresh",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set interference threshold",serialOnly:!1,hasParam:!0},{name:"set lat",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set latitude",serialOnly:!1,hasParam:!0},{name:"set lon",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set longitude",serialOnly:!1,hasParam:!0},{name:"set multi.acks",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set multi-ack (0/1)",serialOnly:!1,hasParam:!0},{name:"set name",category:"set",params:[{name:"value",type:"string"},{name:"value",type:"int"}],description:"Set node name",serialOnly:!1,hasParam:!0},{name:"set prv.key",category:"set",params:[{name:"value",type:"string"}],description:"Set private key (serial only)",serialOnly:!0,hasParam:!0},{name:"set radio",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set radio params (freq bw sf cr)",serialOnly:!1,hasParam:!0},{name:"set repeat",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set repeat/forward (on/off)",serialOnly:!1,hasParam:!0},{name:"set rxdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set RX delay base",serialOnly:!1,hasParam:!0},{name:"set tx",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"float"}],description:"Set TX power (dBm)",serialOnly:!1,hasParam:!0},{name:"set txdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set TX delay factor",serialOnly:!1,hasParam:!0},{name:"stats-core",category:"stats",params:[],description:"Show core statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"stats-packets",category:"stats",params:[],description:"Show packet statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"stats-radio",category:"stats",params:[],description:"Show radio statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"advert",category:"system",params:[],description:"Send self advertisement",serialOnly:!1,hasParam:!1},{name:"board",category:"system",params:[],description:"Show board/manufacturer name",serialOnly:!1,hasParam:!1},{name:"clear stats",category:"system",params:[],description:"Reset statistics counters",serialOnly:!1,hasParam:!0},{name:"clock",category:"system",params:[{name:"value",type:"int"}],description:"Display current time",serialOnly:!1,hasParam:!0},{name:"clock sync",category:"system",params:[],description:"Sync clock from sender timestamp",serialOnly:!1,hasParam:!0},{name:"password",category:"system",params:[{name:"value",type:"string"}],description:"Change admin password",serialOnly:!1,hasParam:!0},{name:"reboot",category:"system",params:[],description:"Reboot the device",serialOnly:!1,hasParam:!1},{name:"start ota",category:"system",params:[{name:"value",type:"int"}],description:"Start OTA firmware update",serialOnly:!1,hasParam:!0},{name:"time",category:"system",params:[{name:"value",type:"int"}],description:"Set time to epoch seconds",serialOnly:!1,hasParam:!0},{name:"ver",category:"system",params:[],description:"Show firmware version and build date",serialOnly:!1,hasParam:!1}],le=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const m=Math.random()*16|0;return(n==="x"?m:m&3|8).toString(16)}),ce=`██████  ██    ██ ███    ███  ██████         ████████ ███████ ██████  ███    ███ ██ ███    ██  █████  ██      
██   ██  ██  ██  ████  ████ ██                 ██    ██      ██   ██ ████  ████ ██ ████   ██ ██   ██ ██      
██████    ████   ██ ████ ██ ██                 ██    █████   ██████  ██ ████ ██ ██ ██ ██  ██ ███████ ██      
██         ██    ██  ██  ██ ██                 ██    ██      ██   ██ ██  ██  ██ ██ ██  ██ ██ ██   ██ ██      
██         ██    ██      ██  ██████ ███████    ██    ███████ ██   ██ ██      ██ ██ ██   ████ ██   ██ ███████`,B=[{cmd:"help",desc:"Show available commands"},{cmd:"clear",desc:"Clear terminal screen"},{cmd:"status",desc:"Get repeater status summary"},{cmd:"uptime",desc:"Show system uptime"},{cmd:"packets",desc:"Show packet statistics"},{cmd:"board",desc:"Show board/platform info"},...$e.filter(n=>!n.serialOnly).filter(n=>!n.name.startsWith("gps")).filter(n=>!n.name.startsWith("bridge")).filter(n=>!n.name.startsWith("sensor")).filter(n=>n.name!=="start ota").filter(n=>n.name!=="erase").filter(n=>n.name!=="reboot").map(n=>({cmd:n.name,desc:n.description,params:n.hasParam?"{value}":void 0,required:n.hasParam}))],me={"set mode":["forward","monitor"],"set duty":["on","off"],"set repeat":["on","off"],"set allow.read.only":["on","off"],"set multi.acks":["0","1"],"set tx":["10","14","17","20","22"],"set sf":["7","8","9","10","11","12"],"set bw":["125","250","500"],"set freq":["906.875","915.0","920.0"],"set radio":["906.875 250 10 5","915.0 125 7 5"],tempradio:["906.875 250 10 5","915.0 125 7 5","920.0 500 12 8"],"set af":["0.5","1.0","1.5","2.0"],"set txdelay":["0.5","0.7","1.0","1.5"],"set direct.txdelay":["0.3","0.5","0.7"],"set rxdelay":["0","0.5","1.0"],"set advert.interval":["0","60","120","180"],"set flood.advert.interval":["0","6","12","24"],"set flood.max":["0","3","5","10"],"set agc.reset.interval":["0","60","300"],"set int.thresh":["10","14","18","22"],"set log":["debug","info","warning"]};function Ne(n){return n.includes("Batt:")&&n.includes("|")}function _e(n){const m=[],d=n.split(" | ");for(const w of d){const g=w.indexOf(":");if(g===-1)continue;const h=w.substring(0,g).trim(),y=w.substring(g+1).trim();let p="normal";if(h==="Batt"){const x=parseFloat(y);x<3.3?p="critical":x<3.6?p="warning":p="good"}else if(h==="RSSI"){const x=parseInt(y);x<-120?p="critical":x<-100?p="warning":p="good"}else h==="SNR"?parseFloat(y)<0?p="warning":p="good":(h==="Err"&&parseInt(y)>0||h==="TxQ"&&parseInt(y)>5)&&(p="warning");m.push({label:h,value:y,status:p})}return m}const ke=u.memo(function({visible:m}){return r.jsx("span",{className:R("inline-block w-2 h-5 bg-accent-primary ml-0.5 align-middle",m?"opacity-100":"opacity-0"),"aria-hidden":"true"})});function A(n){switch(n){case"success":return"text-accent-success";case"error":return"text-accent-danger";case"warning":return"text-amber-400";case"info":return"text-accent-tertiary";case"value":return"text-accent-primary";default:return"text-text-secondary"}}function je(n,m){if(n.startsWith("HELP_HEADER:::"))return[{text:n.slice(14),color:"text-text-primary font-bold"}];if(n.startsWith("HELP_NOTE:::"))return[{text:n.slice(12),color:"text-text-muted italic"}];const d=n.match(/^([a-z][a-z0-9.]*(?:\s+[a-z][a-z0-9.]*)?):::(.+)$/);if(d){const[,g,h]=d,y=g.split(" "),p=[],x=y[0];let b="text-accent-tertiary";x==="get"?b="text-accent-success":x==="set"&&(b="text-amber-400"),p.push({text:`  ${x}`,color:`${b} font-semibold`}),y.length>1&&p.push({text:` ${y.slice(1).join(" ")}`,color:"text-accent-primary"});const L=" ".repeat(Math.max(1,20-g.length));return p.push({text:`${L}${h}`,color:"text-text-muted"}),p}if(m==="error"||m==="warning")return[{text:n,color:A(m)}];if(m==="value")return[{text:n,color:A("value")}];const w=n.match(/^([\w\s.]+):\s*(.+)$/);if(w){const[,g,h]=w;return[{text:`${g}: `,color:"text-text-muted"},{text:h,color:"text-accent-primary font-semibold"}]}return n.startsWith("OK")?[{text:n,color:A("success")}]:[{text:n,color:A(m)}]}const Ee=u.memo(function({items:m,nodeName:d}){const w={normal:"text-text-primary",good:"text-accent-success",warning:"text-amber-400",critical:"text-accent-danger"};return r.jsxs("div",{className:"mt-2 p-3 rounded-lg bg-bg-subtle border border-border-subtle",children:[r.jsxs("div",{className:"text-center text-accent-primary text-xs font-semibold uppercase tracking-wide mb-3 pb-2 border-b border-border-subtle",children:[d," Status"]}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2",children:m.map(g=>r.jsxs("div",{className:"flex justify-between items-center px-2 py-1 rounded bg-bg-elevated border border-border-subtle",children:[r.jsx("span",{className:"text-text-muted text-xs uppercase",children:g.label}),r.jsx("span",{className:R("text-xs font-semibold",w[g.status]),children:g.value})]},g.label))})]})}),Ce=u.memo(function({entry:m,nodeName:d}){const g=m.cmd.trim().toLowerCase()==="status"&&m.result&&Ne(m.result)?_e(m.result):null;return r.jsxs("div",{className:"py-2 border-b border-white/5 last:border-b-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-text-muted font-medium select-none",children:"$"}),r.jsx("span",{className:"text-text-primary font-semibold",children:m.cmd})]}),m.isProcessing?r.jsx("div",{className:"mt-1 ml-4 text-text-muted italic",children:"processing..."}):g?r.jsx(Ee,{items:g,nodeName:d}):m.result?r.jsx("div",{className:"mt-1 ml-4 font-mono text-[13px]",children:m.result.split(`
`).map((h,y)=>{const p=je(h,m.outputType);return r.jsx("div",{className:"leading-relaxed",children:p.map((x,b)=>r.jsx("span",{className:x.color,children:x.text},b))},y)})}):null]})}),K=u.memo(function({text:m,status:d}){return r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[d==="pending"&&r.jsx("span",{className:"text-text-muted",children:"○"}),d==="active"&&r.jsx("span",{className:"text-accent-secondary animate-pulse",children:"●"}),d==="done"&&r.jsx("span",{className:"text-accent-success",children:"✓"}),d==="error"&&r.jsx("span",{className:"text-accent-danger",children:"✗"}),r.jsx("span",{className:R(d==="pending"&&"text-text-muted",d==="active"&&"text-accent-secondary",d==="done"&&"text-accent-success",d==="error"&&"text-accent-danger"),children:m})]})});function Ie(){var Q;const n=xe(),m=((Q=n==null?void 0:n.config)==null?void 0:Q.node_name)||(n==null?void 0:n.node_name)||"pymc",[d,w]=u.useState("initializing"),[g,h]=u.useState(0),[y,p]=u.useState([]),[x,b]=u.useState(""),[L,de]=u.useState(!0),[$,G]=u.useState(-1),[F,E]=u.useState(!1),[N,T]=u.useState([]),[I,H]=u.useState(0),q=u.useRef(null),D=u.useRef(null),z=u.useRef(null),X=u.useRef(!1);u.useEffect(()=>{if(X.current)return;X.current=!0,(async()=>{h(1),await new Promise(o=>setTimeout(o,600)),w("checking"),h(2),await new Promise(o=>setTimeout(o,800)),h(3),await new Promise(o=>setTimeout(o,400)),w("connected")})()},[]),u.useEffect(()=>(z.current=setInterval(()=>{de(l=>!l)},530),()=>{z.current&&clearInterval(z.current)}),[]),u.useEffect(()=>{D.current&&(D.current.scrollTop=D.current.scrollHeight)},[y]);const ue=u.useCallback(()=>{q.current&&d==="connected"&&q.current.focus()},[d]),M=u.useCallback(l=>{const o=l.trim().toLowerCase();if(!o){E(!1),T([]);return}const s=o.includes(" ");let O=[];if(s){const _=o.split(" "),U=_.slice(0,-1).join(" "),t=_[_.length-1],S=B.find(P=>P.cmd.toLowerCase()===U);S&&me[S.cmd]&&(O=me[S.cmd].filter(P=>P.toLowerCase().startsWith(t)).map(P=>({cmd:`${S.cmd} ${P}`,desc:`${S.desc} → ${P}`})))}else O=B.filter(_=>_.cmd.toLowerCase().startsWith(o));O.length>0?(T(O.slice(0,8)),H(0),E(!0)):(E(!1),T([]))},[]),W=u.useCallback(l=>{var s;const o=N[l];o&&(o.required&&o.params?(b(o.cmd+" "),M(o.cmd+" ")):(b(o.cmd),E(!1),T([])),(s=q.current)==null||s.focus())},[N,M]),V=u.useCallback(async l=>{var S,P,J,Y,Z,ee,te,ae,re,se,ne,oe,ie;const o=l.trim();if(!o)return;const s=o.toLowerCase();if(s==="clear"){p([]);return}if(s==="help"){const i=B.map(e=>`${e.cmd}:::${e.desc}`).join(`
`),k={id:le(),cmd:o,result:`HELP_HEADER:::Available commands
${i}
HELP_NOTE:::Commands use existing API endpoints. Some MeshCore CLI commands are not available via HTTP.`,outputType:"default",isProcessing:!1,timestamp:Date.now()};p(e=>[...e,k]);return}const O=le();let _="default";const U={id:O,cmd:o,result:null,outputType:"default",isProcessing:!0,timestamp:Date.now()};p(i=>[...i,U]);const t=(i,k=_)=>{p(e=>e.map(a=>a.id===O?{...a,isProcessing:!1,result:i,outputType:k}:a))};try{const i=await he(),k=e=>{const a=Math.floor(e/86400),c=Math.floor(e%86400/3600),f=Math.floor(e%3600/60);return a>0?`${a}d ${c}h ${f}m`:c>0?`${c}h ${f}m`:`${f}m`};if(s==="status"){const e=((P=(S=i.config)==null?void 0:S.repeater)==null?void 0:P.mode)||"unknown",a=(Y=(J=i.config)==null?void 0:J.duty_cycle)!=null&&Y.enforcement_enabled?"enabled":"disabled",c=Object.keys(i.neighbors||{}).length,f=k(i.uptime_seconds||0);t(`Mode: ${e} | Duty Cycle: ${a}
Neighbors: ${c} | Uptime: ${f}`,"info");return}if(s==="ver"||s==="version"){const e=i.version||"unknown",a=i.core_version||"unknown";t(`pyMC Repeater v${e}
pyMC Core v${a}`,"info");return}if(s==="clock"){t(new Date().toLocaleString(),"value");return}if(s==="uptime"){t(k(i.uptime_seconds||0),"value");return}if(s==="neighbors"){const e=i.neighbors||{},a=Object.entries(e);if(a.length===0)t("No neighbors discovered yet.","warning");else{const c=a.map(([f,v])=>{const C=v.name||v.node_name||"Unknown",ge=v.rssi!=null?`${v.rssi}dBm`:"?",ye=v.snr!=null?`${v.snr}dB`:"?";return`  ${f.slice(0,8)}  ${C.padEnd(16)} RSSI:${ge.padStart(6)} SNR:${ye.padStart(5)}`});t(`Neighbors (${a.length}):
${c.join(`
`)}`,"info")}return}if(s==="packets"){t(`rx: ${i.rx_count??"?"}
tx: ${i.tx_count??"?"}
fwd: ${i.forwarded_count??"?"}
drop: ${i.dropped_count??"?"}`,"info");return}if(s.startsWith("get ")){const e=s.slice(4).trim(),a=(Z=i.config)==null?void 0:Z.radio,c=(ee=i.config)==null?void 0:ee.repeater,f=(te=i.config)==null?void 0:te.delays;switch(e){case"name":t(((ae=i.config)==null?void 0:ae.node_name)||"Unknown","value");return;case"public.key":t(i.public_key||"Not available","value");return;case"role":t("repeater","value");return;case"radio":{if(!a){t("Radio config not available","warning");return}const v=a.frequency?(a.frequency/1e6).toFixed(3):"?",C=a.bandwidth?a.bandwidth/1e3:"?";t(`${v},${C},${a.spreading_factor||"?"},${a.coding_rate||"?"}`,"value");return}case"freq":t(a!=null&&a.frequency?(a.frequency/1e6).toFixed(3):"?","value");return;case"tx":t(String((a==null?void 0:a.tx_power)??"?"),"value");return;case"af":t(String((f==null?void 0:f.tx_delay_factor)??"1.0"),"value");return;case"rxdelay":t("0","value");return;case"txdelay":t(String((f==null?void 0:f.tx_delay_factor)??"1.0"),"value");return;case"direct.txdelay":t(String((f==null?void 0:f.direct_tx_delay_factor)??"0.5"),"value");return;case"repeat":t((c==null?void 0:c.mode)==="forward"?"on":"off","value");return;case"lat":t(String((c==null?void 0:c.latitude)??"0"),"value");return;case"lon":t(String((c==null?void 0:c.longitude)??"0"),"value");return;case"advert.interval":t(String(((c==null?void 0:c.send_advert_interval_hours)??2)*60),"value");return;case"flood.advert.interval":t(String((c==null?void 0:c.send_advert_interval_hours)??24),"value");return;case"flood.max":t("3","value");return;case"agc.reset.interval":t("0","value");return;case"allow.read.only":t("off","value");return;case"guest.password":t("(not exposed via HTTP)","warning");return;case"multi.acks":t("0","value");return;case"int.thresh":t("0","value");return;case"mode":t((c==null?void 0:c.mode)||"forward","value");return;default:t(`Unknown parameter: ${e}`,"error");return}}if(s==="board"){t("pyMC_Repeater (Linux/RPi)","value");return}if(s==="stats-packets"){try{const e=await ve(24);e.success&&e.data?t(`rx: ${i.rx_count??0}
tx: ${i.tx_count??0}
fwd: ${i.forwarded_count??0}
drop: ${i.dropped_count??0}`,"info"):t(`rx: ${i.rx_count??0}, tx: ${i.tx_count??0}`,"info")}catch{t(`rx: ${i.rx_count??0}, tx: ${i.tx_count??0}`,"info")}return}if(s==="stats-radio"){const e=(re=i.config)==null?void 0:re.radio;t(`freq: ${e!=null&&e.frequency?(e.frequency/1e6).toFixed(3):"?"} MHz
bw: ${e!=null&&e.bandwidth?e.bandwidth/1e3:"?"} kHz
sf: ${(e==null?void 0:e.spreading_factor)??"?"}
cr: ${(e==null?void 0:e.coding_rate)??"?"}
tx_pwr: ${(e==null?void 0:e.tx_power)??"?"} dBm
noise: ${i.noise_floor_dbm??"?"} dBm`,"info");return}if(s==="stats-core"){t(`uptime: ${k(i.uptime_seconds||0)}
rx/hr: ${((se=i.rx_per_hour)==null?void 0:se.toFixed(1))??"?"}
fwd/hr: ${((ne=i.forwarded_per_hour)==null?void 0:ne.toFixed(1))??"?"}
neighbors: ${Object.keys(i.neighbors||{}).length}
airtime: ${((oe=i.utilization_percent)==null?void 0:oe.toFixed(1))??"?"}%`,"info");return}if(s==="clear stats"){t("Error: Not implemented in pyMC_Repeater","error");return}if(s.startsWith("tempradio ")){const e=s.split(/\s+/);if(e.length<5){t(`Usage: tempradio <freq_mhz> <bw_khz> <sf> <cr>
Example: tempradio 906.875 250 10 5`,"warning");return}const a=parseFloat(e[1]),c=parseInt(e[2]),f=parseInt(e[3]),v=parseInt(e[4]);if(isNaN(a)||a<100||a>1e3){t("Error: Frequency must be in MHz (e.g., 906.875)","error");return}if(![125,250,500].includes(c)){t("Error: Bandwidth must be 125, 250, or 500 kHz","error");return}if(isNaN(f)||f<5||f>12){t("Error: Spreading factor must be 5-12","error");return}if(isNaN(v)||v<5||v>8){t("Error: Coding rate must be 5-8","error");return}const C=await j({frequency_mhz:a,bandwidth_khz:c,spreading_factor:f,coding_rate:v});C.success?t(`OK - Radio: ${a}MHz, ${c}kHz, SF${f}, CR4/${v}
Note: Changes persist. Restart service to revert.`,"success"):t(`Error: ${C.error||"Failed to update radio config"}`,"error");return}if(s.startsWith("neighbor.remove ")){t("Error: neighbor.remove not implemented via HTTP","error");return}if(s.startsWith("password ")){t("Error: Use config.yaml to change password","error");return}if(s==="log start"||s==="log stop"||s==="log erase"){t("Error: Log commands not implemented via HTTP","error");return}if(s==="advert"){const e=await be();t(e.success?"OK - Advert sent":`Error: ${e.error||"Failed"}`,e.success?"success":"error");return}if(s.startsWith("set mode ")){const e=s.split(" ")[2];if(e!=="forward"&&e!=="monitor"){t('Error: Mode must be "forward" or "monitor"',"error");return}const a=await we(e);t(a.success?`OK - Mode set to ${e}`:"Error: Failed to set mode",a.success?"success":"error");return}if(s.startsWith("set duty ")){const e=s.split(" ")[2],a=e==="on"||e==="1"||e==="true",c=await Oe(a);t(c.success?`OK - Duty cycle ${a?"enabled":"disabled"}`:"Error: Failed to set duty cycle",c.success?"success":"error");return}if(s.startsWith("set log ")){const e=(ie=s.split(" ")[2])==null?void 0:ie.toUpperCase();if(!["DEBUG","INFO","WARNING","ERROR"].includes(e)){t("Error: Level must be debug, info, warning, or error","error");return}const a=await Pe(e);t(a.success?`OK - Log level set to ${e}. Service restarting...`:`Error: ${a.error||"Failed"}`,a.success?"success":"error");return}if(s.startsWith("set tx ")){const e=parseInt(s.split(" ")[2]);if(isNaN(e)||e<2||e>22){t("Error: TX power must be 2-22 dBm","error");return}const a=await j({tx_power:e});t(a.success?`OK - TX power set to ${e}dBm. Restart service to apply.`:`Error: ${a.error||"Failed"}`,a.success?"success":"error");return}if(s.startsWith("set freq ")){const e=parseFloat(s.split(" ")[2]);if(isNaN(e)||e<100||e>1e3){t("Error: Frequency must be in MHz (e.g., 906.875)","error");return}const a=await j({frequency_mhz:e});t(a.success?`OK - Frequency set to ${e}MHz. Restart service to apply.`:`Error: ${a.error||"Failed"}`,a.success?"success":"error");return}if(s.startsWith("set sf ")){const e=parseInt(s.split(" ")[2]);if(isNaN(e)||e<5||e>12){t("Error: Spreading factor must be 5-12","error");return}const a=await j({spreading_factor:e});t(a.success?`OK - SF set to ${e}. Restart service to apply.`:`Error: ${a.error||"Failed"}`,a.success?"success":"error");return}if(s.startsWith("set bw ")){const e=parseInt(s.split(" ")[2]);if(![125,250,500].includes(e)){t("Error: Bandwidth must be 125, 250, or 500 kHz","error");return}const a=await j({bandwidth_khz:e});t(a.success?`OK - Bandwidth set to ${e}kHz. Restart service to apply.`:`Error: ${a.error||"Failed"}`,a.success?"success":"error");return}if(s.startsWith("set txdelay ")||s.startsWith("set af ")){const e=parseFloat(s.split(" ")[2]);if(isNaN(e)||e<0||e>5){t("Error: TX delay factor must be 0.0-5.0","error");return}const a=await j({tx_delay_factor:e});t(a.success?`OK - TX delay set to ${e}. Restart service to apply.`:`Error: ${a.error||"Failed"}`,a.success?"success":"error");return}if(s.startsWith("set direct.txdelay ")){const e=parseFloat(s.split(" ")[2]);if(isNaN(e)||e<0||e>5){t("Error: Direct TX delay factor must be 0.0-5.0","error");return}const a=await j({direct_tx_delay_factor:e});t(a.success?`OK - Direct TX delay set to ${e}. Restart service to apply.`:`Error: ${a.error||"Failed"}`,a.success?"success":"error");return}t(`Unknown command: ${o}
Type 'help' for available commands.`,"error")}catch(i){t(`Error: ${i instanceof Error?i.message:"Command failed"}`,"error")}},[]),pe=u.useCallback(l=>{if(F&&N.length>0){if(l.key==="ArrowDown"){l.preventDefault(),H(o=>Math.min(o+1,N.length-1));return}else if(l.key==="ArrowUp"){l.preventDefault(),H(o=>Math.max(o-1,0));return}else if(l.key==="Tab"){l.preventDefault(),W(I);return}else if(l.key==="Escape"){l.preventDefault(),E(!1);return}}if(l.key==="Enter"){l.preventDefault();const o=x;b(""),G(-1),E(!1),V(o)}else if(l.key==="ArrowUp"){l.preventDefault();const o=y.filter(s=>s.cmd).map(s=>s.cmd);if(o.length>0){const s=$<o.length-1?$+1:$;G(s),b(o[o.length-1-s]||"")}}else if(l.key==="ArrowDown")if(l.preventDefault(),$>0){const o=y.filter(O=>O.cmd).map(O=>O.cmd),s=$-1;G(s),b(o[o.length-1-s]||"")}else $===0&&(G(-1),b(""))},[x,y,$,V,F,N,I,W]),fe=u.useCallback(l=>{const o=l.target.value;b(o),M(o)},[M]);return r.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Se,{className:"w-6 h-6 text-accent-primary"}),r.jsx("h1",{className:"text-xl font-semibold text-text-primary",children:"Terminal"})]}),r.jsxs("div",{className:"glass-card overflow-hidden flex flex-col",style:{height:"calc(100vh - 180px)",minHeight:"400px"},onClick:ue,children:[r.jsx("div",{ref:D,className:"flex-1 flex flex-col-reverse overflow-y-auto font-mono text-sm bg-black/40",children:r.jsxs("div",{className:"p-4 sm:p-5",children:[d!=="connected"&&r.jsxs("div",{className:"mb-6",children:[r.jsx("pre",{className:"text-accent-primary text-[0.5rem] sm:text-[0.6rem] lg:text-xs leading-none mb-6 overflow-x-auto",children:ce}),r.jsx(K,{text:"Initializing terminal...",status:g>=1?g===1?"active":"done":"pending"}),r.jsx(K,{text:"Checking repeater connection...",status:g>=2?g===2?"active":"done":"pending"}),r.jsx(K,{text:d==="error"?"Connection failed":"Connection established",status:g>=3?d==="error"?"error":"done":"pending"})]}),d==="connected"&&y.length===0&&r.jsxs("div",{className:"text-center py-8",children:[r.jsx("pre",{className:"text-accent-primary/60 text-[0.45rem] sm:text-[0.5rem] lg:text-[0.55rem] leading-none mb-4 overflow-x-auto inline-block",children:ce}),r.jsx("p",{className:"text-text-muted text-sm",children:"Type a command below or 'help' for available commands"})]}),y.map(l=>r.jsx(Ce,{entry:l,nodeName:m},l.id))]})}),d==="connected"&&r.jsxs("div",{className:"relative border-t border-white/10 bg-black/50",children:[F&&N.length>0&&r.jsxs("div",{className:"absolute left-0 right-0 bottom-full bg-bg-elevated border-t border-x border-border-subtle rounded-t-lg shadow-2xl overflow-hidden z-10 mx-2 mb-0",children:[r.jsx("div",{className:"max-h-64 overflow-y-auto",children:N.map((l,o)=>r.jsx("div",{onClick:()=>W(o),className:R("px-4 py-2.5 cursor-pointer border-b border-border-subtle/50 last:border-b-0 transition-colors",o===I?"bg-accent-primary/20":"hover:bg-white/5"),children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:R("font-mono text-sm font-semibold",o===I?"text-accent-primary":"text-text-primary"),children:l.cmd}),l.params&&r.jsx("span",{className:"text-xs text-text-muted font-mono",children:l.params}),r.jsx("span",{className:"flex-1"}),r.jsx("span",{className:"text-xs text-text-muted truncate max-w-[200px]",children:l.desc})]})},l.cmd))}),r.jsx("div",{className:"px-3 py-1.5 bg-bg-subtle border-t border-border-subtle flex justify-end",children:r.jsx("span",{className:"text-[10px] text-text-muted",children:"↑↓ Navigate • Tab Select • Enter Run"})})]}),r.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[r.jsx("span",{className:"text-text-muted font-mono font-bold select-none",children:"$"}),r.jsx("input",{ref:q,type:"text",value:x,onChange:fe,onKeyDown:pe,placeholder:"Enter command...",className:"flex-1 bg-transparent text-text-primary font-mono text-sm outline-none placeholder:text-text-muted/50","aria-label":"Terminal input",autoFocus:!0}),r.jsx(ke,{visible:L})]}),r.jsx("div",{className:"px-4 py-1.5 border-t border-white/5 bg-black/30",children:r.jsxs("div",{className:"flex items-center justify-between text-[10px] text-text-muted",children:[r.jsx("span",{children:"↑↓ History"}),(n==null?void 0:n.version)&&r.jsxs("span",{className:"text-text-muted/60",children:["pyMC v",n.version]})]})})]}),d!=="connected"&&r.jsx("div",{className:"px-4 py-3 border-t border-white/5 bg-black/30",children:r.jsx("span",{className:"text-xs text-text-muted",children:"Connecting..."})})]})]})}export{Ie as default};
