import{c as K,a8 as Z,a9 as q,aa as ee,j as e,z as te,ab as se,R as Y,ac as ae,X as ne,v as B,ad as re,ae as le,a3 as ce}from"./index-CTlx_9BZ.js";import{b as n,c as p}from"./recharts-CHDYrIv-.js";import{a as ie,M as oe,H as X}from"./HashBadge-9bmn4NJR.js";import{P as de,a as me,G as xe,b as L,C as z}from"./PageLayout-Do22h3d2.js";import{L as ue}from"./loader-circle-dgPpjDqK.js";import"./maplibre-gl-Cg9ukl_k.js";/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M2 12 7 2",key:"117k30"}],["path",{d:"m7 12 5-10",key:"1tvx22"}],["path",{d:"m12 12 5-10",key:"ev1o1a"}],["path",{d:"m17 12 5-10",key:"1e4ti3"}],["path",{d:"M4.5 7h15",key:"vlsxkz"}],["path",{d:"M12 16v6",key:"c8a4gj"}]],pe=K("antenna",he);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],ge=K("pencil",be),fe=n.memo(function(){var w;const{theme:R,setThemePreset:S,setBrightness:I}=Z(),{backgroundImage:t,brightness:l}=R,[C,b]=n.useState(!1),[F,f]=n.useState(!1),x=n.useRef(null),o=n.useRef(null),k=((w=q.find(r=>r.backgroundImage===t))==null?void 0:w.id)??"default",v=n.useCallback((r,c)=>{if(!o.current)return l;const i=(o.current.y-r)/(c?200:80)*100;return Math.round(Math.max(0,Math.min(100,o.current.brightness+i)))},[l]),j=n.useCallback(r=>{S(r),b(!0)},[S]),y=n.useCallback(r=>{I(r)},[I]),N=n.useCallback(r=>{const c=q.find(u=>u.id===r);c&&ee(c.backgroundImage)},[]);return e.jsx("div",{className:"flex gap-2 items-center flex-shrink-0",children:q.map(r=>{const c=k===r.id,u=c&&(C||F);return e.jsxs("div",{ref:c?x:void 0,className:p("relative rounded-md overflow-hidden transition-all duration-300 ease-out","ring-offset-1 ring-offset-bg-body w-10 h-10",c?"ring-2 ring-accent-primary scale-105 cursor-ns-resize":"ring-1 ring-white/20 hover:ring-white/40 opacity-70 hover:opacity-100 cursor-pointer"),onMouseEnter:()=>{c?b(!0):N(r.id)},onMouseLeave:()=>!F&&b(!1),onClick:()=>!c&&j(r.id),onTouchStart:d=>{if(!c)return;d.preventDefault();const i=d.touches[0];o.current={y:i.clientY,brightness:l},f(!0),b(!0);const h=m=>{m.preventDefault();const E=m.touches[0];y(v(E.clientY,!0))},g=()=>{document.removeEventListener("touchmove",h),document.removeEventListener("touchend",g),o.current=null,f(!1),setTimeout(()=>b(!1),1500)};document.addEventListener("touchmove",h,{passive:!1}),document.addEventListener("touchend",g)},onMouseDown:d=>{if(!c)return;d.preventDefault(),o.current={y:d.clientY,brightness:l},f(!0),b(!0);const i=g=>{y(v(g.clientY,!1))},h=()=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",h),o.current=null,f(!1)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",h)},children:[e.jsx("div",{className:"absolute bg-cover bg-center transition-opacity duration-200",style:{inset:0,backgroundImage:`url(${r.backgroundImage})`,opacity:u?.4:1}}),c&&e.jsxs("div",{className:p("absolute inset-0 transition-opacity duration-200",u?"opacity-100":"opacity-0"),children:[e.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-black/70 transition-all duration-100 ease-out",style:{height:`${100-l}%`}}),e.jsx("div",{className:"absolute inset-x-1 h-0.5 bg-white rounded-full shadow-lg transition-all duration-100 ease-out",style:{top:`${100-l}%`}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-[10px] font-mono font-bold text-white drop-shadow-lg",children:[l,"%"]})})]})]},r.id)})})}),ve=[{value:7.8,label:"7.8 kHz"},{value:10.4,label:"10.4 kHz"},{value:15.6,label:"15.6 kHz"},{value:20.8,label:"20.8 kHz"},{value:31.25,label:"31.25 kHz"},{value:41.7,label:"41.7 kHz"},{value:62.5,label:"62.5 kHz"},{value:125,label:"125 kHz"},{value:250,label:"250 kHz"},{value:500,label:"500 kHz"}],je=[5,6,7,8,9,10,11,12],ye=[{value:5,label:"4/5"},{value:6,label:"4/6"},{value:7,label:"4/7"},{value:8,label:"4/8"}];function Fe(){var T,$,A,G;const{stats:a,setMode:R,setDutyCycle:S,fetchStats:I}=te(),t=(T=a==null?void 0:a.config)==null?void 0:T.radio,l=($=a==null?void 0:a.config)==null?void 0:$.repeater,C=(A=a==null?void 0:a.config)==null?void 0:A.duty_cycle,b=(a==null?void 0:a.node_name)||((G=a==null?void 0:a.config)==null?void 0:G.node_name)||"Unknown Node",F=(l==null?void 0:l.mode)??"forward",f=(C==null?void 0:C.enforcement_enabled)??!1,[x,o]=n.useState(!1),[k,v]=n.useState(""),[j,y]=n.useState(62.5),[N,w]=n.useState(7),[r,c]=n.useState(5),[u,d]=n.useState(""),[i,h]=n.useState(!1),[g,m]=n.useState(null),E=n.useRef(null);n.useEffect(()=>{t&&x&&(v((t.frequency/1e6).toFixed(3)),y(t.bandwidth/1e3),w(t.spreading_factor),c(t.coding_rate),d(String(t.tx_power)))},[t,x]);const D=n.useMemo(()=>{if(!t||!x)return!1;const s=t.frequency/1e6,_=t.bandwidth/1e3,P=parseFloat(k)||0;return Math.abs(P-s)>1e-4||j!==_||N!==t.spreading_factor||r!==t.coding_rate||parseInt(u)!==t.tx_power},[t,x,k,j,N,r,u]),H=n.useCallback(()=>{o(!1),m(null),t&&(v((t.frequency/1e6).toFixed(3)),y(t.bandwidth/1e3),w(t.spreading_factor),c(t.coding_rate),d(String(t.tx_power)))},[t]);n.useEffect(()=>{if(!x)return;const s=_=>{E.current&&!E.current.contains(_.target)&&H()};return document.addEventListener("mouseup",s),()=>{document.removeEventListener("mouseup",s)}},[x,H]);const U=()=>{t&&(v((t.frequency/1e6).toFixed(3)),y(t.bandwidth/1e3),w(t.spreading_factor),c(t.coding_rate),d(String(t.tx_power))),m(null),o(!0)},V=async()=>{h(!0),m(null);try{const s={},_=parseFloat(k),P=t?t.frequency/1e6:0;Math.abs(_-P)>1e-4&&(s.frequency_mhz=_);const W=t?t.bandwidth/1e3:0;j!==W&&(s.bandwidth_khz=j),N!==(t==null?void 0:t.spreading_factor)&&(s.spreading_factor=N),r!==(t==null?void 0:t.coding_rate)&&(s.coding_rate=r);const O=parseInt(u);if(O!==(t==null?void 0:t.tx_power)&&(s.tx_power=O),Object.keys(s).length===0){m({success:!0,message:"No changes to save"}),h(!1);return}const M=await ce(s);if(M.success&&M.data){const J=M.data.applied.join(", "),Q=M.data.live_update?" (applied live)":" (restart required)";m({success:!0,message:`Updated: ${J}${Q}`}),I(),setTimeout(()=>{o(!1),m(null)},1500)}else m({success:!1,message:M.error||"Failed to save"})}catch(s){m({success:!1,message:String(s)})}finally{h(!1)}};return e.jsxs(de,{children:[e.jsx(me,{title:"Settings",icon:e.jsx(se,{}),controls:e.jsx(fe,{})}),e.jsxs(xe,{children:[e.jsx(L,{md:6,children:e.jsxs(z,{children:[e.jsxs("h2",{className:"text-lg font-medium text-text-primary mb-4 flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-accent-primary"}),"Operating Mode"]}),e.jsx("p",{className:"text-sm text-text-muted mb-4",children:"Control how the repeater handles incoming packets."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>R("forward"),className:p("w-full p-3 sm:p-4 rounded-lg border text-left transition-all duration-200 min-h-[64px]",F==="forward"?"bg-accent-success/20 border-accent-success/50 text-accent-success":"bg-bg-subtle border-border-subtle text-text-secondary hover:bg-bg-elevated"),children:[e.jsx("div",{className:"font-medium text-sm sm:text-base",children:"Forward Mode"}),e.jsx("div",{className:"text-xs sm:text-sm opacity-70 mt-0.5 sm:mt-1",children:"Receive and retransmit to extend coverage"})]}),e.jsxs("button",{onClick:()=>R("monitor"),className:p("w-full p-3 sm:p-4 rounded-lg border text-left transition-all duration-200 min-h-[64px]",F==="monitor"?"bg-accent-secondary/20 border-accent-secondary/50 text-accent-secondary":"bg-bg-subtle border-border-subtle text-text-secondary hover:bg-bg-elevated"),children:[e.jsx("div",{className:"font-medium text-sm sm:text-base",children:"Monitor Mode"}),e.jsx("div",{className:"text-xs sm:text-sm opacity-70 mt-0.5 sm:mt-1",children:"Log packets without retransmitting"})]})]})]})}),e.jsx(L,{md:6,children:e.jsxs(z,{children:[e.jsxs("h2",{className:"text-lg font-medium text-text-primary mb-4 flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-accent-primary"}),"Duty Cycle Enforcement"]}),e.jsx("p",{className:"text-sm text-text-muted mb-4",children:"Limit airtime to comply with regulations."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>S(!0),className:p("w-full p-3 sm:p-4 rounded-lg border text-left transition-all duration-200 min-h-[64px]",f?"bg-accent-success/20 border-accent-success/50 text-accent-success":"bg-bg-subtle border-border-subtle text-text-secondary hover:bg-bg-elevated"),children:[e.jsx("div",{className:"font-medium text-sm sm:text-base",children:"Enabled"}),e.jsx("div",{className:"text-xs sm:text-sm opacity-70 mt-0.5 sm:mt-1",children:"Enforce airtime limits for regulatory compliance"})]}),e.jsxs("button",{onClick:()=>S(!1),className:p("w-full p-3 sm:p-4 rounded-lg border text-left transition-all duration-200 min-h-[64px]",f?"bg-bg-subtle border-border-subtle text-text-secondary hover:bg-bg-elevated":"bg-accent-secondary/20 border-accent-secondary/50 text-accent-secondary"),children:[e.jsx("div",{className:"font-medium text-sm sm:text-base",children:"Disabled"}),e.jsx("div",{className:"text-xs sm:text-sm opacity-70 mt-0.5 sm:mt-1",children:"No airtime limiting (use with caution)"})]})]})]})}),e.jsx(L,{md:6,children:e.jsx(z,{children:e.jsxs("div",{ref:E,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-medium text-text-primary flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-accent-primary"}),"Radio Configuration"]}),e.jsx("div",{className:"flex items-center gap-1",children:t&&(x?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:H,disabled:i,className:p("p-2 rounded-lg transition-colors",i?"text-text-muted cursor-not-allowed":"text-text-muted hover:text-accent-danger hover:bg-accent-danger/10"),title:"Cancel",children:e.jsx(ne,{className:"w-4 h-4"})}),e.jsx("button",{onClick:V,disabled:i||!D,className:p("p-2 rounded-lg transition-colors",i?"text-accent-primary cursor-wait":D?"text-accent-success hover:bg-accent-success/10":"text-text-muted cursor-not-allowed"),title:D?"Save changes":"No changes to save",children:i?e.jsx(ue,{className:"w-4 h-4 animate-spin"}):e.jsx(ie,{className:"w-4 h-4"})})]}):e.jsx("button",{onClick:U,className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:"Edit radio settings",children:e.jsx(ge,{className:"w-4 h-4"})}))})]}),g&&e.jsx("div",{className:p("text-xs mb-3 px-2 py-1.5 rounded-md",g.success?"text-accent-success bg-accent-success/10":"text-accent-danger bg-accent-danger/10"),children:g.message}),t?x?e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-muted block mb-1",children:"Frequency (MHz)"}),e.jsx("input",{type:"number",value:k,onChange:s=>v(s.target.value),step:"0.001",min:"400",max:"930",className:"w-full h-[38px] bg-bg-subtle border border-border-subtle rounded-lg px-3 py-2 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-muted block mb-1",children:"TX Power (dBm)"}),e.jsx("input",{type:"number",value:u,onChange:s=>d(s.target.value),min:"-9",max:"22",className:"w-full h-[38px] bg-bg-subtle border border-border-subtle rounded-lg px-3 py-2 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-muted block mb-1",children:"Bandwidth"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:j,onChange:s=>y(parseFloat(s.target.value)),className:"w-full h-[38px] bg-bg-subtle border border-border-subtle rounded-lg px-3 pr-8 py-2 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50 appearance-none cursor-pointer",children:ve.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx(B,{className:"absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-muted block mb-1",children:"Spreading Factor"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:N,onChange:s=>w(parseInt(s.target.value)),className:"w-full h-[38px] bg-bg-subtle border border-border-subtle rounded-lg px-3 pr-8 py-2 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50 appearance-none cursor-pointer",children:je.map(s=>e.jsxs("option",{value:s,children:["SF",s]},s))}),e.jsx(B,{className:"absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-muted block mb-1",children:"Coding Rate"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:r,onChange:s=>c(parseInt(s.target.value)),className:"w-full h-[38px] bg-bg-subtle border border-border-subtle rounded-lg px-3 pr-8 py-2 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50 appearance-none cursor-pointer",children:ye.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx(B,{className:"absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-muted block mb-1",children:"Preamble"}),e.jsxs("p",{className:"text-text-primary font-medium h-[38px] flex items-center",children:[t.preamble_length," symbols"]})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-muted block mb-1",children:"Frequency"}),e.jsx("p",{className:"text-text-primary font-medium h-[38px] flex items-center",children:re(t.frequency)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-muted block mb-1",children:"TX Power"}),e.jsxs("p",{className:"text-text-primary font-medium h-[38px] flex items-center",children:[t.tx_power," dBm"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-muted block mb-1",children:"Bandwidth"}),e.jsx("p",{className:"text-text-primary font-medium h-[38px] flex items-center",children:le(t.bandwidth)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-muted block mb-1",children:"Spreading Factor"}),e.jsxs("p",{className:"text-text-primary font-medium h-[38px] flex items-center",children:["SF",t.spreading_factor]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-muted block mb-1",children:"Coding Rate"}),e.jsxs("p",{className:"text-text-primary font-medium h-[38px] flex items-center",children:["4/",t.coding_rate]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-muted block mb-1",children:"Preamble Length"}),e.jsxs("p",{className:"text-text-primary font-medium h-[38px] flex items-center",children:[t.preamble_length," symbols"]})]})]}):e.jsx("p",{className:"text-text-muted",children:"Loading radio configuration..."})]})})}),e.jsx(L,{md:6,children:e.jsxs(z,{children:[e.jsxs("h2",{className:"text-lg font-medium text-text-primary mb-4 flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-accent-primary"}),"Location"]}),l?e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-muted",children:"Latitude"}),e.jsx("p",{className:"text-text-primary font-medium mt-1",children:l.latitude!==0?l.latitude.toFixed(6):"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-muted",children:"Longitude"}),e.jsx("p",{className:"text-text-primary font-medium mt-1",children:l.longitude!==0?l.longitude.toFixed(6):"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-muted",children:"Advert Interval"}),e.jsx("p",{className:"text-text-primary font-medium mt-1",children:l.send_advert_interval_hours>0?`${l.send_advert_interval_hours}h`:"Disabled"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-muted",children:"Score-based TX"}),e.jsx("p",{className:"text-text-primary font-medium mt-1",children:l.use_score_for_tx?"Enabled":"Disabled"})]})]}):e.jsx("p",{className:"text-text-muted",children:"Loading location settings..."})]})}),e.jsx(L,{children:e.jsxs(z,{children:[e.jsxs("h2",{className:"type-subheading text-text-primary mb-4 flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-accent-primary"}),"Node Information"]}),a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"type-label text-text-muted",children:"Node Name"}),e.jsx("p",{className:"type-body text-text-primary mt-1",children:b})]}),e.jsxs("div",{children:[e.jsx("span",{className:"type-label text-text-muted",children:"Version"}),e.jsxs("p",{className:"type-data text-text-primary mt-1",children:["v",a.version]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"type-label text-text-muted",children:"Core Version"}),e.jsxs("p",{className:"type-data text-text-primary mt-1",children:["v",a.core_version]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"type-label text-text-muted",children:"Local Hash"}),e.jsx("div",{className:"mt-1",children:a.local_hash?e.jsx(X,{hash:a.local_hash,size:"sm"}):e.jsx("span",{className:"type-data-sm text-text-muted",children:"N/A"})})]})]}),a.public_key&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-border-subtle",children:[e.jsx("span",{className:"type-label text-text-muted",children:"Public Key"}),e.jsx("div",{className:"mt-1",children:e.jsx(X,{hash:a.public_key,prefixLength:12,suffixLength:8})})]})]}):e.jsx("p",{className:"text-text-muted",children:"Loading node information..."})]})})]})]})}export{Fe as default};
