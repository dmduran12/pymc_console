const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ContactsMapMapLibre-4aCyCoin.js","assets/index-CCF7uGn6.js","assets/recharts-CHDYrIv-.js","assets/maplibre-gl-Cg9ukl_k.js","assets/index-DPg_QSGe.css","assets/maplibre-gl-D68f5Ioo.js","assets/maplibre-gl-B1CfjdFi.css","assets/HashBadge-DS_ttR7h.js","assets/loader-circle-DRg7Ggbl.js","assets/info-DV-poLK6.js","assets/house-DK8lEERj.js","assets/refresh-cw-C1BUhL6l.js","assets/trending-up-Mt4Tf1O3.js","assets/SignalIndicator-oCfmKlnA.js","assets/triangle-alert-DqZKprmL.js","assets/zap-lGAU0yur.js","assets/activity-WvsAZQXl.js","assets/PageLayout-FJpXGMbq.js","assets/users-CIyO1tQK.js"])))=>i.map(i=>d[i]);
import{c as k,j as e,_ as Me,w as Se,v as _e,X as pe,x as Le,y as $e,z as Re,A as He,B as Oe,E as Ae,F as Te,f as De,R as Ee,C as Pe,G as Fe}from"./index-CCF7uGn6.js";import{b as i,g as Ie,c as P,d as qe,h as Be,T as se,f as We,e as ne,L as ze}from"./recharts-CHDYrIv-.js";import{a as Ke}from"./SignalIndicator-oCfmKlnA.js";import{T as B}from"./triangle-alert-DqZKprmL.js";import{T as ge,Z as Ue,M as Ge}from"./zap-lGAU0yur.js";import{A as q}from"./activity-WvsAZQXl.js";import{T as Ve,N as Qe}from"./trending-up-Mt4Tf1O3.js";import{M as Ze,H as ae}from"./HashBadge-DS_ttR7h.js";import{P as Xe,a as Ye}from"./PageLayout-FJpXGMbq.js";import{U as F}from"./users-CIyO1tQK.js";/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],et=k("arrow-left-right",Je);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],I=k("arrow-up-down",tt);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],nt=k("chevron-up",st);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]],rt=k("git-branch",at);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"M16 10a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 14.286V4a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z",key:"1n2ejm"}],["path",{d:"M20 9a2 2 0 0 1 2 2v10.286a.71.71 0 0 1-1.212.502l-2.202-2.202A2 2 0 0 0 17.172 19H10a2 2 0 0 1-2-2v-1",key:"1qfcsi"}]],re=k("messages-square",ot);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=[["path",{d:"M18 8V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h8",key:"10dyio"}],["path",{d:"M10 19v-3.96 3.15",key:"1irgej"}],["path",{d:"M7 19h5",key:"qswx4l"}],["rect",{width:"6",height:"10",x:"16",y:"12",rx:"2",key:"1egngj"}]],oe=k("monitor-smartphone",ct);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]],ce=k("ruler",it);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],dt=k("search",lt);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],ie=k("share-2",mt);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ht=k("trash-2",xt);class ut extends i.Component{constructor(s){super(s),this.state={hasError:!1}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}render(){var s;return this.state.hasError?e.jsx("div",{className:"glass-card h-[400px] flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white/50 p-4",children:[e.jsx("p",{className:"text-lg mb-2",children:"Map failed to load"}),e.jsx("p",{className:"text-sm text-white/30",children:((s=this.state.error)==null?void 0:s.message)||"Unknown error"})]})}):this.props.children}}const pt=i.lazy(()=>Me(()=>import("./ContactsMapMapLibre-4aCyCoin.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18])));function gt({neighbors:t,localNode:s,localHash:r,onRemoveNode:h,selectedNodeHash:o,onNodeSelected:m,highlightedEdgeKey:c}){return e.jsx(ut,{children:e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"glass-card h-[500px] flex items-center justify-center",children:e.jsx("div",{className:"text-white/50",children:"Loading map..."})}),children:e.jsx(pt,{neighbors:t,localNode:s,localHash:r,onRemoveNode:h,selectedNodeHash:o,onNodeSelected:m,highlightedEdgeKey:c})})})}function fe(t){return t>=.7?"text-accent-success":t>=.5?"text-accent-secondary":t>=.3?"text-signal-poor":"text-accent-danger"}function ft(t){return t>=.7?"bg-accent-success/10":t>=.5?"bg-accent-secondary/10":t>=.3?"bg-signal-poor/10":"bg-accent-danger/10"}function yt(t){return t>.2?{icon:e.jsx(Ve,{className:"w-3 h-3"}),color:"text-accent-success"}:t<-.2?{icon:e.jsx(ge,{className:"w-3 h-3"}),color:"text-accent-danger"}:{icon:e.jsx(Ge,{className:"w-3 h-3"}),color:"text-text-muted"}}function ye(t){return`${Math.round(t*100)}%`}const bt=i.memo(function({path:s,isHighlighted:r,onHighlight:h}){const o=yt(s.observationTrend),m=s.weakestLinkKey&&s.weakestLinkConfidence<.5;return e.jsxs("div",{className:`flex items-center gap-3 p-2 rounded-md transition-colors cursor-pointer ${r?"bg-accent-primary/20 border border-accent-primary/40":"hover:bg-white/5"}`,onClick:()=>h(r?null:s.weakestLinkKey),children:[e.jsx("div",{className:`flex-shrink-0 w-12 text-center py-1 rounded-md ${ft(s.healthScore)}`,children:e.jsx("span",{className:`text-xs font-semibold tabular-nums ${fe(s.healthScore)}`,children:ye(s.healthScore)})}),e.jsx("div",{className:"flex-1 flex items-center gap-0.5 overflow-x-auto min-w-0",children:s.hops.map((c,l)=>{var d;return e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:`text-[10px] font-mono px-1.5 py-0.5 rounded ${m&&((d=s.weakestLinkKey)!=null&&d.includes(c))?"bg-accent-danger/20 text-accent-danger":"bg-white/10 text-text-secondary"}`,children:c}),l<s.hops.length-1&&e.jsx("span",{className:"text-text-muted mx-0.5",children:"→"})]},l)})}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-3",children:[e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.routeType==="direct"?"bg-accent-success/20 text-accent-success":s.routeType==="flood"?"bg-accent-primary/20 text-accent-primary":"bg-white/10 text-text-muted"}`,children:s.routeType==="direct"?"D":s.routeType==="flood"?"F":"M"}),e.jsxs("div",{className:"flex items-center gap-1 text-text-muted",title:"Estimated latency",children:[e.jsx(Ue,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-[10px] tabular-nums",children:[s.estimatedLatencyMs,"ms"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-text-muted",title:"Observations",children:[e.jsx(q,{className:"w-3 h-3"}),e.jsx("span",{className:"text-[10px] tabular-nums",children:s.observationCount})]}),e.jsx("div",{className:`flex items-center gap-1 ${o.color}`,title:"Usage trend",children:o.icon}),m&&e.jsx("div",{className:"text-accent-danger",title:`Weak link: ${s.weakestLinkConfidence.toFixed(0)}% confidence`,children:e.jsx(B,{className:"w-3 h-3"})})]})]})}),jt=i.memo(function({maxPaths:s=10,onHighlightEdge:r,highlightedEdge:h}){const o=Se(),[m,c]=i.useState(!1),l=i.useMemo(()=>o.slice(0,s),[o,s]),d=i.useMemo(()=>{if(o.length===0)return null;const x=o.reduce((y,N)=>y+N.healthScore,0)/o.length,C=o.filter(y=>y.observationTrend<-.2).length,g=o.filter(y=>y.weakestLinkConfidence<.5).length;return{avgHealth:x,declining:C,weakLinks:g}},[o]),j=x=>{r==null||r(x)};return o.length===0?null:e.jsxs("div",{className:"chart-container",children:[e.jsxs("button",{onClick:()=>c(!m),className:"w-full chart-header hover:bg-white/5 transition-colors rounded-t-lg cursor-pointer",children:[e.jsxs("div",{className:"chart-title",children:[e.jsx(rt,{className:"chart-title-icon"}),"Path Health",e.jsxs("span",{className:"ml-2 text-[10px] font-normal text-text-muted",children:["(",o.length," paths)"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[d&&e.jsxs("div",{className:"flex items-center gap-3 text-[10px]",children:[e.jsxs("span",{className:`tabular-nums ${fe(d.avgHealth)}`,children:["Avg: ",ye(d.avgHealth)]}),d.weakLinks>0&&e.jsxs("span",{className:"text-accent-danger flex items-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"}),d.weakLinks," weak"]}),d.declining>0&&e.jsxs("span",{className:"text-signal-poor flex items-center gap-1",children:[e.jsx(ge,{className:"w-3 h-3"}),d.declining," declining"]})]}),m?e.jsx(nt,{className:"w-4 h-4 text-text-muted"}):e.jsx(_e,{className:"w-4 h-4 text-text-muted"})]})]}),m&&e.jsxs("div",{className:"p-3 pt-0 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-4 text-[10px] text-text-muted pb-2 border-b border-white/5",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-success"})," Healthy (≥70%)"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-secondary"})," Fair (50-70%)"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-signal-poor"})," Weak (30-50%)"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-danger"})," Critical (<30%)"]})]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:l.map(x=>e.jsx(bt,{path:x,isHighlighted:h===x.weakestLinkKey,onHighlight:j},x.pathKey))}),o.length>s&&e.jsxs("div",{className:"text-center text-[10px] text-text-muted pt-2",children:["Showing top ",s," of ",o.length," paths"]})]})]})});function vt({isOpen:t,title:s="Confirm",message:r,confirmLabel:h="Confirm",cancelLabel:o="Cancel",variant:m="default",onConfirm:c,onCancel:l}){if(i.useEffect(()=>{if(!t)return;const x=T=>{T.key==="Escape"&&l()};window.addEventListener("keydown",x);const C=document.body.style.overflow,g=document.body.style.position,y=document.body.style.width,N=document.body.style.top,H=window.scrollY;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top=`-${H}px`,()=>{window.removeEventListener("keydown",x),document.body.style.overflow=C,document.body.style.position=g,document.body.style.width=y,document.body.style.top=N,window.scrollTo(0,H)}},[t,l]),!t)return null;const j={danger:{icon:"text-accent-danger",button:"bg-accent-danger hover:bg-red-600"},warning:{icon:"text-accent-secondary",button:"bg-accent-secondary hover:bg-yellow-600 text-bg-body"},default:{icon:"text-accent-primary",button:"bg-accent-primary hover:bg-violet-500 text-bg-body"}}[m];return Ie.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-md z-[10010] flex items-end sm:items-center justify-center",onClick:l,role:"dialog","aria-modal":"true","aria-labelledby":"confirm-modal-title",children:e.jsxs("div",{className:P("glass-card w-full max-w-sm overflow-hidden","sm:mx-4 sm:rounded-xl","rounded-t-2xl rounded-b-none sm:rounded-b-xl","pb-safe"),onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border-subtle",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:P("p-2 rounded-lg bg-bg-subtle",j.icon),children:e.jsx(B,{className:"w-5 h-5"})}),e.jsx("h3",{id:"confirm-modal-title",className:"text-base font-semibold text-text-primary",children:s})]}),e.jsx("button",{onClick:l,className:"p-2 rounded-lg text-text-muted hover:text-text-primary hover:bg-bg-subtle transition-colors",children:e.jsx(pe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4",children:e.jsx("p",{className:"text-sm text-text-secondary",children:r})}),e.jsxs("div",{className:"flex gap-3 p-4 pt-0",children:[e.jsx("button",{onClick:l,className:"flex-1 px-4 py-2.5 rounded-lg text-sm font-medium text-text-secondary bg-bg-subtle hover:bg-bg-elevated border border-border-subtle transition-colors",children:o}),e.jsx("button",{onClick:c,className:P("flex-1 px-4 py-2.5 rounded-lg text-sm font-medium text-text-primary transition-colors",j.button),children:h})]})]})}),document.body)}const Nt=i.memo(vt),O="var(--signal-critical)",le="var(--signal-poor)",de="var(--signal-fair)",me="var(--signal-good)",xe="var(--signal-excellent)",he="var(--text-muted)";function wt(t){if(t.length===0)return O;const s=t.slice(-4),r=s.reduce((c,l)=>c+l.count,0),h=r/s.length,m=t.reduce((c,l)=>c+l.count,0)/t.length;if(r===0)return O;if(m>0){const c=h/m;return c>=1.2?xe:c>=.8?me:c>=.4?de:c>=.1?le:O}return r>=10?xe:r>=5?me:r>=2?de:r>=1?le:O}function ue({active:t,payload:s}){if(!t||!s||!s.length)return null;const r=s[0].payload,h=new Date(r.timestamp),o=`${(h.getMonth()+1).toString().padStart(2,"0")}/${h.getDate().toString().padStart(2,"0")}`;return e.jsxs("div",{className:"bg-bg-surface/95 border border-border-subtle rounded px-1.5 py-0.5 text-[10px] shadow-lg",children:[e.jsx("span",{className:"text-text-muted",children:o}),e.jsx("span",{className:"ml-1.5 font-semibold tabular-nums",children:r.count})]})}function kt({nodeHash:t,width:s=60,height:r=20,color:h,showArea:o=!0,showTooltip:m=!1,className:c=""}){const l=Le(t),d=$e(),j=h??(l.length>0?wt(l):he),x={width:s,height:r};if(l.length<2){const g=typeof s=="number"?s:60,y=d?he:O;return e.jsx("div",{className:`flex items-center justify-center ${c}`,style:{...x,color:y},children:e.jsx("svg",{width:"100%",height:r,viewBox:`0 0 ${g} ${r}`,preserveAspectRatio:"none",children:e.jsx("line",{x1:4,y1:r/2,x2:g-4,y2:r/2,stroke:"currentColor",strokeWidth:1.5,strokeDasharray:"3,2",className:d?"animate-pulse":""})})})}const C=`sparkline-gradient-${t.slice(-6)}`;return e.jsx("div",{className:c,style:x,children:e.jsx(qe,{width:"100%",height:"100%",children:o?e.jsxs(Be,{data:l,margin:{top:1,right:1,bottom:1,left:1},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:C,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:j,stopOpacity:.35}),e.jsx("stop",{offset:"100%",stopColor:j,stopOpacity:.05})]})}),m&&e.jsx(se,{content:e.jsx(ue,{}),cursor:{stroke:"rgba(255,255,255,0.2)",strokeWidth:1}}),e.jsx(We,{type:"monotone",dataKey:"count",stroke:"none",fill:`url(#${C})`,isAnimationActive:!1}),e.jsx(ne,{type:"monotone",dataKey:"count",stroke:j,strokeWidth:1.5,dot:!1,isAnimationActive:!1})]}):e.jsxs(ze,{data:l,margin:{top:1,right:1,bottom:1,left:1},children:[m&&e.jsx(se,{content:e.jsx(ue,{}),cursor:{stroke:"rgba(255,255,255,0.2)",strokeWidth:1}}),e.jsx(ne,{type:"monotone",dataKey:"count",stroke:j,strokeWidth:1.5,dot:!1,isAnimationActive:!1})]})})})}function Ct(t){return t===void 0?"bg-[var(--signal-unknown)]":t>=5?"bg-[var(--signal-excellent)]":t>=0?"bg-[var(--signal-good)]":t>=-5?"bg-[var(--signal-fair)]":t>=-10?"bg-[var(--signal-poor)]":"bg-[var(--signal-critical)]"}function Mt(t,s,r,h){const m=(r-t)*Math.PI/180,c=(h-s)*Math.PI/180,l=Math.sin(m/2)*Math.sin(m/2)+Math.cos(t*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}function St(t){return t<1e3?`${Math.round(t)}m`:`${(t/1e3).toFixed(1)}km`}function _t(){const{stats:t}=Re(),s=He(),r=Oe(),h=Ae(),o=Te(),m=De(),[c,l]=i.useState(null),[d,j]=i.useState("lastHeard"),[x,C]=i.useState("desc"),[g,y]=i.useState(""),[N,H]=i.useState(!1),[T,W]=i.useState(null),[z,be]=i.useState(null),K=i.useMemo(()=>(t==null?void 0:t.neighbors)??{},[t==null?void 0:t.neighbors]),_=i.useMemo(()=>Object.fromEntries(Object.entries(K).filter(([n])=>!s.has(n))),[K,s]),w=i.useMemo(()=>{var n;return(n=t==null?void 0:t.config)!=null&&n.repeater?{latitude:t.config.repeater.latitude,longitude:t.config.repeater.longitude,name:t.config.node_name||"Local Node"}:void 0},[t]),je=t==null?void 0:t.local_hash,A=i.useMemo(()=>{const n=new Map;if(!(w!=null&&w.latitude)||!(w!=null&&w.longitude))return n;for(const[a,u]of Object.entries(_))u.latitude&&u.longitude&&u.latitude!==0&&u.longitude!==0?n.set(a,Mt(w.latitude,w.longitude,u.latitude,u.longitude)):n.set(a,null);return n},[_,w]),{neighborHashSet:$,neighborSignalMap:ve}=i.useMemo(()=>{const n=new Set,a=new Map;for(const u of m)n.add(u.hash),a.set(u.hash,{avgRssi:u.avgRssi,avgSnr:u.avgSnr});return{neighborHashSet:n,neighborSignalMap:a}},[m]),U=i.useMemo(()=>{const n=g.toLowerCase().trim(),a=n==="neighbor"||n==="neighbors",u=N||a;return Object.fromEntries(Object.entries(_).filter(([S,L])=>{if(u&&!$.has(S))return!1;if(a||!n)return!0;const f=(L.node_name||L.name||"").toLowerCase(),b=S.slice(2,4).toLowerCase();return f.includes(n)||b.includes(n)||S.toLowerCase().includes(n)}))},[_,g,N,$]),R=i.useMemo(()=>Object.entries(U).sort(([a,u],[S,L])=>{let f=0;switch(d){case"lastHeard":f=(u.last_seen||0)-(L.last_seen||0);break;case"distance":{const b=A.get(a)??null,M=A.get(S)??null;b===null&&M===null?f=0:b===null?f=1:M===null?f=-1:f=b-M;break}case"centrality":{const b=o.get(a)||0,M=o.get(S)||0;f=b-M;break}}return x==="desc"?-f:f}),[U,d,x,A,o]),G=R.filter(([,n])=>n.latitude&&n.longitude&&n.latitude!==0&&n.longitude!==0).length,Ne=i.useMemo(()=>new Set(h),[h]),D=i.useCallback(n=>{d===n?C(a=>a==="desc"?"asc":"desc"):(j(n),C("desc"))},[d]),we=i.useCallback(n=>{const a=_[n];a!=null&&a.latitude&&(a!=null&&a.longitude)&&a.latitude!==0&&a.longitude!==0&&W(n)},[_]),ke=i.useCallback(()=>{W(null)},[]);return e.jsxs(Xe,{children:[e.jsx(Ye,{title:"Contacts",icon:e.jsx(F,{}),controls:e.jsxs("div",{className:"flex items-baseline gap-3 sm:gap-4",children:[e.jsxs("span",{className:"roster-title tabular-nums",children:[R.length," node",R.length!==1?"s":""]}),G>0&&e.jsxs("span",{className:"roster-title flex items-baseline gap-1.5 tabular-nums",children:[e.jsx(Ze,{className:"w-3.5 h-3.5 relative top-[2px]"}),G," with location"]})]})}),e.jsx("div",{className:"relative",children:e.jsx(gt,{neighbors:_,localNode:w,localHash:je,onRemoveNode:r,selectedNodeHash:T,onNodeSelected:ke,highlightedEdgeKey:z})}),e.jsx(jt,{maxPaths:10,highlightedEdge:z,onHighlightEdge:be}),e.jsxs("div",{className:"chart-container",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"chart-title",children:[e.jsx(F,{className:"chart-title-icon"}),"Discovered Contacts"]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[$.size>0&&e.jsxs("button",{onClick:()=>H(!N),className:`flex items-center gap-1.5 px-2.5 py-1.5 text-xs rounded-lg transition-colors min-h-[32px] order-1 sm:order-1 ${N?"bg-accent-success/20 text-accent-success border border-accent-success/30":"text-text-muted hover:text-text-secondary hover:bg-white/5 border border-transparent"}`,title:N?"Show all contacts":"Show only MeshCore neighbors (direct RF contact)",children:[e.jsx(Ee,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Neighbors"}),e.jsx("span",{className:"sm:hidden",children:$.size}),N&&e.jsx("span",{className:"text-[10px] font-semibold tabular-nums",children:$.size})]}),e.jsxs("div",{className:"relative order-2 sm:order-2",children:[e.jsx(dt,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-text-muted"}),e.jsx("input",{type:"text",value:g,onChange:n=>y(n.target.value),placeholder:"Search...",className:"w-28 sm:w-32 pl-7 pr-7 py-1.5 text-xs bg-white/5 border border-white/10 rounded-lg text-text-primary placeholder:text-text-muted focus:outline-none focus:border-accent-primary/50"}),g&&e.jsx("button",{onClick:()=>{y(""),(g.toLowerCase().trim()==="neighbor"||g.toLowerCase().trim()==="neighbors")&&H(!1)},className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-secondary p-0.5",children:e.jsx(pe,{className:"w-3.5 h-3.5"})})]}),e.jsxs("div",{className:"flex items-center gap-1 order-1 sm:order-2",children:[e.jsxs("button",{onClick:()=>D("lastHeard"),className:`flex items-center gap-1 px-2.5 py-1.5 text-xs rounded-lg transition-colors min-h-[32px] ${d==="lastHeard"?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-white/5"}`,title:"Sort by last heard",children:[e.jsx(Pe,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Recent"}),d==="lastHeard"&&e.jsx(I,{className:`w-3 h-3 ${x==="asc"?"rotate-180":""}`})]}),e.jsxs("button",{onClick:()=>D("distance"),className:`flex items-center gap-1 px-2.5 py-1.5 text-xs rounded-lg transition-colors min-h-[32px] ${d==="distance"?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-white/5"}`,title:"Sort by distance",children:[e.jsx(ce,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Distance"}),d==="distance"&&e.jsx(I,{className:`w-3 h-3 ${x==="asc"?"rotate-180":""}`})]}),e.jsxs("button",{onClick:()=>D("centrality"),className:`flex items-center gap-1 px-2.5 py-1.5 text-xs rounded-lg transition-colors min-h-[32px] ${d==="centrality"?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-white/5"}`,title:"Sort by network centrality",children:[e.jsx(q,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Centrality"}),d==="centrality"&&e.jsx(I,{className:`w-3 h-3 ${x==="asc"?"rotate-180":""}`})]})]})]})]}),R.length>0?e.jsx("div",{className:"roster-list",children:R.map(([n,a],u)=>{var Q,Z;const S=a.latitude&&a.longitude&&a.latitude!==0&&a.longitude!==0,L=a.node_name||a.name||"Unknown",f=Ne.has(n),b=$.has(n),M=A.get(n),V=o.get(n)||0,p=b?ve.get(n):void 0,E=b&&p;return e.jsxs("div",{children:[e.jsxs("div",{className:`roster-row ${f?"bg-amber-500/5 border-l-2 border-l-amber-400":""} ${S?"cursor-pointer hover:bg-white/[0.02]":""}`,onClick:()=>we(n),children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:"roster-icon",children:(()=>{var te;const v=(te=a.contact_type)==null?void 0:te.toLowerCase(),X=v==="room server"||v==="room_server"||v==="room"||v==="server",Ce=v==="companion"||v==="client"||v==="cli",Y=a.is_repeater||v==="repeater"||v==="rep",J="#4338CA",ee="#F59E0B";return X&&Y?e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx(re,{className:"w-5 h-5 absolute inset-0",style:{color:ee}}),e.jsx(ie,{className:"w-2.5 h-2.5 absolute -bottom-0.5 -right-0.5",style:{color:J}})]}):X?e.jsx(re,{className:"w-5 h-5",style:{color:ee}}):Ce?e.jsx(oe,{className:"w-5 h-5 text-text-muted"}):Y?b?e.jsx(et,{className:"w-5 h-5 text-accent-success"}):e.jsx(ie,{className:"w-5 h-5",style:{color:J}}):e.jsx(oe,{className:"w-5 h-5 text-text-muted"})})()}),E&&(p==null?void 0:p.avgSnr)!==null&&e.jsx("div",{className:`absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full ${Ct(p.avgSnr)} border-2 border-bg-surface`})]}),e.jsxs("div",{className:"roster-content min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"roster-title",children:L}),b&&e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-semibold rounded",style:{backgroundColor:"rgba(57, 217, 138, 0.2)",color:"#39D98A"},children:"NBR"}),f&&e.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-semibold rounded flex items-center gap-1",style:{backgroundColor:"rgba(251, 191, 36, 0.2)",color:"#FBBF24"},children:[e.jsx(Qe,{className:"w-3 h-3"}),"HUB"]}),(a.is_repeater||((Q=a.contact_type)==null?void 0:Q.toLowerCase())==="repeater"||((Z=a.contact_type)==null?void 0:Z.toLowerCase())==="rep")&&e.jsx("span",{className:"pill-tag",children:"RPT"})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(ae,{hash:n,size:"sm",full:!0})}),e.jsx("div",{className:"md:hidden",children:e.jsx(ae,{hash:n,size:"sm",prefixLength:8,suffixLength:6})})]}),e.jsxs("div",{className:"roster-metrics flex-shrink-0",children:[E&&(p==null?void 0:p.avgRssi)!==null&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ke,{rssi:p.avgRssi,className:"w-3.5 h-3.5"}),e.jsx("span",{className:"type-data-xs tabular-nums",children:Math.round(p.avgRssi)})]}),E&&(p==null?void 0:p.avgSnr)!==null&&e.jsx("div",{className:"flex items-center gap-1.5",children:e.jsxs("span",{className:"type-data-xs tabular-nums",children:[p.avgSnr.toFixed(1)," dB"]})}),M!=null&&e.jsxs("div",{className:"flex items-center gap-1 text-accent-tertiary",children:[e.jsx(ce,{className:"w-3 h-3"}),e.jsx("span",{className:"type-data-xs tabular-nums",children:St(M)})]}),V>0&&e.jsxs("div",{className:"flex items-center gap-1 text-amber-400/70",children:[e.jsx(q,{className:"w-3 h-3"}),e.jsxs("span",{className:"type-data-xs tabular-nums",children:[(V*100).toFixed(0),"%"]})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(kt,{nodeHash:n,width:48,height:16})})]}),e.jsx("div",{className:"roster-metric flex-shrink-0",children:a.last_seen?Fe(a.last_seen):"—"}),e.jsx("button",{onClick:v=>{v.stopPropagation(),l({hash:n,name:L})},className:"ml-2 p-1.5 rounded-lg text-text-muted/50 hover:text-red-400 hover:bg-red-500/10 transition-colors flex-shrink-0",title:"Remove contact",children:e.jsx(ht,{className:"w-4 h-4"})})]}),u<R.length-1&&e.jsx("div",{className:"roster-separator"})]},n)})}):e.jsxs("div",{className:"roster-empty",children:[e.jsx(F,{className:"roster-empty-icon"}),e.jsx("div",{className:"roster-empty-title",children:"No Contacts Discovered"}),e.jsx("div",{className:"roster-empty-text",children:"Contacts will appear here as they advertise on the mesh network."})]})]}),e.jsx(Nt,{isOpen:!!c,title:"Remove Contact",message:`Are you sure you would like to remove ${(c==null?void 0:c.name)||"this contact"}?`,confirmLabel:"Remove",cancelLabel:"Cancel",variant:"danger",onConfirm:()=>{c&&r(c.hash),l(null)},onCancel:()=>l(null)})]})}const Ft=Object.freeze(Object.defineProperty({__proto__:null,default:_t},Symbol.toStringTag,{value:"Module"}));export{Nt as C,rt as G,re as M,kt as N,ht as T,Ft as a};
