import{e as pe,a1 as ue,a2 as fe,a3 as R,a4 as ye,a5 as ge,a6 as he,$ as xe,j as t,a7 as be}from"./index-982_qNvm.js";import{b as d,c as S}from"./recharts-CHDYrIv-.js";import"./maplibre-gl-Cg9ukl_k.js";const ve=[{name:"get adc.multiplier",category:"get",params:[],description:"Get ADC multiplier for battery",serialOnly:!1,hasParam:!1},{name:"get advert.interval",category:"get",params:[],description:"Get local advert interval (minutes)",serialOnly:!1,hasParam:!1},{name:"get af",category:"get",params:[],description:"Get airtime factor",serialOnly:!1,hasParam:!1},{name:"get agc.reset.interval",category:"get",params:[],description:"Get AGC reset interval (seconds)",serialOnly:!1,hasParam:!1},{name:"get allow.read.only",category:"get",params:[],description:"Get read-only access setting",serialOnly:!1,hasParam:!1},{name:"get bridge.baud",category:"get",params:[],description:"Get bridge baud rate",serialOnly:!1,hasParam:!1},{name:"get bridge.channel",category:"get",params:[],description:"Get bridge channel (ESP-NOW)",serialOnly:!1,hasParam:!1},{name:"get bridge.delay",category:"get",params:[],description:"Get bridge delay (ms)",serialOnly:!1,hasParam:!1},{name:"get bridge.enabled",category:"get",params:[],description:"Get bridge enabled status",serialOnly:!1,hasParam:!1},{name:"get bridge.secret",category:"get",params:[],description:"Get bridge encryption secret",serialOnly:!1,hasParam:!1},{name:"get bridge.source",category:"get",params:[],description:"Get bridge packet source",serialOnly:!1,hasParam:!1},{name:"get bridge.type",category:"get",params:[],description:"Get bridge type (rs232/espnow/none)",serialOnly:!1,hasParam:!1},{name:"get direct.txdelay",category:"get",params:[],description:"Get direct TX delay factor",serialOnly:!1,hasParam:!1},{name:"get flood.advert.interval",category:"get",params:[],description:"Get flood advert interval (hours)",serialOnly:!1,hasParam:!1},{name:"get flood.max",category:"get",params:[],description:"Get max flood hops",serialOnly:!1,hasParam:!1},{name:"get freq",category:"get",params:[],description:"Get frequency (MHz)",serialOnly:!1,hasParam:!1},{name:"get guest.password",category:"get",params:[],description:"Get guest password",serialOnly:!1,hasParam:!1},{name:"get int.thresh",category:"get",params:[],description:"Get interference threshold",serialOnly:!1,hasParam:!1},{name:"get lat",category:"get",params:[],description:"Get latitude",serialOnly:!1,hasParam:!1},{name:"get lon",category:"get",params:[],description:"Get longitude",serialOnly:!1,hasParam:!1},{name:"get multi.acks",category:"get",params:[],description:"Get multi-ack setting",serialOnly:!1,hasParam:!1},{name:"get name",category:"get",params:[],description:"Get node name",serialOnly:!1,hasParam:!1},{name:"get prv.key",category:"get",params:[],description:"Get private key (serial only)",serialOnly:!0,hasParam:!1},{name:"get public.key",category:"get",params:[],description:"Get public key (hex)",serialOnly:!1,hasParam:!1},{name:"get radio",category:"get",params:[],description:"Get radio params (freq,bw,sf,cr)",serialOnly:!1,hasParam:!1},{name:"get repeat",category:"get",params:[],description:"Get repeat/forward status (on/off)",serialOnly:!1,hasParam:!1},{name:"get role",category:"get",params:[],description:"Get device role",serialOnly:!1,hasParam:!1},{name:"get rxdelay",category:"get",params:[],description:"Get RX delay base",serialOnly:!1,hasParam:!1},{name:"get tx",category:"get",params:[],description:"Get TX power (dBm)",serialOnly:!1,hasParam:!1},{name:"get txdelay",category:"get",params:[],description:"Get TX delay factor",serialOnly:!1,hasParam:!1},{name:"gps",category:"gps",params:[],description:"Show GPS status",serialOnly:!1,hasParam:!1},{name:"gps advert",category:"gps",params:[],description:"Get/set GPS advert location policy",serialOnly:!1,hasParam:!0},{name:"gps off",category:"gps",params:[],description:"Disable GPS",serialOnly:!1,hasParam:!0},{name:"gps on",category:"gps",params:[],description:"Enable GPS",serialOnly:!1,hasParam:!0},{name:"gps setloc",category:"gps",params:[],description:"Set node location from GPS",serialOnly:!1,hasParam:!0},{name:"gps sync",category:"gps",params:[],description:"Sync time from GPS",serialOnly:!1,hasParam:!0},{name:"log",category:"logging",params:[],description:"Dump log file (serial only)",serialOnly:!0,hasParam:!1},{name:"log erase",category:"logging",params:[],description:"Erase log file",serialOnly:!1,hasParam:!0},{name:"log start",category:"logging",params:[],description:"Start packet logging",serialOnly:!1,hasParam:!0},{name:"log stop",category:"logging",params:[],description:"Stop packet logging",serialOnly:!1,hasParam:!0},{name:"neighbor.remove",category:"neighbor",params:[],description:"Remove neighbor by pubkey",serialOnly:!1,hasParam:!0},{name:"neighbors",category:"neighbor",params:[],description:"List neighbors",serialOnly:!1,hasParam:!1},{name:"get",category:"other",params:[],description:"Execute get command",serialOnly:!1,hasParam:!0},{name:"set",category:"other",params:[{name:"value",type:"float"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Execute set command",serialOnly:!1,hasParam:!0},{name:"tempradio",category:"radio",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Apply temporary radio params (freq bw sf cr timeout_mins)",serialOnly:!1,hasParam:!0},{name:"sensor get",category:"sensor",params:[],description:"Get sensor/custom variable value",serialOnly:!1,hasParam:!0},{name:"sensor list",category:"sensor",params:[{name:"value",type:"int"}],description:"List all sensor/custom variables",serialOnly:!1,hasParam:!0},{name:"sensor set",category:"sensor",params:[],description:"Set sensor/custom variable value",serialOnly:!1,hasParam:!0},{name:"set adc.multiplier",category:"set",params:[{name:"value",type:"float"}],description:"Set ADC multiplier",serialOnly:!1,hasParam:!0},{name:"set advert.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"string"}],description:"Set local advert interval (60-240 min, 0=off)",serialOnly:!1,hasParam:!0},{name:"set af",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set airtime factor (0-9)",serialOnly:!1,hasParam:!0},{name:"set agc.reset.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set AGC reset interval (seconds, rounded to 4)",serialOnly:!1,hasParam:!0},{name:"set allow.read.only",category:"set",params:[{name:"value",type:"int"}],description:"Set read-only access (on/off)",serialOnly:!1,hasParam:!0},{name:"set bridge.baud",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set bridge baud (9600-115200)",serialOnly:!1,hasParam:!0},{name:"set bridge.channel",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"string"}],description:"Set bridge channel (1-14)",serialOnly:!1,hasParam:!0},{name:"set bridge.delay",category:"set",params:[{name:"value",type:"int"}],description:"Set bridge delay (0-10000 ms)",serialOnly:!1,hasParam:!0},{name:"set bridge.enabled",category:"set",params:[{name:"value",type:"int"}],description:"Enable/disable bridge",serialOnly:!1,hasParam:!0},{name:"set bridge.secret",category:"set",params:[{name:"value",type:"string"},{name:"value",type:"float"}],description:"Set bridge encryption secret",serialOnly:!1,hasParam:!0},{name:"set bridge.source",category:"set",params:[{name:"value",type:"int"}],description:"Set bridge source (rx/tx)",serialOnly:!1,hasParam:!0},{name:"set direct.txdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set direct TX delay factor",serialOnly:!1,hasParam:!0},{name:"set flood.advert.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set flood advert interval (3-48 hours, 0=off)",serialOnly:!1,hasParam:!0},{name:"set flood.max",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"float"}],description:"Set max flood hops (0-64)",serialOnly:!1,hasParam:!0},{name:"set freq",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set frequency MHz (serial only, reboot required)",serialOnly:!0,hasParam:!0},{name:"set guest.password",category:"set",params:[{name:"value",type:"string"}],description:"Set guest password",serialOnly:!1,hasParam:!0},{name:"set int.thresh",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set interference threshold",serialOnly:!1,hasParam:!0},{name:"set lat",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set latitude",serialOnly:!1,hasParam:!0},{name:"set lon",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set longitude",serialOnly:!1,hasParam:!0},{name:"set multi.acks",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set multi-ack (0/1)",serialOnly:!1,hasParam:!0},{name:"set name",category:"set",params:[{name:"value",type:"string"},{name:"value",type:"int"}],description:"Set node name",serialOnly:!1,hasParam:!0},{name:"set prv.key",category:"set",params:[{name:"value",type:"string"}],description:"Set private key (serial only)",serialOnly:!0,hasParam:!0},{name:"set radio",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set radio params (freq bw sf cr)",serialOnly:!1,hasParam:!0},{name:"set repeat",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set repeat/forward (on/off)",serialOnly:!1,hasParam:!0},{name:"set rxdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set RX delay base",serialOnly:!1,hasParam:!0},{name:"set tx",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"float"}],description:"Set TX power (dBm)",serialOnly:!1,hasParam:!0},{name:"set txdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set TX delay factor",serialOnly:!1,hasParam:!0},{name:"stats-core",category:"stats",params:[],description:"Show core statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"stats-packets",category:"stats",params:[],description:"Show packet statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"stats-radio",category:"stats",params:[],description:"Show radio statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"advert",category:"system",params:[],description:"Send self advertisement",serialOnly:!1,hasParam:!1},{name:"board",category:"system",params:[],description:"Show board/manufacturer name",serialOnly:!1,hasParam:!1},{name:"clear stats",category:"system",params:[],description:"Reset statistics counters",serialOnly:!1,hasParam:!0},{name:"clock",category:"system",params:[{name:"value",type:"int"}],description:"Display current time",serialOnly:!1,hasParam:!0},{name:"clock sync",category:"system",params:[],description:"Sync clock from sender timestamp",serialOnly:!1,hasParam:!0},{name:"password",category:"system",params:[{name:"value",type:"string"}],description:"Change admin password",serialOnly:!1,hasParam:!0},{name:"reboot",category:"system",params:[],description:"Reboot the device",serialOnly:!1,hasParam:!1},{name:"start ota",category:"system",params:[{name:"value",type:"int"}],description:"Start OTA firmware update",serialOnly:!1,hasParam:!0},{name:"time",category:"system",params:[{name:"value",type:"int"}],description:"Set time to epoch seconds",serialOnly:!1,hasParam:!0},{name:"ver",category:"system",params:[],description:"Show firmware version and build date",serialOnly:!1,hasParam:!1}],se=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,o=>{const p=Math.random()*16|0;return(o==="x"?p:p&3|8).toString(16)}),we=`██████  ██    ██ ███    ███  ██████         ████████ ███████ ██████  ███    ███ ██ ███    ██  █████  ██      
██   ██  ██  ██  ████  ████ ██                 ██    ██      ██   ██ ████  ████ ██ ████   ██ ██   ██ ██      
██████    ████   ██ ████ ██ ██                 ██    █████   ██████  ██ ████ ██ ██ ██ ██  ██ ███████ ██      
██         ██    ██  ██  ██ ██                 ██    ██      ██   ██ ██  ██  ██ ██ ██  ██ ██ ██   ██ ██      
██         ██    ██      ██  ██████ ███████    ██    ███████ ██   ██ ██      ██ ██ ██   ████ ██   ██ ███████`,W=[{cmd:"help",desc:"Show available commands"},{cmd:"clear",desc:"Clear terminal screen"},{cmd:"status",desc:"Get repeater status summary"},{cmd:"uptime",desc:"Show system uptime"},{cmd:"packets",desc:"Show packet statistics"},{cmd:"board",desc:"Show board/platform info"},...ve.filter(o=>!o.serialOnly).filter(o=>!o.name.startsWith("gps")).filter(o=>!o.name.startsWith("bridge")).filter(o=>!o.name.startsWith("sensor")).filter(o=>o.name!=="start ota").filter(o=>o.name!=="erase").filter(o=>o.name!=="reboot").map(o=>({cmd:o.name,desc:o.description,params:o.hasParam?"{value}":void 0,required:o.hasParam}))],re={"set mode":["forward","monitor"],"set duty":["on","off"],"set repeat":["on","off"],"set allow.read.only":["on","off"],"set multi.acks":["0","1"],"set tx":["10","14","17","20","22"],"set sf":["7","8","9","10","11","12"],"set bw":["125","250","500"],"set freq":["906.875","915.0","920.0"],"set radio":["906.875 250 10 5","915.0 125 7 5"],tempradio:["906.875 250 10 5","915.0 125 7 5","920.0 500 12 8"],"set af":["0.5","1.0","1.5","2.0"],"set txdelay":["0.5","0.7","1.0","1.5"],"set direct.txdelay":["0.3","0.5","0.7"],"set rxdelay":["0","0.5","1.0"],"set advert.interval":["0","60","120","180"],"set flood.advert.interval":["0","6","12","24"],"set flood.max":["0","3","5","10"],"set agc.reset.interval":["0","60","300"],"set int.thresh":["10","14","18","22"],"set log":["debug","info","warning"]};function Oe(o){return o.includes("Batt:")&&o.includes("|")}function Pe(o){const p=[],m=o.split(" | ");for(const w of m){const f=w.indexOf(":");if(f===-1)continue;const v=w.substring(0,f).trim(),h=w.substring(f+1).trim();let y="normal";if(v==="Batt"){const x=parseFloat(h);x<3.3?y="critical":x<3.6?y="warning":y="good"}else if(v==="RSSI"){const x=parseInt(h);x<-120?y="critical":x<-100?y="warning":y="good"}else v==="SNR"?parseFloat(h)<0?y="warning":y="good":(v==="Err"&&parseInt(h)>0||v==="TxQ"&&parseInt(h)>5)&&(y="warning");p.push({label:v,value:h,status:y})}return p}const Se=d.memo(function({visible:p}){return t.jsx("span",{className:S("inline-block w-2 h-4 bg-accent-primary ml-0.5 align-middle",p?"opacity-100":"opacity-20"),"aria-hidden":"true"})}),$e=d.memo(function({items:p,nodeName:m}){const w={normal:"text-text-primary",good:"text-accent-success",warning:"text-amber-400",critical:"text-accent-danger"};return t.jsxs("div",{className:"mt-2 p-3 rounded-lg bg-bg-subtle border border-border-subtle",children:[t.jsxs("div",{className:"text-center text-accent-primary text-xs font-semibold uppercase tracking-wide mb-3 pb-2 border-b border-border-subtle",children:[m," Status"]}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2",children:p.map(f=>t.jsxs("div",{className:"flex justify-between items-center px-2 py-1 rounded bg-bg-elevated border border-border-subtle",children:[t.jsx("span",{className:"text-text-muted text-xs uppercase",children:f.label}),t.jsx("span",{className:S("text-xs font-semibold",w[f.status]),children:f.value})]},f.label))})]})}),Ne=d.memo(function({entry:p,nodeName:m}){const f=p.cmd.trim().toLowerCase()==="status"&&p.result&&Oe(p.result)?Pe(p.result):null;return t.jsxs("div",{className:"mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-accent-primary font-semibold",children:[m,"@repeater:~$"]}),t.jsx("span",{className:"text-text-primary",children:p.cmd})]}),p.isProcessing?t.jsxs("div",{className:"ml-0 mt-1 text-accent-secondary flex items-center gap-1",children:[t.jsx("span",{children:"Processing"}),t.jsxs("span",{className:"inline-flex gap-0.5",children:[t.jsx("span",{className:"animate-pulse",style:{animationDelay:"0ms"},children:"."}),t.jsx("span",{className:"animate-pulse",style:{animationDelay:"200ms"},children:"."}),t.jsx("span",{className:"animate-pulse",style:{animationDelay:"400ms"},children:"."})]})]}):f?t.jsx($e,{items:f,nodeName:m}):p.result?t.jsx("div",{className:"ml-0 mt-1 text-text-secondary whitespace-pre-wrap border-l-2 border-border-subtle pl-3",children:p.result}):null]})}),U=d.memo(function({text:p,status:m}){return t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m==="pending"&&t.jsx("span",{className:"text-text-muted",children:"○"}),m==="active"&&t.jsx("span",{className:"text-accent-secondary animate-pulse",children:"●"}),m==="done"&&t.jsx("span",{className:"text-accent-success",children:"✓"}),m==="error"&&t.jsx("span",{className:"text-accent-danger",children:"✗"}),t.jsx("span",{className:S(m==="pending"&&"text-text-muted",m==="active"&&"text-accent-secondary",m==="done"&&"text-accent-success",m==="error"&&"text-accent-danger"),children:p})]})});function Ce(){const o=pe(),p=(o==null?void 0:o.node_name)||"pymc",[m,w]=d.useState("initializing"),[f,v]=d.useState(0),[h,y]=d.useState([]),[x,$]=d.useState(""),[ne,ie]=d.useState(!0),[N,I]=d.useState(-1),[F,E]=d.useState(!1),[j,q]=d.useState([]),[k,L]=d.useState(0),T=d.useRef(null),D=d.useRef(null),H=d.useRef(null),B=d.useRef(!1);d.useEffect(()=>{if(B.current)return;B.current=!0,(async()=>{v(1),await new Promise(n=>setTimeout(n,600)),w("checking"),v(2),await new Promise(n=>setTimeout(n,800)),v(3),await new Promise(n=>setTimeout(n,400)),w("connected")})()},[]),d.useEffect(()=>(H.current=setInterval(()=>{ie(l=>!l)},530),()=>{H.current&&clearInterval(H.current)}),[]),d.useEffect(()=>{D.current&&(D.current.scrollTop=D.current.scrollHeight)},[h]);const oe=d.useCallback(()=>{T.current&&m==="connected"&&T.current.focus()},[m]),A=d.useCallback(l=>{const n=l.trim().toLowerCase();if(!n){E(!1),q([]);return}const s=n.includes(" ");let b=[];if(s){const _=n.split(" "),a=_.slice(0,-1).join(" "),M=_[_.length-1],P=W.find(O=>O.cmd.toLowerCase()===a);P&&re[P.cmd]&&(b=re[P.cmd].filter(O=>O.toLowerCase().startsWith(M)).map(O=>({cmd:`${P.cmd} ${O}`,desc:`${P.desc} → ${O}`})))}else b=W.filter(_=>_.cmd.toLowerCase().startsWith(n));b.length>0?(q(b.slice(0,8)),L(0),E(!0)):(E(!1),q([]))},[]),z=d.useCallback(l=>{var s;const n=j[l];n&&(n.required&&n.params?($(n.cmd+" "),A(n.cmd+" ")):($(n.cmd),E(!1),q([])),(s=T.current)==null||s.focus())},[j,A]),X=d.useCallback(async l=>{var M,P,O,K,V,Q,J,Y,Z,ee,ae,te;const n=l.trim();if(!n)return;const s=n.toLowerCase();if(s==="clear"){y([]);return}if(s==="help"){const i=W.map(e=>`  ${e.cmd.padEnd(18)} ${e.desc}`).join(`
`),C={id:se(),cmd:n,result:`Available commands:

${i}

Note: Commands use existing API endpoints. Some MeshCore CLI
commands are not available via HTTP.`,isProcessing:!1,timestamp:Date.now()};y(e=>[...e,C]);return}const b=se(),_={id:b,cmd:n,result:null,isProcessing:!0,timestamp:Date.now()};y(i=>[...i,_]);const a=i=>{y(C=>C.map(e=>e.id===b?{...e,isProcessing:!1,result:i}:e))};try{const i=await ue(),C=e=>{const r=Math.floor(e/86400),c=Math.floor(e%86400/3600),u=Math.floor(e%3600/60);return r>0?`${r}d ${c}h ${u}m`:c>0?`${c}h ${u}m`:`${u}m`};if(s==="status"){const e=((P=(M=i.config)==null?void 0:M.repeater)==null?void 0:P.mode)||"unknown",r=(K=(O=i.config)==null?void 0:O.duty_cycle)!=null&&K.enforcement_enabled?"enabled":"disabled",c=Object.keys(i.neighbors||{}).length,u=C(i.uptime_seconds||0);a(`Mode: ${e} | Duty Cycle: ${r}
Neighbors: ${c} | Uptime: ${u}`);return}if(s==="ver"||s==="version"){const e=i.version||"unknown",r=i.core_version||"unknown";a(`pyMC Repeater v${e}
pyMC Core v${r}`);return}if(s==="clock"){a(new Date().toLocaleString());return}if(s==="uptime"){a(C(i.uptime_seconds||0));return}if(s==="neighbors"){const e=i.neighbors||{},r=Object.entries(e);if(r.length===0)a("No neighbors discovered yet.");else{const c=r.map(([u,g])=>{const G=g.name||g.node_name||"Unknown",me=g.rssi!=null?`${g.rssi}dBm`:"?",de=g.snr!=null?`${g.snr}dB`:"?";return`  ${u.slice(0,8)}  ${G.padEnd(16)} RSSI:${me.padStart(6)} SNR:${de.padStart(5)}`});a(`Neighbors (${r.length}):
${c.join(`
`)}`)}return}if(s==="packets"){a(`Packets RX: ${i.rx_count??"?"} | TX: ${i.tx_count??"?"}
Forwarded: ${i.forwarded_count??"?"} | Dropped: ${i.dropped_count??"?"}`);return}if(s.startsWith("get ")){const e=s.slice(4).trim(),r=(V=i.config)==null?void 0:V.radio,c=(Q=i.config)==null?void 0:Q.repeater,u=(J=i.config)==null?void 0:J.delays;switch(e){case"name":a(`> ${i.node_name||"Unknown"}`);return;case"public.key":a(`> ${i.public_key||"Not available"}`);return;case"role":a("> repeater");return;case"radio":{if(!r){a("> Radio config not available");return}const g=r.frequency?(r.frequency/1e6).toFixed(3):"?",G=r.bandwidth?r.bandwidth/1e3:"?";a(`> ${g},${G},${r.spreading_factor||"?"},${r.coding_rate||"?"}`);return}case"freq":a(`> ${r!=null&&r.frequency?(r.frequency/1e6).toFixed(3):"?"}`);return;case"tx":a(`> ${(r==null?void 0:r.tx_power)??"?"}`);return;case"af":a(`> ${c!=null&&c.use_score_for_tx?"1.0":"0"}`);return;case"rxdelay":a(`> ${(u==null?void 0:u.tx_delay_factor)??"0"}`);return;case"txdelay":a(`> ${(u==null?void 0:u.tx_delay_factor)??"1.0"}`);return;case"direct.txdelay":a(`> ${(u==null?void 0:u.direct_tx_delay_factor)??"0.5"}`);return;case"repeat":a(`> ${(c==null?void 0:c.mode)==="forward"?"on":"off"}`);return;case"lat":a(`> ${(c==null?void 0:c.latitude)??"0"}`);return;case"lon":a(`> ${(c==null?void 0:c.longitude)??"0"}`);return;case"advert.interval":a(`> ${((c==null?void 0:c.send_advert_interval_hours)??2)*60}`);return;case"flood.advert.interval":a(`> ${(c==null?void 0:c.send_advert_interval_hours)??24}`);return;case"flood.max":a("> 3");return;case"agc.reset.interval":a("> 0");return;case"allow.read.only":a("> off");return;case"guest.password":a("> (not exposed via HTTP)");return;case"multi.acks":a("> 0");return;case"int.thresh":a("> 0");return;case"mode":a(`> ${(c==null?void 0:c.mode)||"forward"}`);return;default:a(`??: ${e}`);return}}if(s==="board"){a("pyMC_Repeater (Linux/Raspberry Pi)");return}if(s==="stats-packets"){try{const e=await fe(24);e.success&&e.data?a(`rx: ${i.rx_count??0}
tx: ${i.tx_count??0}
fwd: ${i.forwarded_count??0}
drop: ${i.dropped_count??0}`):a(`rx: ${i.rx_count??0}, tx: ${i.tx_count??0}`)}catch{a(`rx: ${i.rx_count??0}, tx: ${i.tx_count??0}`)}return}if(s==="stats-radio"){const e=(Y=i.config)==null?void 0:Y.radio;a(`freq: ${e!=null&&e.frequency?(e.frequency/1e6).toFixed(3):"?"} MHz
bw: ${e!=null&&e.bandwidth?e.bandwidth/1e3:"?"} kHz
sf: ${(e==null?void 0:e.spreading_factor)??"?"}
cr: ${(e==null?void 0:e.coding_rate)??"?"}
tx_pwr: ${(e==null?void 0:e.tx_power)??"?"} dBm
noise: ${i.noise_floor_dbm??"?"} dBm`);return}if(s==="stats-core"){a(`uptime: ${C(i.uptime_seconds||0)}
rx/hr: ${((Z=i.rx_per_hour)==null?void 0:Z.toFixed(1))??"?"}
fwd/hr: ${((ee=i.forwarded_per_hour)==null?void 0:ee.toFixed(1))??"?"}
neighbors: ${Object.keys(i.neighbors||{}).length}
airtime: ${((ae=i.utilization_percent)==null?void 0:ae.toFixed(1))??"?"}%`);return}if(s==="clear stats"){a("Error: Not implemented in pyMC_Repeater");return}if(s.startsWith("tempradio ")){const e=s.split(/\s+/);if(e.length<5){a(`Usage: tempradio <freq_mhz> <bw_khz> <sf> <cr>
Example: tempradio 906.875 250 10 5`);return}const r=parseFloat(e[1]),c=parseInt(e[2]),u=parseInt(e[3]),g=parseInt(e[4]);if(isNaN(r)||r<100||r>1e3){a("Error: Frequency must be in MHz (e.g., 906.875)");return}if(![125,250,500].includes(c)){a("Error: Bandwidth must be 125, 250, or 500 kHz");return}if(isNaN(u)||u<5||u>12){a("Error: Spreading factor must be 5-12");return}if(isNaN(g)||g<5||g>8){a("Error: Coding rate must be 5-8");return}const G=await R({frequency_mhz:r,bandwidth_khz:c,spreading_factor:u,coding_rate:g});G.success?a(`OK - Radio: ${r}MHz, ${c}kHz, SF${u}, CR4/${g}
Note: Changes persist. Restart service to revert.`):a(`Error: ${G.error||"Failed to update radio config"}`);return}if(s.startsWith("neighbor.remove ")){a("Error: neighbor.remove not implemented via HTTP");return}if(s.startsWith("password ")){a("Error: Use config.yaml to change password");return}if(s==="log start"||s==="log stop"||s==="log erase"){a("Error: Log commands not implemented via HTTP");return}if(s==="advert"){const e=await ye();a(e.success?"OK - Advert sent":`Error: ${e.error||"Failed"}`);return}if(s.startsWith("set mode ")){const e=s.split(" ")[2];if(e!=="forward"&&e!=="monitor"){a('Error: Mode must be "forward" or "monitor"');return}const r=await ge(e);a(r.success?`OK - Mode set to ${e}`:"Error: Failed to set mode");return}if(s.startsWith("set duty ")){const e=s.split(" ")[2],r=e==="on"||e==="1"||e==="true",c=await he(r);a(c.success?`OK - Duty cycle ${r?"enabled":"disabled"}`:"Error: Failed to set duty cycle");return}if(s.startsWith("set log ")){const e=(te=s.split(" ")[2])==null?void 0:te.toUpperCase();if(!["DEBUG","INFO","WARNING","ERROR"].includes(e)){a("Error: Level must be debug, info, warning, or error");return}const r=await xe(e);a(r.success?`OK - Log level set to ${e}. Service restarting...`:`Error: ${r.error||"Failed"}`);return}if(s.startsWith("set tx ")){const e=parseInt(s.split(" ")[2]);if(isNaN(e)||e<2||e>22){a("Error: TX power must be 2-22 dBm");return}const r=await R({tx_power:e});a(r.success?`OK - TX power set to ${e}dBm. Restart service to apply.`:`Error: ${r.error||"Failed"}`);return}if(s.startsWith("set freq ")){const e=parseFloat(s.split(" ")[2]);if(isNaN(e)||e<100||e>1e3){a("Error: Frequency must be in MHz (e.g., 906.875)");return}const r=await R({frequency_mhz:e});a(r.success?`OK - Frequency set to ${e}MHz. Restart service to apply.`:`Error: ${r.error||"Failed"}`);return}if(s.startsWith("set sf ")){const e=parseInt(s.split(" ")[2]);if(isNaN(e)||e<5||e>12){a("Error: Spreading factor must be 5-12");return}const r=await R({spreading_factor:e});a(r.success?`OK - SF set to ${e}. Restart service to apply.`:`Error: ${r.error||"Failed"}`);return}if(s.startsWith("set bw ")){const e=parseInt(s.split(" ")[2]);if(![125,250,500].includes(e)){a("Error: Bandwidth must be 125, 250, or 500 kHz");return}const r=await R({bandwidth_khz:e});a(r.success?`OK - Bandwidth set to ${e}kHz. Restart service to apply.`:`Error: ${r.error||"Failed"}`);return}a(`Unknown command: ${n}
Type 'help' for available commands.`)}catch(i){a(`Error: ${i instanceof Error?i.message:"Command failed"}`)}},[]),le=d.useCallback(l=>{if(F&&j.length>0){if(l.key==="ArrowDown"){l.preventDefault(),L(n=>Math.min(n+1,j.length-1));return}else if(l.key==="ArrowUp"){l.preventDefault(),L(n=>Math.max(n-1,0));return}else if(l.key==="Tab"){l.preventDefault(),z(k);return}else if(l.key==="Escape"){l.preventDefault(),E(!1);return}}if(l.key==="Enter"){l.preventDefault();const n=x;$(""),I(-1),E(!1),X(n)}else if(l.key==="ArrowUp"){l.preventDefault();const n=h.filter(s=>s.cmd).map(s=>s.cmd);if(n.length>0){const s=N<n.length-1?N+1:N;I(s),$(n[n.length-1-s]||"")}}else if(l.key==="ArrowDown")if(l.preventDefault(),N>0){const n=h.filter(b=>b.cmd).map(b=>b.cmd),s=N-1;I(s),$(n[n.length-1-s]||"")}else N===0&&(I(-1),$(""))},[x,h,N,X,F,j,k,z]),ce=d.useCallback(l=>{const n=l.target.value;$(n),A(n)},[A]);return t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(be,{className:"w-6 h-6 text-accent-primary"}),t.jsx("h1",{className:"text-xl font-semibold text-text-primary",children:"Terminal"})]}),t.jsxs("div",{className:"glass-card overflow-hidden flex flex-col",style:{height:"calc(100vh - 180px)",minHeight:"400px"},onClick:oe,children:[t.jsxs("div",{ref:D,className:"flex-1 p-4 sm:p-6 overflow-y-auto font-mono text-sm leading-relaxed bg-black/30",children:[t.jsx("pre",{className:"text-accent-primary text-[0.5rem] sm:text-[0.6rem] lg:text-xs leading-none mb-6 overflow-x-auto",children:we}),m!=="connected"&&t.jsxs("div",{className:"mb-6",children:[t.jsx(U,{text:"Initializing terminal...",status:f>=1?f===1?"active":"done":"pending"}),t.jsx(U,{text:"Checking repeater connection...",status:f>=2?f===2?"active":"done":"pending"}),t.jsx(U,{text:m==="error"?"Connection failed":"Connection established",status:f>=3?m==="error"?"error":"done":"pending"})]}),m==="connected"&&h.length===0&&t.jsxs("div",{className:"mb-4",children:[t.jsxs("p",{className:"text-accent-success mb-1",children:["Connected to ",p]}),t.jsx("p",{className:"text-text-muted",children:"Type 'help' for available commands."})]}),h.map(l=>t.jsx(Ne,{entry:l,nodeName:p},l.id)),m==="connected"&&t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-accent-primary font-semibold",children:[p,"@repeater:~$"]}),t.jsx("span",{className:"text-text-primary",children:x}),t.jsx(Se,{visible:ne})]}),F&&j.length>0&&t.jsxs("div",{className:"absolute left-0 bottom-full mb-2 w-full max-w-lg bg-bg-elevated border border-border-subtle rounded-lg shadow-xl overflow-hidden z-10",children:[t.jsxs("div",{className:"px-3 py-2 bg-bg-subtle border-b border-border-subtle flex justify-between items-center",children:[t.jsx("span",{className:"text-xs font-semibold text-accent-primary uppercase tracking-wide",children:"Available Commands"}),t.jsx("span",{className:"text-xs text-text-muted",children:"↑↓ Navigate • Tab Select • Esc Close"})]}),t.jsx("div",{className:"max-h-64 overflow-y-auto",children:j.map((l,n)=>t.jsxs("div",{onClick:()=>z(n),className:S("px-3 py-2 cursor-pointer border-b border-border-subtle last:border-b-0 transition-colors",n===k?"bg-accent-primary text-white":"hover:bg-bg-subtle"),children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:S("font-mono text-sm font-semibold",n===k?"text-white":"text-text-primary"),children:l.cmd}),l.params&&t.jsx("span",{className:S("text-xs px-1.5 py-0.5 rounded border",n===k?"bg-white/20 border-white/30 text-white/90":"bg-accent-primary/10 border-accent-primary/30 text-accent-primary"),children:l.params}),l.required&&t.jsx("span",{className:S("text-[10px] px-1 py-0.5 rounded uppercase font-semibold",n===k?"bg-amber-400/30 text-amber-200":"bg-amber-500/20 text-amber-400"),children:"Required"})]}),t.jsx("p",{className:S("text-xs mt-0.5",n===k?"text-white/80":"text-text-muted"),children:l.desc})]},l.cmd))})]})]})]}),m==="connected"&&t.jsx("input",{ref:T,type:"text",value:x,onChange:ce,onKeyDown:le,className:"sr-only","aria-label":"Terminal input",autoFocus:!0}),t.jsx("div",{className:"px-4 py-2 border-t border-white/5 bg-black/20",children:t.jsxs("div",{className:"flex items-center justify-between text-xs text-text-muted",children:[t.jsx("span",{children:m==="connected"?"Click anywhere to type • ↑↓ for history":"Connecting..."}),(o==null?void 0:o.version)&&t.jsxs("span",{children:["pyMC v",o.version]})]})})]})]})}export{Ce as default};
